**********************
Windows PowerShell transcript start
Start time: 20171222232106
Username: WIN2012R2\Administrator
RunAs User: WIN2012R2\Administrator
Machine: WIN2012R2 (Microsoft Windows NT 6.3.9600.0)
Host Application: C:\Windows\System32\WindowsPowerShell\v1.0\powershell_ise.exe C:\Code\Lesson06\Sharding.ps1
Process ID: 6204
PSVersion: 5.0.10586.117
PSCompatibleVersions: 1.0, 2.0, 3.0, 4.0, 5.0.10586.117
BuildVersion: 10.0.10586.117
CLRVersion: 4.0.30319.42000
WSManStackVersion: 3.0
PSRemotingProtocolVersion: 2.3
SerializationVersion: 1.1.0.1
**********************
Transcript started, output file is C:\Code\Lesson06\Splitting\Log\SplitToyStoreShard.txt
WARNING: The output object type of this cmdlet will be modified in a future release.


ResourceGroupName : toystore
Location          : eastus2
ProvisioningState : Succeeded
Tags              :
ResourceId        : /subscriptions/bf64f3c6-6e64-48c5-a7cc-6c35b4f9aebf/resourceGroups/toystore



ResourceGroupName        : toystore
ServerName               : toyfactory
Location                 : East US 2
SqlAdministratorLogin    : sqladmin
SqlAdministratorPassword :
ServerVersion            : 12.0
Tags                     :



ResourceGroupName             : toystore
ServerName                    : toyfactory
DatabaseName                  : toystore_splitmerge
Location                      : East US 2
DatabaseId                    : 0c8a58bf-7e77-40be-9bb5-bbf3fb976af6
Edition                       : Basic
CollationName                 : SQL_Latin1_General_CP1_CI_AS
CatalogCollation              :
MaxSizeBytes                  : 2147483648
Status                        : Online
CreationDate                  : 12/22/2017 1:17:29 PM
CurrentServiceObjectiveId     : dd6d99bb-f193-4ec1-86f2-43d3bccbc49c
CurrentServiceObjectiveName   : Basic
RequestedServiceObjectiveId   : dd6d99bb-f193-4ec1-86f2-43d3bccbc49c
RequestedServiceObjectiveName :
ElasticPoolName               :
EarliestRestoreDate           : 12/22/2017 1:48:41 PM
Tags                          :
ResourceId                    : /subscriptions/bf64f3c6-6e64-48c5-a7cc-6c35b4f9aebf/resourceGroups/toystore/providers/Microsoft.Sql/servers/toyfactory/databases/toystore
                                _splitmerge
CreateMode                    :


PS>TerminatingError(Import-Module): "File C:\Code\Lesson06\Splitting\SplitMerge\SplitMerge.psm1 cannot be loaded. The file C:\Code\Lesson06\Splitting\SplitMerge\SplitMerge.psm1 is not digitally signed. You cannot run this script on the current system. For more information about running scripts and setting execution policy, see about_Execution_Policies at http://go.microsoft.com/fwlink/?LinkID=135170."
Import-Module : File C:\Code\Lesson06\Splitting\SplitMerge\SplitMerge.psm1 cannot be loaded. The file 
C:\Code\Lesson06\Splitting\SplitMerge\SplitMerge.psm1 is not digitally signed. You cannot run this script on the 
current system. For more information about running scripts and setting execution policy, see about_Execution_Policies 
at http://go.microsoft.com/fwlink/?LinkID=135170.
At C:\Code\Lesson06\Splitting\SplitToyStoreShard.ps1:63 char:1
+ Import-Module $ScriptDir\SplitMerge -Force
+ ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : SecurityError: (:) [Import-Module], PSSecurityException
    + FullyQualifiedErrorId : UnauthorizedAccess,Microsoft.PowerShell.Commands.ImportModuleCommand
Import-Module : File C:\Code\Lesson06\Splitting\SplitMerge\SplitMerge.psm1 cannot be loaded. The file C:\Code\Lesson06\Splitting\SplitMerge\SplitMerge.psm1 is not
digitally signed. You cannot run this script on the current system. For more information about running scripts and setting execution policy, see
about_Execution_Policies at http://go.microsoft.com/fwlink/?LinkID=135170.
At C:\Code\Lesson06\Splitting\SplitToyStoreShard.ps1:63 char:1
+ Import-Module $ScriptDir\SplitMerge -Force
+ ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : SecurityError: (:) [Import-Module], PSSecurityException
    + FullyQualifiedErrorId : UnauthorizedAccess,Microsoft.PowerShell.Commands.ImportModuleCommand
Sending split request
Submit-SplitRequest : The term 'Submit-SplitRequest' is not recognized as the name of a cmdlet, function, script file, 
or operable program. Check the spelling of the name, or if a path was included, verify that the path is correct and try 
again.
At C:\Code\Lesson06\Splitting\SplitToyStoreShard.ps1:66 char:21
+ $splitOperationId = Submit-SplitRequest `
+                     ~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : ObjectNotFound: (Submit-SplitRequest:String) [], CommandNotFoundException
    + FullyQualifiedErrorId : CommandNotFoundException
Submit-SplitRequest : The term 'Submit-SplitRequest' is not recognized as the name of a cmdlet, function, script file, or operable program. Check the spelling of the
name, or if a path was included, verify that the path is correct and try again.
At C:\Code\Lesson06\Splitting\SplitToyStoreShard.ps1:66 char:21
+ $splitOperationId = Submit-SplitRequest `
+                     ~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : ObjectNotFound: (Submit-SplitRequest:String) [], CommandNotFoundException
    + FullyQualifiedErrorId : CommandNotFoundException

Began split operation with id
Wait-SplitMergeRequest : The term 'Wait-SplitMergeRequest' is not recognized as the name of a cmdlet, function, script 
file, or operable program. Check the spelling of the name, or if a path was included, verify that the path is correct 
and try again.
At C:\Code\Lesson06\Splitting\SplitToyStoreShard.ps1:84 char:1
+ Wait-SplitMergeRequest -SplitMergeServiceEndpoint $SplitMergeServiceE ...
+ ~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : ObjectNotFound: (Wait-SplitMergeRequest:String) [], CommandNotFoundException
    + FullyQualifiedErrorId : CommandNotFoundException
Wait-SplitMergeRequest : The term 'Wait-SplitMergeRequest' is not recognized as the name of a cmdlet, function, script file, or operable program. Check the spelling of
the name, or if a path was included, verify that the path is correct and try again.
At C:\Code\Lesson06\Splitting\SplitToyStoreShard.ps1:84 char:1
+ Wait-SplitMergeRequest -SplitMergeServiceEndpoint $SplitMergeServiceE ...
+ ~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : ObjectNotFound: (Wait-SplitMergeRequest:String) [], CommandNotFoundException
    + FullyQualifiedErrorId : CommandNotFoundException



PS C:\Code\Lesson06\Splitting> Import-Module .\SplitMerge
>> TerminatingError(Import-Module): "File C:\Code\Lesson06\Splitting\SplitMerge\SplitMerge.psm1 cannot be loaded. The file C:\Code\Lesson06\Splitting\SplitMerge\SplitMerge.psm1 is not digitally signed. You cannot run this script on the current system. For more information about running scripts and setting execution policy, see about_Execution_Policies at http://go.microsoft.com/fwlink/?LinkID=135170."
Import-Module : File C:\Code\Lesson06\Splitting\SplitMerge\SplitMerge.psm1 cannot be loaded. The file 
C:\Code\Lesson06\Splitting\SplitMerge\SplitMerge.psm1 is not digitally signed. You cannot run this script on the 
current system. For more information about running scripts and setting execution policy, see about_Execution_Policies 
at http://go.microsoft.com/fwlink/?LinkID=135170.
At line:1 char:1
+ Import-Module .\SplitMerge
+ ~~~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : SecurityError: (:) [Import-Module], PSSecurityException
    + FullyQualifiedErrorId : UnauthorizedAccess,Microsoft.PowerShell.Commands.ImportModuleCommand
Import-Module : File C:\Code\Lesson06\Splitting\SplitMerge\SplitMerge.psm1 cannot be loaded. The file C:\Code\Lesson06\Splitting\SplitMerge\SplitMerge.psm1 is not
digitally signed. You cannot run this script on the current system. For more information about running scripts and setting execution policy, see
about_Execution_Policies at http://go.microsoft.com/fwlink/?LinkID=135170.
At line:1 char:1
+ Import-Module .\SplitMerge
+ ~~~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : SecurityError: (:) [Import-Module], PSSecurityException
    + FullyQualifiedErrorId : UnauthorizedAccess,Microsoft.PowerShell.Commands.ImportModuleCommand
PS C:\Code\Lesson06\Splitting> Set-ExecutionPolicy -Scope Process -ExecutionPolicy Bypass
Execution Policy Change
The execution policy helps protect you from scripts that you do not trust. Changing the execution policy might expose you to the security risks described in the about_Execution_Policies help topic at http://go.microsoft.com/fwlink/?LinkID=135170. Do you want to change the execution policy?
&Yes  Yes to &All  &No  No to A&ll  &Suspend
A
PS C:\Code\Lesson06\Splitting> Import-Module .\SplitMerge
PS C:\Code\Lesson06\Splitting> .\SplitToyStoreShard.ps1 -ResourceGroup toystore -SqlServer toyfactory -UserName sqladmin -Password Packt@pub2 -SplitMergeDatabase toystore_splitmerge -SplitMergeServiceEndpoint "https://splitmerge.cloudapp.net/" -ShardMapManagerDatabaseName toystore_SMM -Shard2 toystore_900 -ShardMapName toystorerangemap -SplitRangeLow 800 -SplitRangeHigh 1000 -SplitValue 900 -CertificateThumbprint 7000689A8517A0FE97BD0414C501E586DDF9BC3F
Transcript started, output file is C:\Code\Lesson06\Splitting\Log\SplitToyStoreShard.txt
WARNING: The output object type of this cmdlet will be modified in a future release.


ResourceGroupName : toystore
Location          : eastus2
ProvisioningState : Succeeded
Tags              :
ResourceId        : /subscriptions/bf64f3c6-6e64-48c5-a7cc-6c35b4f9aebf/resourceGroups/toystore



ResourceGroupName        : toystore
ServerName               : toyfactory
Location                 : East US 2
SqlAdministratorLogin    : sqladmin
SqlAdministratorPassword :
ServerVersion            : 12.0
Tags                     :



ResourceGroupName             : toystore
ServerName                    : toyfactory
DatabaseName                  : toystore_splitmerge
Location                      : East US 2
DatabaseId                    : 0c8a58bf-7e77-40be-9bb5-bbf3fb976af6
Edition                       : Basic
CollationName                 : SQL_Latin1_General_CP1_CI_AS
CatalogCollation              :
MaxSizeBytes                  : 2147483648
Status                        : Online
CreationDate                  : 12/22/2017 1:17:29 PM
CurrentServiceObjectiveId     : dd6d99bb-f193-4ec1-86f2-43d3bccbc49c
CurrentServiceObjectiveName   : Basic
RequestedServiceObjectiveId   : dd6d99bb-f193-4ec1-86f2-43d3bccbc49c
RequestedServiceObjectiveName :
ElasticPoolName               :
EarliestRestoreDate           : 12/22/2017 1:48:41 PM
Tags                          :
ResourceId                    : /subscriptions/bf64f3c6-6e64-48c5-a7cc-6c35b4f9aebf/resourceGroups/toystore/providers/Microsoft.Sql/servers/toyfactory/databases/toystore
                                _splitmerge
CreateMode                    :


Sending split request
PS C:\Code\Lesson06\Splitting> TerminatingError(Submit-SplitRequest): "Cannot bind argument to parameter 'ShardMapManagerServerName' because it is an empty string."
Submit-SplitRequest : Cannot bind argument to parameter 'ShardMapManagerServerName' because it is an empty string.
At C:\Code\Lesson06\Splitting\SplitToyStoreShard.ps1:68 char:32
+     -ShardMapManagerServerName $SqlServer.database.windows.net `
+                                ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : InvalidData: (:) [Submit-SplitRequest], ParameterBindingValidationException
    + FullyQualifiedErrorId : ParameterArgumentValidationErrorEmptyStringNotAllowed,Submit-SplitRequest
Submit-SplitRequest : Cannot bind argument to parameter 'ShardMapManagerServerName' because it is an empty string.
At C:\Code\Lesson06\Splitting\SplitToyStoreShard.ps1:68 char:32
+     -ShardMapManagerServerName $SqlServer.database.windows.net `
+                                ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : InvalidData: (:) [Submit-SplitRequest], ParameterBindingValidationException
    + FullyQualifiedErrorId : ParameterArgumentValidationErrorEmptyStringNotAllowed,Submit-SplitRequest

Began split operation with id
PS C:\Code\Lesson06\Splitting> TerminatingError(Wait-SplitMergeRequest): "Cannot process argument transformation on parameter 'OperationId'. Cannot convert null to type "System.Guid"."
Wait-SplitMergeRequest : Cannot process argument transformation on parameter 'OperationId'. Cannot convert null to type 
"System.Guid".
At C:\Code\Lesson06\Splitting\SplitToyStoreShard.ps1:84 char:91
+ ... int $SplitMergeServiceEndpoint -OperationId $splitOperationId -Certif ...
+                                                 ~~~~~~~~~~~~~~~~~
    + CategoryInfo          : InvalidData: (:) [Wait-SplitMergeRequest], ParameterBindingArgumentTransformationException
    + FullyQualifiedErrorId : ParameterArgumentTransformationError,Wait-SplitMergeRequest
Wait-SplitMergeRequest : Cannot process argument transformation on parameter 'OperationId'. Cannot convert null to type "System.Guid".
At C:\Code\Lesson06\Splitting\SplitToyStoreShard.ps1:84 char:91
+ ... int $SplitMergeServiceEndpoint -OperationId $splitOperationId -Certif ...
+                                                 ~~~~~~~~~~~~~~~~~
    + CategoryInfo          : InvalidData: (:) [Wait-SplitMergeRequest], ParameterBindingArgumentTransformationException
    + FullyQualifiedErrorId : ParameterArgumentTransformationError,Wait-SplitMergeRequest



PS C:\Code\Lesson06\Splitting> .\SplitToyStoreShard.ps1 -ResourceGroup toystore -SqlServer toyfactory -UserName sqladmin -Password Packt@pub2 -SplitMergeDatabase toystore_splitmerge -SplitMergeServiceEndpoint "https://splitmerge.cloudapp.net/" -ShardMapManagerDatabaseName toystore_SMM -Shard2 toystore_900 -ShardMapName toystorerangemap -SplitRangeLow 800 -SplitRangeHigh 1000 -SplitValue 900 -CertificateThumbprint 7000689A8517A0FE97BD0414C501E586DDF9BC3F
Transcript started, output file is C:\Code\Lesson06\Splitting\Log\SplitToyStoreShard.txt
WARNING: The output object type of this cmdlet will be modified in a future release.


ResourceGroupName : toystore
Location          : eastus2
ProvisioningState : Succeeded
Tags              :
ResourceId        : /subscriptions/bf64f3c6-6e64-48c5-a7cc-6c35b4f9aebf/resourceGroups/toystore



ResourceGroupName        : toystore
ServerName               : toyfactory
Location                 : East US 2
SqlAdministratorLogin    : sqladmin
SqlAdministratorPassword :
ServerVersion            : 12.0
Tags                     :



ResourceGroupName             : toystore
ServerName                    : toyfactory
DatabaseName                  : toystore_splitmerge
Location                      : East US 2
DatabaseId                    : 0c8a58bf-7e77-40be-9bb5-bbf3fb976af6
Edition                       : Basic
CollationName                 : SQL_Latin1_General_CP1_CI_AS
CatalogCollation              :
MaxSizeBytes                  : 2147483648
Status                        : Online
CreationDate                  : 12/22/2017 1:17:29 PM
CurrentServiceObjectiveId     : dd6d99bb-f193-4ec1-86f2-43d3bccbc49c
CurrentServiceObjectiveName   : Basic
RequestedServiceObjectiveId   : dd6d99bb-f193-4ec1-86f2-43d3bccbc49c
RequestedServiceObjectiveName :
ElasticPoolName               :
EarliestRestoreDate           : 12/22/2017 1:48:41 PM
Tags                          :
ResourceId                    : /subscriptions/bf64f3c6-6e64-48c5-a7cc-6c35b4f9aebf/resourceGroups/toystore/providers/Microsoft.Sql/servers/toyfactory/databases/toystore
                                _splitmerge
CreateMode                    :


Sending split request
PS C:\Code\Lesson06\Splitting> TerminatingError(Submit-SplitRequest): "Cannot bind argument to parameter 'TargetServerName' because it is an empty string."
Submit-SplitRequest : Cannot bind argument to parameter 'TargetServerName' because it is an empty string.
At C:\Code\Lesson06\Splitting\SplitToyStoreShard.ps1:70 char:23
+     -TargetServerName $SqlServer.database.windows.net `
+                       ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : InvalidData: (:) [Submit-SplitRequest], ParameterBindingValidationException
    + FullyQualifiedErrorId : ParameterArgumentValidationErrorEmptyStringNotAllowed,Submit-SplitRequest
Submit-SplitRequest : Cannot bind argument to parameter 'TargetServerName' because it is an empty string.
At C:\Code\Lesson06\Splitting\SplitToyStoreShard.ps1:70 char:23
+     -TargetServerName $SqlServer.database.windows.net `
+                       ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : InvalidData: (:) [Submit-SplitRequest], ParameterBindingValidationException
    + FullyQualifiedErrorId : ParameterArgumentValidationErrorEmptyStringNotAllowed,Submit-SplitRequest

Began split operation with id
PS C:\Code\Lesson06\Splitting> TerminatingError(Wait-SplitMergeRequest): "Cannot process argument transformation on parameter 'OperationId'. Cannot convert null to type "System.Guid"."
Wait-SplitMergeRequest : Cannot process argument transformation on parameter 'OperationId'. Cannot convert null to type 
"System.Guid".
At C:\Code\Lesson06\Splitting\SplitToyStoreShard.ps1:84 char:91
+ ... int $SplitMergeServiceEndpoint -OperationId $splitOperationId -Certif ...
+                                                 ~~~~~~~~~~~~~~~~~
    + CategoryInfo          : InvalidData: (:) [Wait-SplitMergeRequest], ParameterBindingArgumentTransformationException
    + FullyQualifiedErrorId : ParameterArgumentTransformationError,Wait-SplitMergeRequest
Wait-SplitMergeRequest : Cannot process argument transformation on parameter 'OperationId'. Cannot convert null to type "System.Guid".
At C:\Code\Lesson06\Splitting\SplitToyStoreShard.ps1:84 char:91
+ ... int $SplitMergeServiceEndpoint -OperationId $splitOperationId -Certif ...
+                                                 ~~~~~~~~~~~~~~~~~
    + CategoryInfo          : InvalidData: (:) [Wait-SplitMergeRequest], ParameterBindingArgumentTransformationException
    + FullyQualifiedErrorId : ParameterArgumentTransformationError,Wait-SplitMergeRequest



PS C:\Code\Lesson06\Splitting> .\SplitToyStoreShard.ps1 -ResourceGroup toystore -SqlServer toyfactory -UserName sqladmin -Password Packt@pub2 -SplitMergeDatabase toystore_splitmerge -SplitMergeServiceEndpoint "https://splitmerge.cloudapp.net/" -ShardMapManagerDatabaseName toystore_SMM -Shard2 toystore_900 -ShardMapName toystorerangemap -SplitRangeLow 800 -SplitRangeHigh 1000 -SplitValue 900 -CertificateThumbprint 7000689A8517A0FE97BD0414C501E586DDF9BC3F 
Transcript started, output file is C:\Code\Lesson06\Splitting\Log\SplitToyStoreShard.txt
WARNING: The output object type of this cmdlet will be modified in a future release.


ResourceGroupName : toystore
Location          : eastus2
ProvisioningState : Succeeded
Tags              :
ResourceId        : /subscriptions/bf64f3c6-6e64-48c5-a7cc-6c35b4f9aebf/resourceGroups/toystore



ResourceGroupName        : toystore
ServerName               : toyfactory
Location                 : East US 2
SqlAdministratorLogin    : sqladmin
SqlAdministratorPassword :
ServerVersion            : 12.0
Tags                     :



ResourceGroupName             : toystore
ServerName                    : toyfactory
DatabaseName                  : toystore_splitmerge
Location                      : East US 2
DatabaseId                    : 0c8a58bf-7e77-40be-9bb5-bbf3fb976af6
Edition                       : Basic
CollationName                 : SQL_Latin1_General_CP1_CI_AS
CatalogCollation              :
MaxSizeBytes                  : 2147483648
Status                        : Online
CreationDate                  : 12/22/2017 1:17:29 PM
CurrentServiceObjectiveId     : dd6d99bb-f193-4ec1-86f2-43d3bccbc49c
CurrentServiceObjectiveName   : Basic
RequestedServiceObjectiveId   : dd6d99bb-f193-4ec1-86f2-43d3bccbc49c
RequestedServiceObjectiveName :
ElasticPoolName               :
EarliestRestoreDate           : 12/22/2017 1:48:41 PM
Tags                          :
ResourceId                    : /subscriptions/bf64f3c6-6e64-48c5-a7cc-6c35b4f9aebf/resourceGroups/toystore/providers/Microsoft.Sql/servers/toyfactory/databases/toystore
                                _splitmerge
CreateMode                    :


Sending split request
PS C:\Code\Lesson06\Splitting> TerminatingError(Invoke-WebRequest): "Unable to retrieve certificates because the thumbprint is not valid. Verify the thumbprint and retry. "
>> TerminatingError(Invoke-WebRequest): "Unable to retrieve certificates because the thumbprint is not valid. Verify the thumbprint and retry. "
>> TerminatingError(Invoke-WebRequest): "Unable to retrieve certificates because the thumbprint is not valid. Verify the thumbprint and retry. "
>> TerminatingError(Invoke-WebRequest): "Unable to retrieve certificates because the thumbprint is not valid. Verify the thumbprint and retry. "
Invoke-WebRequest : Unable to retrieve certificates because the thumbprint is not valid. Verify the thumbprint and retry.
At C:\Code\Lesson06\Splitting\SplitMerge\SplitMerge.psm1:86 char:13
+     $body = Invoke-WebRequest @certificate $SplitMergeServiceEndpoint ...
+             ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : SecurityError: (:) [Invoke-WebRequest], CryptographicException
    + FullyQualifiedErrorId : WebCmdletCertificateException,Microsoft.PowerShell.Commands.InvokeWebRequestCommand

PS C:\Code\Lesson06\Splitting> .\SplitToyStoreShard.ps1 -ResourceGroup toystore -SqlServer toyfactory -UserName sqladmin -Password Packt@pub2 -SplitMergeDatabase toystore_splitmerge -SplitMergeServiceEndpoint "https://splitmerge.cloudapp.net/" -ShardMapManagerDatabaseName toystore_SMM -Shard2 toystore_900 -ShardMapName toystorerangemap -SplitRangeLow 800 -SplitRangeHigh 1000 -SplitValue 900 -CertificateThumbprint '7000689A8517A0FE97BD0414C501E586DDF9BC3F' 
Transcript started, output file is C:\Code\Lesson06\Splitting\Log\SplitToyStoreShard.txt
WARNING: The output object type of this cmdlet will be modified in a future release.


ResourceGroupName : toystore
Location          : eastus2
ProvisioningState : Succeeded
Tags              :
ResourceId        : /subscriptions/bf64f3c6-6e64-48c5-a7cc-6c35b4f9aebf/resourceGroups/toystore



ResourceGroupName        : toystore
ServerName               : toyfactory
Location                 : East US 2
SqlAdministratorLogin    : sqladmin
SqlAdministratorPassword :
ServerVersion            : 12.0
Tags                     :



ResourceGroupName             : toystore
ServerName                    : toyfactory
DatabaseName                  : toystore_splitmerge
Location                      : East US 2
DatabaseId                    : 0c8a58bf-7e77-40be-9bb5-bbf3fb976af6
Edition                       : Basic
CollationName                 : SQL_Latin1_General_CP1_CI_AS
CatalogCollation              :
MaxSizeBytes                  : 2147483648
Status                        : Online
CreationDate                  : 12/22/2017 1:17:29 PM
CurrentServiceObjectiveId     : dd6d99bb-f193-4ec1-86f2-43d3bccbc49c
CurrentServiceObjectiveName   : Basic
RequestedServiceObjectiveId   : dd6d99bb-f193-4ec1-86f2-43d3bccbc49c
RequestedServiceObjectiveName :
ElasticPoolName               :
EarliestRestoreDate           : 12/22/2017 1:48:41 PM
Tags                          :
ResourceId                    : /subscriptions/bf64f3c6-6e64-48c5-a7cc-6c35b4f9aebf/resourceGroups/toystore/providers/Microsoft.Sql/servers/toyfactory/databases/toystore
                                _splitmerge
CreateMode                    :


Sending split request
PS C:\Code\Lesson06\Splitting> TerminatingError(Invoke-WebRequest): "Unable to retrieve certificates because the thumbprint is not valid. Verify the thumbprint and retry. "
>> TerminatingError(Invoke-WebRequest): "Unable to retrieve certificates because the thumbprint is not valid. Verify the thumbprint and retry. "
>> TerminatingError(Invoke-WebRequest): "Unable to retrieve certificates because the thumbprint is not valid. Verify the thumbprint and retry. "
>> TerminatingError(Invoke-WebRequest): "Unable to retrieve certificates because the thumbprint is not valid. Verify the thumbprint and retry. "
Invoke-WebRequest : Unable to retrieve certificates because the thumbprint is not valid. Verify the thumbprint and retry.
At C:\Code\Lesson06\Splitting\SplitMerge\SplitMerge.psm1:86 char:13
+     $body = Invoke-WebRequest @certificate $SplitMergeServiceEndpoint ...
+             ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : SecurityError: (:) [Invoke-WebRequest], CryptographicException
    + FullyQualifiedErrorId : WebCmdletCertificateException,Microsoft.PowerShell.Commands.InvokeWebRequestCommand

PS C:\Code\Lesson06\Splitting> .\SplitToyStoreShard.ps1 -ResourceGroup toystore -SqlServer toyfactory -UserName sqladmin -Password Packt@pub2 -SplitMergeDatabase toystore_splitmerge -SplitMergeServiceEndpoint "https://splitmerge.cloudapp.net/" -ShardMapManagerDatabaseName toystore_SMM -Shard2 toystore_900 -ShardMapName toystorerangemap -SplitRangeLow 800 -SplitRangeHigh 1000 -SplitValue 900 -CertificateThumbprint '7000689A8517A0FE97BD0414C501E586DDF9BC3F' 
Transcript started, output file is C:\Code\Lesson06\Splitting\Log\SplitToyStoreShard.txt
WARNING: The output object type of this cmdlet will be modified in a future release.


ResourceGroupName : toystore
Location          : eastus2
ProvisioningState : Succeeded
Tags              :
ResourceId        : /subscriptions/bf64f3c6-6e64-48c5-a7cc-6c35b4f9aebf/resourceGroups/toystore



ResourceGroupName        : toystore
ServerName               : toyfactory
Location                 : East US 2
SqlAdministratorLogin    : sqladmin
SqlAdministratorPassword :
ServerVersion            : 12.0
Tags                     :



ResourceGroupName             : toystore
ServerName                    : toyfactory
DatabaseName                  : toystore_splitmerge
Location                      : East US 2
DatabaseId                    : 0c8a58bf-7e77-40be-9bb5-bbf3fb976af6
Edition                       : Basic
CollationName                 : SQL_Latin1_General_CP1_CI_AS
CatalogCollation              :
MaxSizeBytes                  : 2147483648
Status                        : Online
CreationDate                  : 12/22/2017 1:17:29 PM
CurrentServiceObjectiveId     : dd6d99bb-f193-4ec1-86f2-43d3bccbc49c
CurrentServiceObjectiveName   : Basic
RequestedServiceObjectiveId   : dd6d99bb-f193-4ec1-86f2-43d3bccbc49c
RequestedServiceObjectiveName :
ElasticPoolName               :
EarliestRestoreDate           : 12/22/2017 1:48:41 PM
Tags                          :
ResourceId                    : /subscriptions/bf64f3c6-6e64-48c5-a7cc-6c35b4f9aebf/resourceGroups/toystore/providers/Microsoft.Sql/servers/toyfactory/databases/toystore
                                _splitmerge
CreateMode                    :


Sending split request
PS C:\Code\Lesson06\Splitting> TerminatingError(Invoke-WebRequest): "Unable to retrieve certificates because the thumbprint is not valid. Verify the thumbprint and retry. "
>> TerminatingError(Invoke-WebRequest): "Unable to retrieve certificates because the thumbprint is not valid. Verify the thumbprint and retry. "
>> TerminatingError(Invoke-WebRequest): "Unable to retrieve certificates because the thumbprint is not valid. Verify the thumbprint and retry. "
>> TerminatingError(Invoke-WebRequest): "Unable to retrieve certificates because the thumbprint is not valid. Verify the thumbprint and retry. "
Invoke-WebRequest : Unable to retrieve certificates because the thumbprint is not valid. Verify the thumbprint and retry.
At C:\Code\Lesson06\Splitting\SplitMerge\SplitMerge.psm1:86 char:13
+     $body = Invoke-WebRequest @certificate $SplitMergeServiceEndpoint ...
+             ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : SecurityError: (:) [Invoke-WebRequest], CryptographicException
    + FullyQualifiedErrorId : WebCmdletCertificateException,Microsoft.PowerShell.Commands.InvokeWebRequestCommand

PS C:\Code\Lesson06\Splitting> .\SplitToyStoreShard.ps1 -ResourceGroup toystore -SqlServer toyfactory -UserName sqladmin -Password Packt@pub2 -SplitMergeDatabase toystore_splitmerge -SplitMergeServiceEndpoint "https://splitmerge.cloudapp.net/" -ShardMapManagerDatabaseName toystore_SMM -Shard2 toystore_900 -ShardMapName toystorerangemap -SplitRangeLow 800 -SplitRangeHigh 1000 -SplitValue 900 -CertificateThumbprint '7000689A8517A0FE97BD0414C501E586DDF9BC3F' 
Transcript started, output file is C:\Code\Lesson06\Splitting\Log\SplitToyStoreShard.txt
WARNING: The output object type of this cmdlet will be modified in a future release.


ResourceGroupName : toystore
Location          : eastus2
ProvisioningState : Succeeded
Tags              :
ResourceId        : /subscriptions/bf64f3c6-6e64-48c5-a7cc-6c35b4f9aebf/resourceGroups/toystore



ResourceGroupName        : toystore
ServerName               : toyfactory
Location                 : East US 2
SqlAdministratorLogin    : sqladmin
SqlAdministratorPassword :
ServerVersion            : 12.0
Tags                     :



ResourceGroupName             : toystore
ServerName                    : toyfactory
DatabaseName                  : toystore_splitmerge
Location                      : East US 2
DatabaseId                    : 0c8a58bf-7e77-40be-9bb5-bbf3fb976af6
Edition                       : Basic
CollationName                 : SQL_Latin1_General_CP1_CI_AS
CatalogCollation              :
MaxSizeBytes                  : 2147483648
Status                        : Online
CreationDate                  : 12/22/2017 1:17:29 PM
CurrentServiceObjectiveId     : dd6d99bb-f193-4ec1-86f2-43d3bccbc49c
CurrentServiceObjectiveName   : Basic
RequestedServiceObjectiveId   : dd6d99bb-f193-4ec1-86f2-43d3bccbc49c
RequestedServiceObjectiveName :
ElasticPoolName               :
EarliestRestoreDate           : 12/22/2017 1:48:41 PM
Tags                          :
ResourceId                    : /subscriptions/bf64f3c6-6e64-48c5-a7cc-6c35b4f9aebf/resourceGroups/toystore/providers/Microsoft.Sql/servers/toyfactory/databases/toystore
                                _splitmerge
CreateMode                    :


Sending split request
PS C:\Code\Lesson06\Splitting> TerminatingError(Invoke-WebRequest): "Unable to retrieve certificates because the thumbprint is not valid. Verify the thumbprint and retry. "
>> TerminatingError(Invoke-WebRequest): "Unable to retrieve certificates because the thumbprint is not valid. Verify the thumbprint and retry. "
>> TerminatingError(Invoke-WebRequest): "Unable to retrieve certificates because the thumbprint is not valid. Verify the thumbprint and retry. "
>> TerminatingError(Invoke-WebRequest): "Unable to retrieve certificates because the thumbprint is not valid. Verify the thumbprint and retry. "
Invoke-WebRequest : Unable to retrieve certificates because the thumbprint is not valid. Verify the thumbprint and retry.
At C:\Code\Lesson06\Splitting\SplitMerge\SplitMerge.psm1:86 char:13
+     $body = Invoke-WebRequest @certificate $SplitMergeServiceEndpoint ...
+             ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : SecurityError: (:) [Invoke-WebRequest], CryptographicException
    + FullyQualifiedErrorId : WebCmdletCertificateException,Microsoft.PowerShell.Commands.InvokeWebRequestCommand

PS C:\Code\Lesson06\Splitting> .\SplitToyStoreShard.ps1 -ResourceGroup toystore -SqlServer toyfactory -UserName sqladmin -Password Packt@pub2 -SplitMergeDatabase toystore_splitmerge -SplitMergeServiceEndpoint "https://splitmerge.cloudapp.net/" -ShardMapManagerDatabaseName toystore_SMM -Shard2 toystore_900 -ShardMapName toystorerangemap -SplitRangeLow 800 -SplitRangeHigh 1000 -SplitValue 900 
>> TerminatingError(): "The pipeline has been stopped."
>> TerminatingError(): "The pipeline has been stopped."
PS C:\Code\Lesson06\Splitting> .\SplitToyStoreShard.ps1 -ResourceGroup toystore -SqlServer toyfactory -UserName sqladmin -Password Packt@pub2 -SplitMergeDatabase toystore_splitmerge -SplitMergeServiceEndpoint "https://splitmerge.cloudapp.net/" -ShardMapManagerDatabaseName toystore_SMM -Shard2 toystore_900 -ShardMapName toystorerangemap -SplitRangeLow 800 -SplitRangeHigh 1000 -SplitValue 900 
Transcript started, output file is C:\Code\Lesson06\Splitting\Log\SplitToyStoreShard.txt
WARNING: The output object type of this cmdlet will be modified in a future release.


ResourceGroupName : toystore
Location          : eastus2
ProvisioningState : Succeeded
Tags              :
ResourceId        : /subscriptions/bf64f3c6-6e64-48c5-a7cc-6c35b4f9aebf/resourceGroups/toystore



ResourceGroupName        : toystore
ServerName               : toyfactory
Location                 : East US 2
SqlAdministratorLogin    : sqladmin
SqlAdministratorPassword :
ServerVersion            : 12.0
Tags                     :



ResourceGroupName             : toystore
ServerName                    : toyfactory
DatabaseName                  : toystore_splitmerge
Location                      : East US 2
DatabaseId                    : 0c8a58bf-7e77-40be-9bb5-bbf3fb976af6
Edition                       : Basic
CollationName                 : SQL_Latin1_General_CP1_CI_AS
CatalogCollation              :
MaxSizeBytes                  : 2147483648
Status                        : Online
CreationDate                  : 12/22/2017 1:17:29 PM
CurrentServiceObjectiveId     : dd6d99bb-f193-4ec1-86f2-43d3bccbc49c
CurrentServiceObjectiveName   : Basic
RequestedServiceObjectiveId   : dd6d99bb-f193-4ec1-86f2-43d3bccbc49c
RequestedServiceObjectiveName :
ElasticPoolName               :
EarliestRestoreDate           : 12/22/2017 1:48:41 PM
Tags                          :
ResourceId                    : /subscriptions/bf64f3c6-6e64-48c5-a7cc-6c35b4f9aebf/resourceGroups/toystore/providers/Microsoft.Sql/servers/toyfactory/databases/toystore
                                _splitmerge
CreateMode                    :


Sending split request
PS C:\Code\Lesson06\Splitting> TerminatingError(Invoke-WebRequest): "Error.
An error occurred while processing your request."
>> TerminatingError(Invoke-WebRequest): "Error.
An error occurred while processing your request."
>> TerminatingError(Invoke-WebRequest): "Error.
An error occurred while processing your request."
>> TerminatingError(Invoke-WebRequest): "Error.
An error occurred while processing your request."
Invoke-WebRequest : Error.
An error occurred while processing your request.
At C:\Code\Lesson06\Splitting\SplitMerge\SplitMerge.psm1:86 char:13
+     $body = Invoke-WebRequest @certificate $SplitMergeServiceEndpoint ...
+             ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : InvalidOperation: (System.Net.HttpWebRequest:HttpWebRequest) [Invoke-WebRequest], WebException
    + FullyQualifiedErrorId : WebCmdletWebResponseException,Microsoft.PowerShell.Commands.InvokeWebRequestCommand
PS C:\Code\Lesson06\Splitting> .\SplitToyStoreShard.ps1 -ResourceGroup toystore -SqlServer toyfactory -UserName sqladmin -Password Packt@pub2 -SplitMergeDatabase toystore_splitmerge -SplitMergeServiceEndpoint "https://http://4a90f0d8bfee4475b6942559d27f0305.cloudapp.net/.cloudapp.net/" -ShardMapManagerDatabaseName toystore_SMM -Shard2 toystore_900 -ShardMapName toystorerangemap -SplitRangeLow 800 -SplitRangeHigh 1000 -SplitValue 900 
Transcript started, output file is C:\Code\Lesson06\Splitting\Log\SplitToyStoreShard.txt
WARNING: The output object type of this cmdlet will be modified in a future release.


ResourceGroupName : toystore
Location          : eastus2
ProvisioningState : Succeeded
Tags              :
ResourceId        : /subscriptions/bf64f3c6-6e64-48c5-a7cc-6c35b4f9aebf/resourceGroups/toystore



ResourceGroupName        : toystore
ServerName               : toyfactory
Location                 : East US 2
SqlAdministratorLogin    : sqladmin
SqlAdministratorPassword :
ServerVersion            : 12.0
Tags                     :



ResourceGroupName             : toystore
ServerName                    : toyfactory
DatabaseName                  : toystore_splitmerge
Location                      : East US 2
DatabaseId                    : 0c8a58bf-7e77-40be-9bb5-bbf3fb976af6
Edition                       : Basic
CollationName                 : SQL_Latin1_General_CP1_CI_AS
CatalogCollation              :
MaxSizeBytes                  : 2147483648
Status                        : Online
CreationDate                  : 12/22/2017 1:17:29 PM
CurrentServiceObjectiveId     : dd6d99bb-f193-4ec1-86f2-43d3bccbc49c
CurrentServiceObjectiveName   : Basic
RequestedServiceObjectiveId   : dd6d99bb-f193-4ec1-86f2-43d3bccbc49c
RequestedServiceObjectiveName :
ElasticPoolName               :
EarliestRestoreDate           : 12/22/2017 1:48:41 PM
Tags                          :
ResourceId                    : /subscriptions/bf64f3c6-6e64-48c5-a7cc-6c35b4f9aebf/resourceGroups/toystore/providers/Microsoft.Sql/servers/toyfactory/databases/toystore
                                _splitmerge
CreateMode                    :


Sending split request
PS C:\Code\Lesson06\Splitting> TerminatingError(Invoke-WebRequest): "The remote name could not be resolved: 'http'"
>> TerminatingError(Invoke-WebRequest): "The remote name could not be resolved: 'http'"
>> TerminatingError(Invoke-WebRequest): "The remote name could not be resolved: 'http'"
>> TerminatingError(Invoke-WebRequest): "The remote name could not be resolved: 'http'"
Invoke-WebRequest : The remote name could not be resolved: 'http'
At C:\Code\Lesson06\Splitting\SplitMerge\SplitMerge.psm1:86 char:13
+     $body = Invoke-WebRequest @certificate $SplitMergeServiceEndpoint ...
+             ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : InvalidOperation: (System.Net.HttpWebRequest:HttpWebRequest) [Invoke-WebRequest], WebException
    + FullyQualifiedErrorId : WebCmdletWebResponseException,Microsoft.PowerShell.Commands.InvokeWebRequestCommand

PS C:\Code\Lesson06\Splitting> .\SplitToyStoreShard.ps1 -ResourceGroup toystore -SqlServer toyfactory -UserName sqladmin -Password Packt@pub2 -SplitMergeDatabase toystore_splitmerge -SplitMergeServiceEndpoint "https://4a90f0d8bfee4475b6942559d27f0305.cloudapp.net/.cloudapp.net/" -ShardMapManagerDatabaseName toystore_SMM -Shard2 toystore_900 -ShardMapName toystorerangemap -SplitRangeLow 800 -SplitRangeHigh 1000 -SplitValue 900 
Transcript started, output file is C:\Code\Lesson06\Splitting\Log\SplitToyStoreShard.txt
WARNING: The output object type of this cmdlet will be modified in a future release.


ResourceGroupName : toystore
Location          : eastus2
ProvisioningState : Succeeded
Tags              :
ResourceId        : /subscriptions/bf64f3c6-6e64-48c5-a7cc-6c35b4f9aebf/resourceGroups/toystore



ResourceGroupName        : toystore
ServerName               : toyfactory
Location                 : East US 2
SqlAdministratorLogin    : sqladmin
SqlAdministratorPassword :
ServerVersion            : 12.0
Tags                     :



ResourceGroupName             : toystore
ServerName                    : toyfactory
DatabaseName                  : toystore_splitmerge
Location                      : East US 2
DatabaseId                    : 0c8a58bf-7e77-40be-9bb5-bbf3fb976af6
Edition                       : Basic
CollationName                 : SQL_Latin1_General_CP1_CI_AS
CatalogCollation              :
MaxSizeBytes                  : 2147483648
Status                        : Online
CreationDate                  : 12/22/2017 1:17:29 PM
CurrentServiceObjectiveId     : dd6d99bb-f193-4ec1-86f2-43d3bccbc49c
CurrentServiceObjectiveName   : Basic
RequestedServiceObjectiveId   : dd6d99bb-f193-4ec1-86f2-43d3bccbc49c
RequestedServiceObjectiveName :
ElasticPoolName               :
EarliestRestoreDate           : 12/22/2017 1:48:41 PM
Tags                          :
ResourceId                    : /subscriptions/bf64f3c6-6e64-48c5-a7cc-6c35b4f9aebf/resourceGroups/toystore/providers/Microsoft.Sql/servers/toyfactory/databases/toystore
                                _splitmerge
CreateMode                    :


Sending split request
PS C:\Code\Lesson06\Splitting> TerminatingError(Invoke-WebRequest): "Server Error in '/' Application.


The resource cannot be found. 
Description: HTTP 404. The resource you are looking for (or one of its dependencies) could have been removed, had its name changed, or is temporarily unavailable.  Please review the following URL and make sure that it is spelled correctly. 

Requested URL: /.cloudapp.net/"
>> TerminatingError(Invoke-WebRequest): "Server Error in '/' Application.


The resource cannot be found. 
Description: HTTP 404. The resource you are looking for (or one of its dependencies) could have been removed, had its name changed, or is temporarily unavailable.  Please review the following URL and make sure that it is spelled correctly. 

Requested URL: /.cloudapp.net/"
>> TerminatingError(Invoke-WebRequest): "Server Error in '/' Application.


The resource cannot be found. 
Description: HTTP 404. The resource you are looking for (or one of its dependencies) could have been removed, had its name changed, or is temporarily unavailable.  Please review the following URL and make sure that it is spelled correctly. 

Requested URL: /.cloudapp.net/"
>> TerminatingError(Invoke-WebRequest): "Server Error in '/' Application.


The resource cannot be found. 
Description: HTTP 404. The resource you are looking for (or one of its dependencies) could have been removed, had its name changed, or is temporarily unavailable.  Please review the following URL and make sure that it is spelled correctly. 

Requested URL: /.cloudapp.net/"
Invoke-WebRequest : Server Error in '/' Application.


The resource cannot be found.
Description: HTTP 404. The resource you are looking for (or one of its dependencies) could have been removed, had its name changed, or is temporarily unavailable.
Please review the following URL and make sure that it is spelled correctly.

Requested URL: /.cloudapp.net/
At C:\Code\Lesson06\Splitting\SplitMerge\SplitMerge.psm1:86 char:13
+     $body = Invoke-WebRequest @certificate $SplitMergeServiceEndpoint ...
+             ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : InvalidOperation: (System.Net.HttpWebRequest:HttpWebRequest) [Invoke-WebRequest], WebException
    + FullyQualifiedErrorId : WebCmdletWebResponseException,Microsoft.PowerShell.Commands.InvokeWebRequestCommand
PS C:\Code\Lesson06\Splitting> .\SplitToyStoreShard.ps1 -ResourceGroup toystore -SqlServer toyfactory -UserName sqladmin -Password Packt@pub2 -SplitMergeDatabase toystore_splitmerge -SplitMergeServiceEndpoint "https://4a90f0d8bfee4475b6942559d27f0305.cloudapp.net/.cloudapp.net/" -ShardMapManagerDatabaseName toystore_SMM -Shard2 toystore_900 -ShardMapName toystorerangemap -SplitRangeLow 800 -SplitRangeHigh 1000 -SplitValue 900 
Transcript started, output file is C:\Code\Lesson06\Splitting\Log\SplitToyStoreShard.txt
WARNING: The output object type of this cmdlet will be modified in a future release.


ResourceGroupName : toystore
Location          : eastus2
ProvisioningState : Succeeded
Tags              :
ResourceId        : /subscriptions/bf64f3c6-6e64-48c5-a7cc-6c35b4f9aebf/resourceGroups/toystore



ResourceGroupName        : toystore
ServerName               : toyfactory
Location                 : East US 2
SqlAdministratorLogin    : sqladmin
SqlAdministratorPassword :
ServerVersion            : 12.0
Tags                     :



ResourceGroupName             : toystore
ServerName                    : toyfactory
DatabaseName                  : toystore_splitmerge
Location                      : East US 2
DatabaseId                    : 0c8a58bf-7e77-40be-9bb5-bbf3fb976af6
Edition                       : Basic
CollationName                 : SQL_Latin1_General_CP1_CI_AS
CatalogCollation              :
MaxSizeBytes                  : 2147483648
Status                        : Online
CreationDate                  : 12/22/2017 1:17:29 PM
CurrentServiceObjectiveId     : dd6d99bb-f193-4ec1-86f2-43d3bccbc49c
CurrentServiceObjectiveName   : Basic
RequestedServiceObjectiveId   : dd6d99bb-f193-4ec1-86f2-43d3bccbc49c
RequestedServiceObjectiveName :
ElasticPoolName               :
EarliestRestoreDate           : 12/22/2017 1:48:41 PM
Tags                          :
ResourceId                    : /subscriptions/bf64f3c6-6e64-48c5-a7cc-6c35b4f9aebf/resourceGroups/toystore/providers/Microsoft.Sql/servers/toyfactory/databases/toystore
                                _splitmerge
CreateMode                    :


Sending split request
PS C:\Code\Lesson06\Splitting> TerminatingError(Invoke-WebRequest): "Server Error in '/' Application.


The resource cannot be found. 
Description: HTTP 404. The resource you are looking for (or one of its dependencies) could have been removed, had its name changed, or is temporarily unavailable.  Please review the following URL and make sure that it is spelled correctly. 

Requested URL: /.cloudapp.net/"
>> TerminatingError(Invoke-WebRequest): "Server Error in '/' Application.


The resource cannot be found. 
Description: HTTP 404. The resource you are looking for (or one of its dependencies) could have been removed, had its name changed, or is temporarily unavailable.  Please review the following URL and make sure that it is spelled correctly. 

Requested URL: /.cloudapp.net/"
>> TerminatingError(Invoke-WebRequest): "Server Error in '/' Application.


The resource cannot be found. 
Description: HTTP 404. The resource you are looking for (or one of its dependencies) could have been removed, had its name changed, or is temporarily unavailable.  Please review the following URL and make sure that it is spelled correctly. 

Requested URL: /.cloudapp.net/"
>> TerminatingError(Invoke-WebRequest): "Server Error in '/' Application.


The resource cannot be found. 
Description: HTTP 404. The resource you are looking for (or one of its dependencies) could have been removed, had its name changed, or is temporarily unavailable.  Please review the following URL and make sure that it is spelled correctly. 

Requested URL: /.cloudapp.net/"
Invoke-WebRequest : Server Error in '/' Application.


The resource cannot be found.
Description: HTTP 404. The resource you are looking for (or one of its dependencies) could have been removed, had its name changed, or is temporarily unavailable.
Please review the following URL and make sure that it is spelled correctly.

Requested URL: /.cloudapp.net/
At C:\Code\Lesson06\Splitting\SplitMerge\SplitMerge.psm1:86 char:13
+     $body = Invoke-WebRequest @certificate $SplitMergeServiceEndpoint ...
+             ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : InvalidOperation: (System.Net.HttpWebRequest:HttpWebRequest) [Invoke-WebRequest], WebException
    + FullyQualifiedErrorId : WebCmdletWebResponseException,Microsoft.PowerShell.Commands.InvokeWebRequestCommand
PS C:\Code\Lesson06\Splitting> .\SplitToyStoreShard.ps1 -ResourceGroup toystore -SqlServer toyfactory -UserName sqladmin -Password Packt@pub2 -SplitMergeDatabase toystore_splitmerge -SplitMergeServiceEndpoint "https://splitmerge.cloudapp.net/" -ShardMapManagerDatabaseName toystore_SMM -Shard2 toystore_900 -ShardMapName toystorerangemap -SplitRangeLow 800 -SplitRangeHigh 1000 -SplitValue 900 
Transcript started, output file is C:\Code\Lesson06\Splitting\Log\SplitToyStoreShard.txt
WARNING: The output object type of this cmdlet will be modified in a future release.


ResourceGroupName : toystore
Location          : eastus2
ProvisioningState : Succeeded
Tags              :
ResourceId        : /subscriptions/bf64f3c6-6e64-48c5-a7cc-6c35b4f9aebf/resourceGroups/toystore



ResourceGroupName        : toystore
ServerName               : toyfactory
Location                 : East US 2
SqlAdministratorLogin    : sqladmin
SqlAdministratorPassword :
ServerVersion            : 12.0
Tags                     :



ResourceGroupName             : toystore
ServerName                    : toyfactory
DatabaseName                  : toystore_splitmerge
Location                      : East US 2
DatabaseId                    : 0c8a58bf-7e77-40be-9bb5-bbf3fb976af6
Edition                       : Basic
CollationName                 : SQL_Latin1_General_CP1_CI_AS
CatalogCollation              :
MaxSizeBytes                  : 2147483648
Status                        : Online
CreationDate                  : 12/22/2017 1:17:29 PM
CurrentServiceObjectiveId     : dd6d99bb-f193-4ec1-86f2-43d3bccbc49c
CurrentServiceObjectiveName   : Basic
RequestedServiceObjectiveId   : dd6d99bb-f193-4ec1-86f2-43d3bccbc49c
RequestedServiceObjectiveName :
ElasticPoolName               :
EarliestRestoreDate           : 12/22/2017 1:48:41 PM
Tags                          :
ResourceId                    : /subscriptions/bf64f3c6-6e64-48c5-a7cc-6c35b4f9aebf/resourceGroups/toystore/providers/Microsoft.Sql/servers/toyfactory/databases/toystore
                                _splitmerge
CreateMode                    :


Sending split request
PS C:\Code\Lesson06\Splitting> TerminatingError(Invoke-WebRequest): "The remote name could not be resolved: 'splitmerge.cloudapp.net'"
>> TerminatingError(Invoke-WebRequest): "The remote name could not be resolved: 'splitmerge.cloudapp.net'"
>> TerminatingError(Invoke-WebRequest): "The remote name could not be resolved: 'splitmerge.cloudapp.net'"
>> TerminatingError(Invoke-WebRequest): "The remote name could not be resolved: 'splitmerge.cloudapp.net'"
Invoke-WebRequest : The remote name could not be resolved: 'splitmerge.cloudapp.net'
At C:\Code\Lesson06\Splitting\SplitMerge\SplitMerge.psm1:86 char:13
+     $body = Invoke-WebRequest @certificate $SplitMergeServiceEndpoint ...
+             ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : InvalidOperation: (System.Net.HttpWebRequest:HttpWebRequest) [Invoke-WebRequest], WebException
    + FullyQualifiedErrorId : WebCmdletWebResponseException,Microsoft.PowerShell.Commands.InvokeWebRequestCommand

PS C:\Code\Lesson06\Splitting> .\SplitToyStoreShard.ps1 -ResourceGroup toystore -SqlServer toyfactory -UserName sqladmin -Password Packt@pub2 -SplitMergeDatabase toystore_splitmerge -SplitMergeServiceEndpoint "https://4a90f0d8bfee4475b6942559d27f0305.cloudapp.net/" -ShardMapManagerDatabaseName toystore_SMM -Shard2 toystore_900 -ShardMapName toystorerangemap -SplitRangeLow 800 -SplitRangeHigh 1000 -SplitValue 900 
Transcript started, output file is C:\Code\Lesson06\Splitting\Log\SplitToyStoreShard.txt
WARNING: The output object type of this cmdlet will be modified in a future release.


ResourceGroupName : toystore
Location          : eastus2
ProvisioningState : Succeeded
Tags              :
ResourceId        : /subscriptions/bf64f3c6-6e64-48c5-a7cc-6c35b4f9aebf/resourceGroups/toystore



ResourceGroupName        : toystore
ServerName               : toyfactory
Location                 : East US 2
SqlAdministratorLogin    : sqladmin
SqlAdministratorPassword :
ServerVersion            : 12.0
Tags                     :



ResourceGroupName             : toystore
ServerName                    : toyfactory
DatabaseName                  : toystore_splitmerge
Location                      : East US 2
DatabaseId                    : 0c8a58bf-7e77-40be-9bb5-bbf3fb976af6
Edition                       : Basic
CollationName                 : SQL_Latin1_General_CP1_CI_AS
CatalogCollation              :
MaxSizeBytes                  : 2147483648
Status                        : Online
CreationDate                  : 12/22/2017 1:17:29 PM
CurrentServiceObjectiveId     : dd6d99bb-f193-4ec1-86f2-43d3bccbc49c
CurrentServiceObjectiveName   : Basic
RequestedServiceObjectiveId   : dd6d99bb-f193-4ec1-86f2-43d3bccbc49c
RequestedServiceObjectiveName :
ElasticPoolName               :
EarliestRestoreDate           : 12/22/2017 1:48:41 PM
Tags                          :
ResourceId                    : /subscriptions/bf64f3c6-6e64-48c5-a7cc-6c35b4f9aebf/resourceGroups/toystore/providers/Microsoft.Sql/servers/toyfactory/databases/toystore
                                _splitmerge
CreateMode                    :


Sending split request
PS C:\Code\Lesson06\Splitting> TerminatingError(Invoke-WebRequest): "Error.
An error occurred while processing your request."
>> TerminatingError(Invoke-WebRequest): "Error.
An error occurred while processing your request."
>> TerminatingError(Invoke-WebRequest): "Error.
An error occurred while processing your request."
>> TerminatingError(Invoke-WebRequest): "Error.
An error occurred while processing your request."
Invoke-WebRequest : Error.
An error occurred while processing your request.
At C:\Code\Lesson06\Splitting\SplitMerge\SplitMerge.psm1:86 char:13
+     $body = Invoke-WebRequest @certificate $SplitMergeServiceEndpoint ...
+             ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : InvalidOperation: (System.Net.HttpWebRequest:HttpWebRequest) [Invoke-WebRequest], WebException
    + FullyQualifiedErrorId : WebCmdletWebResponseException,Microsoft.PowerShell.Commands.InvokeWebRequestCommand
PS C:\Code\Lesson06\Splitting> .\SplitToyStoreShard.ps1 -ResourceGroup toystore -SqlServer toyfactory -UserName sqladmin -Password Packt@pub2 -SplitMergeDatabase toystore_splitmerge -SplitMergeServiceEndpoint "https://4a90f0d8bfee4475b6942559d27f0305.cloudapp.net/" -ShardMapManagerDatabaseName toystore_SMM -Shard2 toystore_900 -ShardMapName toystorerangemap -SplitRangeLow 800 -SplitRangeHigh 1000 -SplitValue 900 -CertificateThumbprint '7000689A8517A0FE97BD0414C501E586DDF9BC3F'
Transcript started, output file is C:\Code\Lesson06\Splitting\Log\SplitToyStoreShard.txt
WARNING: The output object type of this cmdlet will be modified in a future release.


ResourceGroupName : toystore
Location          : eastus2
ProvisioningState : Succeeded
Tags              :
ResourceId        : /subscriptions/bf64f3c6-6e64-48c5-a7cc-6c35b4f9aebf/resourceGroups/toystore



ResourceGroupName        : toystore
ServerName               : toyfactory
Location                 : East US 2
SqlAdministratorLogin    : sqladmin
SqlAdministratorPassword :
ServerVersion            : 12.0
Tags                     :



ResourceGroupName             : toystore
ServerName                    : toyfactory
DatabaseName                  : toystore_splitmerge
Location                      : East US 2
DatabaseId                    : 0c8a58bf-7e77-40be-9bb5-bbf3fb976af6
Edition                       : Basic
CollationName                 : SQL_Latin1_General_CP1_CI_AS
CatalogCollation              :
MaxSizeBytes                  : 2147483648
Status                        : Online
CreationDate                  : 12/22/2017 1:17:29 PM
CurrentServiceObjectiveId     : dd6d99bb-f193-4ec1-86f2-43d3bccbc49c
CurrentServiceObjectiveName   : Basic
RequestedServiceObjectiveId   : dd6d99bb-f193-4ec1-86f2-43d3bccbc49c
RequestedServiceObjectiveName :
ElasticPoolName               :
EarliestRestoreDate           : 12/22/2017 1:48:41 PM
Tags                          :
ResourceId                    : /subscriptions/bf64f3c6-6e64-48c5-a7cc-6c35b4f9aebf/resourceGroups/toystore/providers/Microsoft.Sql/servers/toyfactory/databases/toystore
                                _splitmerge
CreateMode                    :


Sending split request
PS C:\Code\Lesson06\Splitting> TerminatingError(Invoke-WebRequest): "Unable to retrieve certificates because the thumbprint is not valid. Verify the thumbprint and retry. "
>> TerminatingError(Invoke-WebRequest): "Unable to retrieve certificates because the thumbprint is not valid. Verify the thumbprint and retry. "
>> TerminatingError(Invoke-WebRequest): "Unable to retrieve certificates because the thumbprint is not valid. Verify the thumbprint and retry. "
>> TerminatingError(Invoke-WebRequest): "Unable to retrieve certificates because the thumbprint is not valid. Verify the thumbprint and retry. "
Invoke-WebRequest : Unable to retrieve certificates because the thumbprint is not valid. Verify the thumbprint and retry.
At C:\Code\Lesson06\Splitting\SplitMerge\SplitMerge.psm1:86 char:13
+     $body = Invoke-WebRequest @certificate $SplitMergeServiceEndpoint ...
+             ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : SecurityError: (:) [Invoke-WebRequest], CryptographicException
    + FullyQualifiedErrorId : WebCmdletCertificateException,Microsoft.PowerShell.Commands.InvokeWebRequestCommand

PS C:\Code\Lesson06\Splitting> .\SplitToyStoreShard.ps1 -ResourceGroup toystore -SqlServer toyfactory -UserName sqladmin -Password Packt@pub2 -SplitMergeDatabase toystore_splitmerge -SplitMergeServiceEndpoint "https://4a90f0d8bfee4475b6942559d27f0305.cloudapp.net/" -ShardMapManagerDatabaseName toystore_SMM -Shard2 toystore_900 -ShardMapName toystorerangemap -SplitRangeLow 800 -SplitRangeHigh 1000 -SplitValue 900
Transcript started, output file is C:\Code\Lesson06\Splitting\Log\SplitToyStoreShard.txt
WARNING: The output object type of this cmdlet will be modified in a future release.


ResourceGroupName : toystore
Location          : eastus2
ProvisioningState : Succeeded
Tags              :
ResourceId        : /subscriptions/bf64f3c6-6e64-48c5-a7cc-6c35b4f9aebf/resourceGroups/toystore



ResourceGroupName        : toystore
ServerName               : toyfactory
Location                 : East US 2
SqlAdministratorLogin    : sqladmin
SqlAdministratorPassword :
ServerVersion            : 12.0
Tags                     :



ResourceGroupName             : toystore
ServerName                    : toyfactory
DatabaseName                  : toystore_splitmerge
Location                      : East US 2
DatabaseId                    : 0c8a58bf-7e77-40be-9bb5-bbf3fb976af6
Edition                       : Basic
CollationName                 : SQL_Latin1_General_CP1_CI_AS
CatalogCollation              :
MaxSizeBytes                  : 2147483648
Status                        : Online
CreationDate                  : 12/22/2017 1:17:29 PM
CurrentServiceObjectiveId     : dd6d99bb-f193-4ec1-86f2-43d3bccbc49c
CurrentServiceObjectiveName   : Basic
RequestedServiceObjectiveId   : dd6d99bb-f193-4ec1-86f2-43d3bccbc49c
RequestedServiceObjectiveName :
ElasticPoolName               :
EarliestRestoreDate           : 12/22/2017 1:48:41 PM
Tags                          :
ResourceId                    : /subscriptions/bf64f3c6-6e64-48c5-a7cc-6c35b4f9aebf/resourceGroups/toystore/providers/Microsoft.Sql/servers/toyfactory/databases/toystore
                                _splitmerge
CreateMode                    :


Sending split request
PS C:\Code\Lesson06\Splitting> TerminatingError(Invoke-WebRequest): "The remote name could not be resolved: '4a90f0d8bfee4475b6942559d27f0305.cloudapp.net'"
>> TerminatingError(Invoke-WebRequest): "The remote name could not be resolved: '4a90f0d8bfee4475b6942559d27f0305.cloudapp.net'"
>> TerminatingError(Invoke-WebRequest): "The remote name could not be resolved: '4a90f0d8bfee4475b6942559d27f0305.cloudapp.net'"
>> TerminatingError(Invoke-WebRequest): "The remote name could not be resolved: '4a90f0d8bfee4475b6942559d27f0305.cloudapp.net'"
Invoke-WebRequest : The remote name could not be resolved: '4a90f0d8bfee4475b6942559d27f0305.cloudapp.net'
At C:\Code\Lesson06\Splitting\SplitMerge\SplitMerge.psm1:86 char:13
+     $body = Invoke-WebRequest @certificate $SplitMergeServiceEndpoint ...
+             ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : InvalidOperation: (System.Net.HttpWebRequest:HttpWebRequest) [Invoke-WebRequest], WebException
    + FullyQualifiedErrorId : WebCmdletWebResponseException,Microsoft.PowerShell.Commands.InvokeWebRequestCommand

PS C:\Code\Lesson06\Splitting> .\SplitToyStoreShard.ps1 -ResourceGroup toystore -SqlServer toyfactory -UserName sqladmin -Password Packt@pub2 -SplitMergeDatabase toystore_splitmerge -SplitMergeServiceEndpoint "https://splitmerge.cloudapp.net/" -ShardMapManagerDatabaseName toystore_SMM -Shard2 toystore_900 -ShardMapName toystorerangemap -SplitRangeLow 800 -SplitRangeHigh 1000 -SplitValue 900
Transcript started, output file is C:\Code\Lesson06\Splitting\Log\SplitToyStoreShard.txt
WARNING: The output object type of this cmdlet will be modified in a future release.


ResourceGroupName : toystore
Location          : eastus2
ProvisioningState : Succeeded
Tags              :
ResourceId        : /subscriptions/bf64f3c6-6e64-48c5-a7cc-6c35b4f9aebf/resourceGroups/toystore



ResourceGroupName        : toystore
ServerName               : toyfactory
Location                 : East US 2
SqlAdministratorLogin    : sqladmin
SqlAdministratorPassword :
ServerVersion            : 12.0
Tags                     :



ResourceGroupName             : toystore
ServerName                    : toyfactory
DatabaseName                  : toystore_splitmerge
Location                      : East US 2
DatabaseId                    : 0c8a58bf-7e77-40be-9bb5-bbf3fb976af6
Edition                       : Basic
CollationName                 : SQL_Latin1_General_CP1_CI_AS
CatalogCollation              :
MaxSizeBytes                  : 2147483648
Status                        : Online
CreationDate                  : 12/22/2017 1:17:29 PM
CurrentServiceObjectiveId     : dd6d99bb-f193-4ec1-86f2-43d3bccbc49c
CurrentServiceObjectiveName   : Basic
RequestedServiceObjectiveId   : dd6d99bb-f193-4ec1-86f2-43d3bccbc49c
RequestedServiceObjectiveName :
ElasticPoolName               :
EarliestRestoreDate           : 12/22/2017 1:48:41 PM
Tags                          :
ResourceId                    : /subscriptions/bf64f3c6-6e64-48c5-a7cc-6c35b4f9aebf/resourceGroups/toystore/providers/Microsoft.Sql/servers/toyfactory/databases/toystore
                                _splitmerge
CreateMode                    :


Sending split request
Began split operation with id f3581c28-6ae6-41ef-8cd4-5f79500c8596
Polling request status. Press Ctrl-C to end
Progress: 0% | Status: Queued | Details: [Informational] Operation has been queued.
Progress: 100% | Status: Failed | Details: [Error] Failed to process request. Microsoft.Azure.SqlDatabase.ElasticScale.SplitMerge.Worker.InvalidSplitMergeOperationException: The source mapping could not be found in the shard map 'toystorerangemap' using the lookup key '900'. ---> Microsoft.Azure.SqlDatabase.ElasticScale.ShardManagement.ShardManagementException: Mapping containing the given key value could not be located in the shard map 'toystorerangemap'. Error occurred while executing stored procedure '__ShardManagement.spFindShardMappingByKeyGlobal' for operation 'Lookup'.
   at Microsoft.Azure.SqlDatabase.ElasticScale.ShardManagement.RangeShardMapper`1.Lookup(TKey key, Boolean useCache)
   at Microsoft.Azure.SqlDatabase.ElasticScale.ShardManagement.RangeShardMap`1.GetMappingForKey(TKey key)
   at Microsoft.Azure.SqlDatabase.ElasticScale.SplitMerge.Worker.ShardMapManagerAbstraction.RangeShardMapAbstraction`1.GetMappingForKey(T key) in d:\_Bld\8089\4133\Sources\Src\ShardSplitMerge\FsmWorkerRole\ShardMapManagerAbstraction\ShardMap.cs:line 299
   at Microsoft.Azure.SqlDatabase.ElasticScale.SplitMerge.Worker.SplitMergeService.DoSplitMergeInternal[T](SplitMergeRequestContext`1 requestContext) in d:\_Bld\8089\4133\Sources\Src\ShardSplitMerge\FsmWorkerRole\Service\SplitMergeService.cs:line 455
   --- End of inner exception stack trace ---
   at Microsoft.Azure.SqlDatabase.ElasticScale.SplitMerge.Worker.SplitMergeService.DoSplitMergeInternal[T](SplitMergeRequestContext`1 requestContext) in d:\_Bld\8089\4133\Sources\Src\ShardSplitMerge\FsmWorkerRole\Service\SplitMergeService.cs:line 631
   at Microsoft.Azure.SqlDatabase.ElasticScale.SplitMerge.Worker.SplitMergeService.ExecuteOne(SqlMessageFetcher sqlMessageFetcher) in d:\_Bld\8089\4133\Sources\Src\ShardSplitMerge\FsmWorkerRole\Service\SplitMergeService.cs:line 377
   at Microsoft.Azure.SqlDatabase.ElasticScale.SplitMerge.Worker.SplitMergeService.TryExecuteOne(SqlMessageFetcher sqlMessageFetcher, MessageDeletionStrategy messageDeletionStrategy) in d:\_Bld\8089\4133\Sources\Src\ShardSplitMerge\FsmWorkerRole\Service\SplitMergeService.cs:line 212
MessageOperationId: f3581c28-6ae6-41ef-8cd4-5f79500c8596
ErrorCode: SourceMappingNotFound
PS C:\Code\Lesson06\Splitting> TerminatingError(): "[Error] Failed to process request. Microsoft.Azure.SqlDatabase.ElasticScale.SplitMerge.Worker.InvalidSplitMergeOperationException: The source mapping could not be found in the shard map 'toystorerangemap' using the lookup key '900'. ---> Microsoft.Azure.SqlDatabase.ElasticScale.ShardManagement.ShardManagementException: Mapping containing the given key value could not be located in the shard map 'toystorerangemap'. Error occurred while executing stored procedure '__ShardManagement.spFindShardMappingByKeyGlobal' for operation 'Lookup'.
   at Microsoft.Azure.SqlDatabase.ElasticScale.ShardManagement.RangeShardMapper`1.Lookup(TKey key, Boolean useCache)
   at Microsoft.Azure.SqlDatabase.ElasticScale.ShardManagement.RangeShardMap`1.GetMappingForKey(TKey key)
   at Microsoft.Azure.SqlDatabase.ElasticScale.SplitMerge.Worker.ShardMapManagerAbstraction.RangeShardMapAbstraction`1.GetMappingForKey(T key) in d:\_Bld\8089\4133\Sources\Src\ShardSplitMerge\FsmWorkerRole\ShardMapManagerAbstraction\ShardMap.cs:line 299
   at Microsoft.Azure.SqlDatabase.ElasticScale.SplitMerge.Worker.SplitMergeService.DoSplitMergeInternal[T](SplitMergeRequestContext`1 requestContext) in d:\_Bld\8089\4133\Sources\Src\ShardSplitMerge\FsmWorkerRole\Service\SplitMergeService.cs:line 455
   --- End of inner exception stack trace ---
   at Microsoft.Azure.SqlDatabase.ElasticScale.SplitMerge.Worker.SplitMergeService.DoSplitMergeInternal[T](SplitMergeRequestContext`1 requestContext) in d:\_Bld\8089\4133\Sources\Src\ShardSplitMerge\FsmWorkerRole\Service\SplitMergeService.cs:line 631
   at Microsoft.Azure.SqlDatabase.ElasticScale.SplitMerge.Worker.SplitMergeService.ExecuteOne(SqlMessageFetcher sqlMessageFetcher) in d:\_Bld\8089\4133\Sources\Src\ShardSplitMerge\FsmWorkerRole\Service\SplitMergeService.cs:line 377
   at Microsoft.Azure.SqlDatabase.ElasticScale.SplitMerge.Worker.SplitMergeService.TryExecuteOne(SqlMessageFetcher sqlMessageFetcher, MessageDeletionStrategy messageDeletionStrategy) in d:\_Bld\8089\4133\Sources\Src\ShardSplitMerge\FsmWorkerRole\Service\SplitMergeService.cs:line 212
MessageOperationId: f3581c28-6ae6-41ef-8cd4-5f79500c8596
ErrorCode: SourceMappingNotFound"
>> TerminatingError(): "[Error] Failed to process request. Microsoft.Azure.SqlDatabase.ElasticScale.SplitMerge.Worker.InvalidSplitMergeOperationException: The source mapping could not be found in the shard map 'toystorerangemap' using the lookup key '900'. ---> Microsoft.Azure.SqlDatabase.ElasticScale.ShardManagement.ShardManagementException: Mapping containing the given key value could not be located in the shard map 'toystorerangemap'. Error occurred while executing stored procedure '__ShardManagement.spFindShardMappingByKeyGlobal' for operation 'Lookup'.
   at Microsoft.Azure.SqlDatabase.ElasticScale.ShardManagement.RangeShardMapper`1.Lookup(TKey key, Boolean useCache)
   at Microsoft.Azure.SqlDatabase.ElasticScale.ShardManagement.RangeShardMap`1.GetMappingForKey(TKey key)
   at Microsoft.Azure.SqlDatabase.ElasticScale.SplitMerge.Worker.ShardMapManagerAbstraction.RangeShardMapAbstraction`1.GetMappingForKey(T key) in d:\_Bld\8089\4133\Sources\Src\ShardSplitMerge\FsmWorkerRole\ShardMapManagerAbstraction\ShardMap.cs:line 299
   at Microsoft.Azure.SqlDatabase.ElasticScale.SplitMerge.Worker.SplitMergeService.DoSplitMergeInternal[T](SplitMergeRequestContext`1 requestContext) in d:\_Bld\8089\4133\Sources\Src\ShardSplitMerge\FsmWorkerRole\Service\SplitMergeService.cs:line 455
   --- End of inner exception stack trace ---
   at Microsoft.Azure.SqlDatabase.ElasticScale.SplitMerge.Worker.SplitMergeService.DoSplitMergeInternal[T](SplitMergeRequestContext`1 requestContext) in d:\_Bld\8089\4133\Sources\Src\ShardSplitMerge\FsmWorkerRole\Service\SplitMergeService.cs:line 631
   at Microsoft.Azure.SqlDatabase.ElasticScale.SplitMerge.Worker.SplitMergeService.ExecuteOne(SqlMessageFetcher sqlMessageFetcher) in d:\_Bld\8089\4133\Sources\Src\ShardSplitMerge\FsmWorkerRole\Service\SplitMergeService.cs:line 377
   at Microsoft.Azure.SqlDatabase.ElasticScale.SplitMerge.Worker.SplitMergeService.TryExecuteOne(SqlMessageFetcher sqlMessageFetcher, MessageDeletionStrategy messageDeletionStrategy) in d:\_Bld\8089\4133\Sources\Src\ShardSplitMerge\FsmWorkerRole\Service\SplitMergeService.cs:line 212
MessageOperationId: f3581c28-6ae6-41ef-8cd4-5f79500c8596
ErrorCode: SourceMappingNotFound"
>> TerminatingError(): "[Error] Failed to process request. Microsoft.Azure.SqlDatabase.ElasticScale.SplitMerge.Worker.InvalidSplitMergeOperationException: The source mapping could not be found in the shard map 'toystorerangemap' using the lookup key '900'. ---> Microsoft.Azure.SqlDatabase.ElasticScale.ShardManagement.ShardManagementException: Mapping containing the given key value could not be located in the shard map 'toystorerangemap'. Error occurred while executing stored procedure '__ShardManagement.spFindShardMappingByKeyGlobal' for operation 'Lookup'.
   at Microsoft.Azure.SqlDatabase.ElasticScale.ShardManagement.RangeShardMapper`1.Lookup(TKey key, Boolean useCache)
   at Microsoft.Azure.SqlDatabase.ElasticScale.ShardManagement.RangeShardMap`1.GetMappingForKey(TKey key)
   at Microsoft.Azure.SqlDatabase.ElasticScale.SplitMerge.Worker.ShardMapManagerAbstraction.RangeShardMapAbstraction`1.GetMappingForKey(T key) in d:\_Bld\8089\4133\Sources\Src\ShardSplitMerge\FsmWorkerRole\ShardMapManagerAbstraction\ShardMap.cs:line 299
   at Microsoft.Azure.SqlDatabase.ElasticScale.SplitMerge.Worker.SplitMergeService.DoSplitMergeInternal[T](SplitMergeRequestContext`1 requestContext) in d:\_Bld\8089\4133\Sources\Src\ShardSplitMerge\FsmWorkerRole\Service\SplitMergeService.cs:line 455
   --- End of inner exception stack trace ---
   at Microsoft.Azure.SqlDatabase.ElasticScale.SplitMerge.Worker.SplitMergeService.DoSplitMergeInternal[T](SplitMergeRequestContext`1 requestContext) in d:\_Bld\8089\4133\Sources\Src\ShardSplitMerge\FsmWorkerRole\Service\SplitMergeService.cs:line 631
   at Microsoft.Azure.SqlDatabase.ElasticScale.SplitMerge.Worker.SplitMergeService.ExecuteOne(SqlMessageFetcher sqlMessageFetcher) in d:\_Bld\8089\4133\Sources\Src\ShardSplitMerge\FsmWorkerRole\Service\SplitMergeService.cs:line 377
   at Microsoft.Azure.SqlDatabase.ElasticScale.SplitMerge.Worker.SplitMergeService.TryExecuteOne(SqlMessageFetcher sqlMessageFetcher, MessageDeletionStrategy messageDeletionStrategy) in d:\_Bld\8089\4133\Sources\Src\ShardSplitMerge\FsmWorkerRole\Service\SplitMergeService.cs:line 212
MessageOperationId: f3581c28-6ae6-41ef-8cd4-5f79500c8596
ErrorCode: SourceMappingNotFound"
[Error] Failed to process request. Microsoft.Azure.SqlDatabase.ElasticScale.SplitMerge.Worker.InvalidSplitMergeOperationException: The source mapping could not be found
in the shard map 'toystorerangemap' using the lookup key '900'. ---> Microsoft.Azure.SqlDatabase.ElasticScale.ShardManagement.ShardManagementException: Mapping
containing the given key value could not be located in the shard map 'toystorerangemap'. Error occurred while executing stored procedure
'__ShardManagement.spFindShardMappingByKeyGlobal' for operation 'Lookup'.
   at Microsoft.Azure.SqlDatabase.ElasticScale.ShardManagement.RangeShardMapper`1.Lookup(TKey key, Boolean useCache)
   at Microsoft.Azure.SqlDatabase.ElasticScale.ShardManagement.RangeShardMap`1.GetMappingForKey(TKey key)
   at Microsoft.Azure.SqlDatabase.ElasticScale.SplitMerge.Worker.ShardMapManagerAbstraction.RangeShardMapAbstraction`1.GetMappingForKey(T key) in
d:\_Bld\8089\4133\Sources\Src\ShardSplitMerge\FsmWorkerRole\ShardMapManagerAbstraction\ShardMap.cs:line 299
   at Microsoft.Azure.SqlDatabase.ElasticScale.SplitMerge.Worker.SplitMergeService.DoSplitMergeInternal[T](SplitMergeRequestContext`1 requestContext) in
d:\_Bld\8089\4133\Sources\Src\ShardSplitMerge\FsmWorkerRole\Service\SplitMergeService.cs:line 455
   --- End of inner exception stack trace ---
   at Microsoft.Azure.SqlDatabase.ElasticScale.SplitMerge.Worker.SplitMergeService.DoSplitMergeInternal[T](SplitMergeRequestContext`1 requestContext) in
d:\_Bld\8089\4133\Sources\Src\ShardSplitMerge\FsmWorkerRole\Service\SplitMergeService.cs:line 631
   at Microsoft.Azure.SqlDatabase.ElasticScale.SplitMerge.Worker.SplitMergeService.ExecuteOne(SqlMessageFetcher sqlMessageFetcher) in
d:\_Bld\8089\4133\Sources\Src\ShardSplitMerge\FsmWorkerRole\Service\SplitMergeService.cs:line 377
   at Microsoft.Azure.SqlDatabase.ElasticScale.SplitMerge.Worker.SplitMergeService.TryExecuteOne(SqlMessageFetcher sqlMessageFetcher, MessageDeletionStrategy
messageDeletionStrategy) in d:\_Bld\8089\4133\Sources\Src\ShardSplitMerge\FsmWorkerRole\Service\SplitMergeService.cs:line 212
MessageOperationId: f3581c28-6ae6-41ef-8cd4-5f79500c8596
ErrorCode: SourceMappingNotFound
At C:\Code\Lesson06\Splitting\SplitMerge\SplitMerge.psm1:363 char:13
+             throw $statusJson.Details
+             ~~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : OperationStopped: ([Error] Failed ...MappingNotFound:String) [], RuntimeException
    + FullyQualifiedErrorId : [Error] Failed to process request. Microsoft.Azure.SqlDatabase.ElasticScale.SplitMerge.Worker.InvalidSplitMergeOperationException: The sou
   rce mapping could not be found in the shard map 'toystorerangemap' using the lookup key '900'. ---> Microsoft.Azure.SqlDatabase.ElasticScale.ShardManagement.ShardMa
  nagementException: Mapping containing the given key value could not be located in the shard map 'toystorerangemap'. Error occurred while executing stored procedure
 '__ShardManagement.spFindShardMappingByKeyGlobal' for operation 'Lookup'.
   at Microsoft.Azure.SqlDatabase.ElasticScale.ShardManagement.RangeShardMapper`1.Lookup(TKey key, Boolean useCache)
   at Microsoft.Azure.SqlDatabase.ElasticScale.ShardManagement.RangeShardMap`1.GetMappingForKey(TKey key)
       at Microsoft.Azure.SqlDatabase.ElasticScale.SplitMerge.Worker.ShardMapManagerAbstraction.RangeShardMapAbstraction`1.GetMappingForKey(T key) in d:\_Bld\8089\4133\
   Sources\Src\ShardSplitMerge\FsmWorkerRole\ShardMapManagerAbstraction\ShardMap.cs:line 299
       at Microsoft.Azure.SqlDatabase.ElasticScale.SplitMerge.Worker.SplitMergeService.DoSplitMergeInternal[T](SplitMergeRequestContext`1 requestContext) in d:\_Bld\808
   9\4133\Sources\Src\ShardSplitMerge\FsmWorkerRole\Service\SplitMergeService.cs:line 455
   --- End of inner exception stack trace ---
       at Microsoft.Azure.SqlDatabase.ElasticScale.SplitMerge.Worker.SplitMergeService.DoSplitMergeInternal[T](SplitMergeRequestContext`1 requestContext) in d:\_Bld\808
   9\4133\Sources\Src\ShardSplitMerge\FsmWorkerRole\Service\SplitMergeService.cs:line 631
       at Microsoft.Azure.SqlDatabase.ElasticScale.SplitMerge.Worker.SplitMergeService.ExecuteOne(SqlMessageFetcher sqlMessageFetcher) in d:\_Bld\8089\4133\Sources\Src\
   ShardSplitMerge\FsmWorkerRole\Service\SplitMergeService.cs:line 377
       at Microsoft.Azure.SqlDatabase.ElasticScale.SplitMerge.Worker.SplitMergeService.TryExecuteOne(SqlMessageFetcher sqlMessageFetcher, MessageDeletionStrategy messag
   eDeletionStrategy) in d:\_Bld\8089\4133\Sources\Src\ShardSplitMerge\FsmWorkerRole\Service\SplitMergeService.cs:line 212
MessageOperationId: f3581c28-6ae6-41ef-8cd4-5f79500c8596
ErrorCode: SourceMappingNotFound

PS C:\Code\Lesson06\Splitting> .\SplitToyStoreShard.ps1 -ResourceGroup toystore -SqlServer toyfactory -UserName sqladmin -Password Packt@pub2 -SplitMergeDatabase toystore_splitmerge -SplitMergeServiceEndpoint "https://splitmerge.cloudapp.net/" -ShardMapManagerDatabaseName toystore_SMM -Shard2 toystore_900 -ShardMapName toystorerangemap -SplitRangeLow 900
>> TerminatingError(): "The pipeline has been stopped."
>> TerminatingError(): "The pipeline has been stopped."
PS C:\Code\Lesson06\Splitting> .\SplitToyStoreShard.ps1 -ResourceGroup toystore -SqlServer toyfactory -UserName sqladmin -Password Packt@pub2 -SplitMergeDatabase toystore_splitmerge -SplitMergeServiceEndpoint "https://splitmerge.cloudapp.net/" -ShardMapManagerDatabaseName toystore_SMM -Shard2 toystore_900 -ShardMapName toystorerangemap -SplitRangeLow 900
Transcript started, output file is C:\Code\Lesson06\Splitting\Log\SplitToyStoreShard.txt
WARNING: The output object type of this cmdlet will be modified in a future release.


ResourceGroupName : toystore
Location          : eastus2
ProvisioningState : Succeeded
Tags              :
ResourceId        : /subscriptions/bf64f3c6-6e64-48c5-a7cc-6c35b4f9aebf/resourceGroups/toystore



ResourceGroupName        : toystore
ServerName               : toyfactory
Location                 : East US 2
SqlAdministratorLogin    : sqladmin
SqlAdministratorPassword :
ServerVersion            : 12.0
Tags                     :



ResourceGroupName             : toystore
ServerName                    : toyfactory
DatabaseName                  : toystore_splitmerge
Location                      : East US 2
DatabaseId                    : 0c8a58bf-7e77-40be-9bb5-bbf3fb976af6
Edition                       : Basic
CollationName                 : SQL_Latin1_General_CP1_CI_AS
CatalogCollation              :
MaxSizeBytes                  : 2147483648
Status                        : Online
CreationDate                  : 12/22/2017 1:17:29 PM
CurrentServiceObjectiveId     : dd6d99bb-f193-4ec1-86f2-43d3bccbc49c
CurrentServiceObjectiveName   : Basic
RequestedServiceObjectiveId   : dd6d99bb-f193-4ec1-86f2-43d3bccbc49c
RequestedServiceObjectiveName :
ElasticPoolName               :
EarliestRestoreDate           : 12/22/2017 1:48:41 PM
Tags                          :
ResourceId                    : /subscriptions/bf64f3c6-6e64-48c5-a7cc-6c35b4f9aebf/resourceGroups/toystore/providers/Microsoft.Sql/servers/toyfactory/databases/toystore
                                _splitmerge
CreateMode                    :


Sending split request
PS C:\Code\Lesson06\Splitting> TerminatingError(Submit-SplitRequest): "Cannot bind argument to parameter 'SplitValue' because it is an empty string."
Submit-SplitRequest : Cannot bind argument to parameter 'SplitValue' because it is an empty string.
At C:\Code\Lesson06\Splitting\SplitToyStoreShard.ps1:77 char:17
+     -SplitValue $SplitValue `
+                 ~~~~~~~~~~~
    + CategoryInfo          : InvalidData: (:) [Submit-SplitRequest], ParameterBindingValidationException
    + FullyQualifiedErrorId : ParameterArgumentValidationErrorEmptyStringNotAllowed,Submit-SplitRequest
Submit-SplitRequest : Cannot bind argument to parameter 'SplitValue' because it is an empty string.
At C:\Code\Lesson06\Splitting\SplitToyStoreShard.ps1:77 char:17
+     -SplitValue $SplitValue `
+                 ~~~~~~~~~~~
    + CategoryInfo          : InvalidData: (:) [Submit-SplitRequest], ParameterBindingValidationException
    + FullyQualifiedErrorId : ParameterArgumentValidationErrorEmptyStringNotAllowed,Submit-SplitRequest

Began split operation with id
PS C:\Code\Lesson06\Splitting> TerminatingError(Wait-SplitMergeRequest): "Cannot process argument transformation on parameter 'OperationId'. Cannot convert null to type "System.Guid"."
Wait-SplitMergeRequest : Cannot process argument transformation on parameter 'OperationId'. Cannot convert null to type 
"System.Guid".
At C:\Code\Lesson06\Splitting\SplitToyStoreShard.ps1:84 char:91
+ ... int $SplitMergeServiceEndpoint -OperationId $splitOperationId -Certif ...
+                                                 ~~~~~~~~~~~~~~~~~
    + CategoryInfo          : InvalidData: (:) [Wait-SplitMergeRequest], ParameterBindingArgumentTransformationException
    + FullyQualifiedErrorId : ParameterArgumentTransformationError,Wait-SplitMergeRequest
Wait-SplitMergeRequest : Cannot process argument transformation on parameter 'OperationId'. Cannot convert null to type "System.Guid".
At C:\Code\Lesson06\Splitting\SplitToyStoreShard.ps1:84 char:91
+ ... int $SplitMergeServiceEndpoint -OperationId $splitOperationId -Certif ...
+                                                 ~~~~~~~~~~~~~~~~~
    + CategoryInfo          : InvalidData: (:) [Wait-SplitMergeRequest], ParameterBindingArgumentTransformationException
    + FullyQualifiedErrorId : ParameterArgumentTransformationError,Wait-SplitMergeRequest



PS C:\Code\Lesson06\Splitting> .\SplitToyStoreShard.ps1 -ResourceGroup toystore -SqlServer toyfactory -UserName sqladmin -Password Packt@pub2 -SplitMergeDatabase toystore_splitmerge -SplitMergeServiceEndpoint "https://splitmerge.cloudapp.net/" -ShardMapManagerDatabaseName toystore_SMM -Shard2 toystore_900 -ShardMapName toystorerangemap -SplitRangeLow 900
Transcript started, output file is C:\Code\Lesson06\Splitting\Log\SplitToyStoreShard.txt
WARNING: The output object type of this cmdlet will be modified in a future release.


ResourceGroupName : toystore
Location          : eastus2
ProvisioningState : Succeeded
Tags              :
ResourceId        : /subscriptions/bf64f3c6-6e64-48c5-a7cc-6c35b4f9aebf/resourceGroups/toystore



ResourceGroupName        : toystore
ServerName               : toyfactory
Location                 : East US 2
SqlAdministratorLogin    : sqladmin
SqlAdministratorPassword :
ServerVersion            : 12.0
Tags                     :



ResourceGroupName             : toystore
ServerName                    : toyfactory
DatabaseName                  : toystore_splitmerge
Location                      : East US 2
DatabaseId                    : 0c8a58bf-7e77-40be-9bb5-bbf3fb976af6
Edition                       : Basic
CollationName                 : SQL_Latin1_General_CP1_CI_AS
CatalogCollation              :
MaxSizeBytes                  : 2147483648
Status                        : Online
CreationDate                  : 12/22/2017 1:17:29 PM
CurrentServiceObjectiveId     : dd6d99bb-f193-4ec1-86f2-43d3bccbc49c
CurrentServiceObjectiveName   : Basic
RequestedServiceObjectiveId   : dd6d99bb-f193-4ec1-86f2-43d3bccbc49c
RequestedServiceObjectiveName :
ElasticPoolName               :
EarliestRestoreDate           : 12/22/2017 1:48:41 PM
Tags                          :
ResourceId                    : /subscriptions/bf64f3c6-6e64-48c5-a7cc-6c35b4f9aebf/resourceGroups/toystore/providers/Microsoft.Sql/servers/toyfactory/databases/toystore
                                _splitmerge
CreateMode                    :


Sending split request
PS C:\Code\Lesson06\Splitting> TerminatingError(): "The pipeline has been stopped."
>> TerminatingError(): "The pipeline has been stopped."
>> TerminatingError(): "The pipeline has been stopped."
PS C:\Code\Lesson06\Splitting> .\SplitToyStoreShard.ps1 -ResourceGroup toystore -SqlServer toyfactory -UserName sqladmin -Password Packt@pub2 -SplitMergeDatabase toystore_splitmerge -SplitMergeServiceEndpoint "https://splitmerge.cloudapp.net/" -ShardMapManagerDatabaseName toystore_SMM -Shard2 toystore_900 -ShardMapName toystorerangemap -SplitRangeLow 900
Transcript started, output file is C:\Code\Lesson06\Splitting\Log\SplitToyStoreShard.txt
WARNING: The output object type of this cmdlet will be modified in a future release.


ResourceGroupName : toystore
Location          : eastus2
ProvisioningState : Succeeded
Tags              :
ResourceId        : /subscriptions/bf64f3c6-6e64-48c5-a7cc-6c35b4f9aebf/resourceGroups/toystore



ResourceGroupName        : toystore
ServerName               : toyfactory
Location                 : East US 2
SqlAdministratorLogin    : sqladmin
SqlAdministratorPassword :
ServerVersion            : 12.0
Tags                     :



ResourceGroupName             : toystore
ServerName                    : toyfactory
DatabaseName                  : toystore_splitmerge
Location                      : East US 2
DatabaseId                    : 0c8a58bf-7e77-40be-9bb5-bbf3fb976af6
Edition                       : Basic
CollationName                 : SQL_Latin1_General_CP1_CI_AS
CatalogCollation              :
MaxSizeBytes                  : 2147483648
Status                        : Online
CreationDate                  : 12/22/2017 1:17:29 PM
CurrentServiceObjectiveId     : dd6d99bb-f193-4ec1-86f2-43d3bccbc49c
CurrentServiceObjectiveName   : Basic
RequestedServiceObjectiveId   : dd6d99bb-f193-4ec1-86f2-43d3bccbc49c
RequestedServiceObjectiveName :
ElasticPoolName               :
EarliestRestoreDate           : 12/22/2017 1:48:41 PM
Tags                          :
ResourceId                    : /subscriptions/bf64f3c6-6e64-48c5-a7cc-6c35b4f9aebf/resourceGroups/toystore/providers/Microsoft.Sql/servers/toyfactory/databases/toystore
                                _splitmerge
CreateMode                    :


Sending split request
-CertificateThumbprint : The term '-CertificateThumbprint' is not recognized as the name of a cmdlet, function, script 
file, or operable program. Check the spelling of the name, or if a path was included, verify that the path is correct 
and try again.
At C:\Code\Lesson06\Splitting\SplitToyStoreShard.ps1:97 char:5
+     -CertificateThumbprint $CertificateThumbprint
+     ~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : ObjectNotFound: (-CertificateThumbprint:String) [], CommandNotFoundException
    + FullyQualifiedErrorId : CommandNotFoundException
-CertificateThumbprint : The term '-CertificateThumbprint' is not recognized as the name of a cmdlet, function, script file, or operable program. Check the spelling of
the name, or if a path was included, verify that the path is correct and try again.
At C:\Code\Lesson06\Splitting\SplitToyStoreShard.ps1:97 char:5
+     -CertificateThumbprint $CertificateThumbprint
+     ~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : ObjectNotFound: (-CertificateThumbprint:String) [], CommandNotFoundException
    + FullyQualifiedErrorId : CommandNotFoundException

Began split operation with id ce4964b5-8a75-4d7b-b08f-a5ea6780800c
Polling request status. Press Ctrl-C to end
Progress: 0% | Status: Queued | Details: [Informational] Operation has been queued.
Progress: 100% | Status: Failed | Details: [Error] Failed to process request. Microsoft.Azure.SqlDatabase.ElasticScale.SplitMerge.Worker.InvalidSplitMergeOperationException: Shard '[DataSource=toyfactory.database.windows.net Database=toystore_900]' is not a member of shard map 'toystorerangemap'. To move data to this shard, it must first be added to the shard map. ---> Microsoft.Azure.SqlDatabase.ElasticScale.ShardManagement.ShardManagementException: Shard corresponding to location '[DataSource=toyfactory.database.windows.net Database=toystore_900]' could not be found in shard map 'toystorerangemap' .
   at Microsoft.Azure.SqlDatabase.ElasticScale.ShardManagement.ShardMap.GetShard(ShardLocation location)
   at Microsoft.Azure.SqlDatabase.ElasticScale.SplitMerge.Worker.SplitMergeService.DoSplitMergeInternal[T](SplitMergeRequestContext`1 requestContext) in d:\_Bld\8089\4133\Sources\Src\ShardSplitMerge\FsmWorkerRole\Service\SplitMergeService.cs:line 542
   --- End of inner exception stack trace ---
   at Microsoft.Azure.SqlDatabase.ElasticScale.SplitMerge.Worker.SplitMergeService.DoSplitMergeInternal[T](SplitMergeRequestContext`1 requestContext) in d:\_Bld\8089\4133\Sources\Src\ShardSplitMerge\FsmWorkerRole\Service\SplitMergeService.cs:line 631
   at Microsoft.Azure.SqlDatabase.ElasticScale.SplitMerge.Worker.SplitMergeService.ExecuteOne(SqlMessageFetcher sqlMessageFetcher) in d:\_Bld\8089\4133\Sources\Src\ShardSplitMerge\FsmWorkerRole\Service\SplitMergeService.cs:line 377
   at Microsoft.Azure.SqlDatabase.ElasticScale.SplitMerge.Worker.SplitMergeService.TryExecuteOne(SqlMessageFetcher sqlMessageFetcher, MessageDeletionStrategy messageDeletionStrategy) in d:\_Bld\8089\4133\Sources\Src\ShardSplitMerge\FsmWorkerRole\Service\SplitMergeService.cs:line 212
MessageOperationId: ce4964b5-8a75-4d7b-b08f-a5ea6780800c
ErrorCode: ShardNotFound
PS C:\Code\Lesson06\Splitting> TerminatingError(): "[Error] Failed to process request. Microsoft.Azure.SqlDatabase.ElasticScale.SplitMerge.Worker.InvalidSplitMergeOperationException: Shard '[DataSource=toyfactory.database.windows.net Database=toystore_900]' is not a member of shard map 'toystorerangemap'. To move data to this shard, it must first be added to the shard map. ---> Microsoft.Azure.SqlDatabase.ElasticScale.ShardManagement.ShardManagementException: Shard corresponding to location '[DataSource=toyfactory.database.windows.net Database=toystore_900]' could not be found in shard map 'toystorerangemap' .
   at Microsoft.Azure.SqlDatabase.ElasticScale.ShardManagement.ShardMap.GetShard(ShardLocation location)
   at Microsoft.Azure.SqlDatabase.ElasticScale.SplitMerge.Worker.SplitMergeService.DoSplitMergeInternal[T](SplitMergeRequestContext`1 requestContext) in d:\_Bld\8089\4133\Sources\Src\ShardSplitMerge\FsmWorkerRole\Service\SplitMergeService.cs:line 542
   --- End of inner exception stack trace ---
   at Microsoft.Azure.SqlDatabase.ElasticScale.SplitMerge.Worker.SplitMergeService.DoSplitMergeInternal[T](SplitMergeRequestContext`1 requestContext) in d:\_Bld\8089\4133\Sources\Src\ShardSplitMerge\FsmWorkerRole\Service\SplitMergeService.cs:line 631
   at Microsoft.Azure.SqlDatabase.ElasticScale.SplitMerge.Worker.SplitMergeService.ExecuteOne(SqlMessageFetcher sqlMessageFetcher) in d:\_Bld\8089\4133\Sources\Src\ShardSplitMerge\FsmWorkerRole\Service\SplitMergeService.cs:line 377
   at Microsoft.Azure.SqlDatabase.ElasticScale.SplitMerge.Worker.SplitMergeService.TryExecuteOne(SqlMessageFetcher sqlMessageFetcher, MessageDeletionStrategy messageDeletionStrategy) in d:\_Bld\8089\4133\Sources\Src\ShardSplitMerge\FsmWorkerRole\Service\SplitMergeService.cs:line 212
MessageOperationId: ce4964b5-8a75-4d7b-b08f-a5ea6780800c
ErrorCode: ShardNotFound"
>> TerminatingError(): "[Error] Failed to process request. Microsoft.Azure.SqlDatabase.ElasticScale.SplitMerge.Worker.InvalidSplitMergeOperationException: Shard '[DataSource=toyfactory.database.windows.net Database=toystore_900]' is not a member of shard map 'toystorerangemap'. To move data to this shard, it must first be added to the shard map. ---> Microsoft.Azure.SqlDatabase.ElasticScale.ShardManagement.ShardManagementException: Shard corresponding to location '[DataSource=toyfactory.database.windows.net Database=toystore_900]' could not be found in shard map 'toystorerangemap' .
   at Microsoft.Azure.SqlDatabase.ElasticScale.ShardManagement.ShardMap.GetShard(ShardLocation location)
   at Microsoft.Azure.SqlDatabase.ElasticScale.SplitMerge.Worker.SplitMergeService.DoSplitMergeInternal[T](SplitMergeRequestContext`1 requestContext) in d:\_Bld\8089\4133\Sources\Src\ShardSplitMerge\FsmWorkerRole\Service\SplitMergeService.cs:line 542
   --- End of inner exception stack trace ---
   at Microsoft.Azure.SqlDatabase.ElasticScale.SplitMerge.Worker.SplitMergeService.DoSplitMergeInternal[T](SplitMergeRequestContext`1 requestContext) in d:\_Bld\8089\4133\Sources\Src\ShardSplitMerge\FsmWorkerRole\Service\SplitMergeService.cs:line 631
   at Microsoft.Azure.SqlDatabase.ElasticScale.SplitMerge.Worker.SplitMergeService.ExecuteOne(SqlMessageFetcher sqlMessageFetcher) in d:\_Bld\8089\4133\Sources\Src\ShardSplitMerge\FsmWorkerRole\Service\SplitMergeService.cs:line 377
   at Microsoft.Azure.SqlDatabase.ElasticScale.SplitMerge.Worker.SplitMergeService.TryExecuteOne(SqlMessageFetcher sqlMessageFetcher, MessageDeletionStrategy messageDeletionStrategy) in d:\_Bld\8089\4133\Sources\Src\ShardSplitMerge\FsmWorkerRole\Service\SplitMergeService.cs:line 212
MessageOperationId: ce4964b5-8a75-4d7b-b08f-a5ea6780800c
ErrorCode: ShardNotFound"
>> TerminatingError(): "[Error] Failed to process request. Microsoft.Azure.SqlDatabase.ElasticScale.SplitMerge.Worker.InvalidSplitMergeOperationException: Shard '[DataSource=toyfactory.database.windows.net Database=toystore_900]' is not a member of shard map 'toystorerangemap'. To move data to this shard, it must first be added to the shard map. ---> Microsoft.Azure.SqlDatabase.ElasticScale.ShardManagement.ShardManagementException: Shard corresponding to location '[DataSource=toyfactory.database.windows.net Database=toystore_900]' could not be found in shard map 'toystorerangemap' .
   at Microsoft.Azure.SqlDatabase.ElasticScale.ShardManagement.ShardMap.GetShard(ShardLocation location)
   at Microsoft.Azure.SqlDatabase.ElasticScale.SplitMerge.Worker.SplitMergeService.DoSplitMergeInternal[T](SplitMergeRequestContext`1 requestContext) in d:\_Bld\8089\4133\Sources\Src\ShardSplitMerge\FsmWorkerRole\Service\SplitMergeService.cs:line 542
   --- End of inner exception stack trace ---
   at Microsoft.Azure.SqlDatabase.ElasticScale.SplitMerge.Worker.SplitMergeService.DoSplitMergeInternal[T](SplitMergeRequestContext`1 requestContext) in d:\_Bld\8089\4133\Sources\Src\ShardSplitMerge\FsmWorkerRole\Service\SplitMergeService.cs:line 631
   at Microsoft.Azure.SqlDatabase.ElasticScale.SplitMerge.Worker.SplitMergeService.ExecuteOne(SqlMessageFetcher sqlMessageFetcher) in d:\_Bld\8089\4133\Sources\Src\ShardSplitMerge\FsmWorkerRole\Service\SplitMergeService.cs:line 377
   at Microsoft.Azure.SqlDatabase.ElasticScale.SplitMerge.Worker.SplitMergeService.TryExecuteOne(SqlMessageFetcher sqlMessageFetcher, MessageDeletionStrategy messageDeletionStrategy) in d:\_Bld\8089\4133\Sources\Src\ShardSplitMerge\FsmWorkerRole\Service\SplitMergeService.cs:line 212
MessageOperationId: ce4964b5-8a75-4d7b-b08f-a5ea6780800c
ErrorCode: ShardNotFound"
[Error] Failed to process request. Microsoft.Azure.SqlDatabase.ElasticScale.SplitMerge.Worker.InvalidSplitMergeOperationException: Shard
'[DataSource=toyfactory.database.windows.net Database=toystore_900]' is not a member of shard map 'toystorerangemap'. To move data to this shard, it must first be added
to the shard map. ---> Microsoft.Azure.SqlDatabase.ElasticScale.ShardManagement.ShardManagementException: Shard corresponding to location
'[DataSource=toyfactory.database.windows.net Database=toystore_900]' could not be found in shard map 'toystorerangemap' .
   at Microsoft.Azure.SqlDatabase.ElasticScale.ShardManagement.ShardMap.GetShard(ShardLocation location)
   at Microsoft.Azure.SqlDatabase.ElasticScale.SplitMerge.Worker.SplitMergeService.DoSplitMergeInternal[T](SplitMergeRequestContext`1 requestContext) in
d:\_Bld\8089\4133\Sources\Src\ShardSplitMerge\FsmWorkerRole\Service\SplitMergeService.cs:line 542
   --- End of inner exception stack trace ---
   at Microsoft.Azure.SqlDatabase.ElasticScale.SplitMerge.Worker.SplitMergeService.DoSplitMergeInternal[T](SplitMergeRequestContext`1 requestContext) in
d:\_Bld\8089\4133\Sources\Src\ShardSplitMerge\FsmWorkerRole\Service\SplitMergeService.cs:line 631
   at Microsoft.Azure.SqlDatabase.ElasticScale.SplitMerge.Worker.SplitMergeService.ExecuteOne(SqlMessageFetcher sqlMessageFetcher) in
d:\_Bld\8089\4133\Sources\Src\ShardSplitMerge\FsmWorkerRole\Service\SplitMergeService.cs:line 377
   at Microsoft.Azure.SqlDatabase.ElasticScale.SplitMerge.Worker.SplitMergeService.TryExecuteOne(SqlMessageFetcher sqlMessageFetcher, MessageDeletionStrategy
messageDeletionStrategy) in d:\_Bld\8089\4133\Sources\Src\ShardSplitMerge\FsmWorkerRole\Service\SplitMergeService.cs:line 212
MessageOperationId: ce4964b5-8a75-4d7b-b08f-a5ea6780800c
ErrorCode: ShardNotFound
At C:\Code\Lesson06\Splitting\SplitMerge\SplitMerge.psm1:363 char:13
+             throw $statusJson.Details
+             ~~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : OperationStopped: ([Error] Failed ...: ShardNotFound:String) [], RuntimeException
    + FullyQualifiedErrorId : [Error] Failed to process request. Microsoft.Azure.SqlDatabase.ElasticScale.SplitMerge.Worker.InvalidSplitMergeOperationException: Shard '
   [DataSource=toyfactory.database.windows.net Database=toystore_900]' is not a member of shard map 'toystorerangemap'. To move data to this shard, it must first be ad
  ded to the shard map. ---> Microsoft.Azure.SqlDatabase.ElasticScale.ShardManagement.ShardManagementException: Shard corresponding to location '[DataSource=toyfactor
 y.database.windows.net Database=toystore_900]' could not be found in shard map 'toystorerangemap' .
   at Microsoft.Azure.SqlDatabase.ElasticScale.ShardManagement.ShardMap.GetShard(ShardLocation location)
       at Microsoft.Azure.SqlDatabase.ElasticScale.SplitMerge.Worker.SplitMergeService.DoSplitMergeInternal[T](SplitMergeRequestContext`1 requestContext) in d:\_Bld\808
   9\4133\Sources\Src\ShardSplitMerge\FsmWorkerRole\Service\SplitMergeService.cs:line 542
   --- End of inner exception stack trace ---
       at Microsoft.Azure.SqlDatabase.ElasticScale.SplitMerge.Worker.SplitMergeService.DoSplitMergeInternal[T](SplitMergeRequestContext`1 requestContext) in d:\_Bld\808
   9\4133\Sources\Src\ShardSplitMerge\FsmWorkerRole\Service\SplitMergeService.cs:line 631
       at Microsoft.Azure.SqlDatabase.ElasticScale.SplitMerge.Worker.SplitMergeService.ExecuteOne(SqlMessageFetcher sqlMessageFetcher) in d:\_Bld\8089\4133\Sources\Src\
   ShardSplitMerge\FsmWorkerRole\Service\SplitMergeService.cs:line 377
       at Microsoft.Azure.SqlDatabase.ElasticScale.SplitMerge.Worker.SplitMergeService.TryExecuteOne(SqlMessageFetcher sqlMessageFetcher, MessageDeletionStrategy messag
   eDeletionStrategy) in d:\_Bld\8089\4133\Sources\Src\ShardSplitMerge\FsmWorkerRole\Service\SplitMergeService.cs:line 212
MessageOperationId: ce4964b5-8a75-4d7b-b08f-a5ea6780800c
ErrorCode: ShardNotFound

PS C:\Code\Lesson06\Splitting> .\SplitToyStoreShard.ps1 -ResourceGroup toystore -SqlServer toyfactory -UserName sqladmin -Password Packt@pub2 -SplitMergeDatabase toystore_splitmerge -SplitMergeServiceEndpoint "https://splitmerge.cloudapp.net/" -ShardMapManagerDatabaseName toystore_SMM -Shard2 toystore_900 -ShardMapName toystorerangemap -SplitRangeLow 800 -SplitRangeHigh 1000 -SplitValue 800
Transcript started, output file is C:\Code\Lesson06\Splitting\Log\SplitToyStoreShard.txt
WARNING: The output object type of this cmdlet will be modified in a future release.


ResourceGroupName : toystore
Location          : eastus2
ProvisioningState : Succeeded
Tags              :
ResourceId        : /subscriptions/bf64f3c6-6e64-48c5-a7cc-6c35b4f9aebf/resourceGroups/toystore



ResourceGroupName        : toystore
ServerName               : toyfactory
Location                 : East US 2
SqlAdministratorLogin    : sqladmin
SqlAdministratorPassword :
ServerVersion            : 12.0
Tags                     :



ResourceGroupName             : toystore
ServerName                    : toyfactory
DatabaseName                  : toystore_splitmerge
Location                      : East US 2
DatabaseId                    : 0c8a58bf-7e77-40be-9bb5-bbf3fb976af6
Edition                       : Basic
CollationName                 : SQL_Latin1_General_CP1_CI_AS
CatalogCollation              :
MaxSizeBytes                  : 2147483648
Status                        : Online
CreationDate                  : 12/22/2017 1:17:29 PM
CurrentServiceObjectiveId     : dd6d99bb-f193-4ec1-86f2-43d3bccbc49c
CurrentServiceObjectiveName   : Basic
RequestedServiceObjectiveId   : dd6d99bb-f193-4ec1-86f2-43d3bccbc49c
RequestedServiceObjectiveName :
ElasticPoolName               :
EarliestRestoreDate           : 12/22/2017 1:48:41 PM
Tags                          :
ResourceId                    : /subscriptions/bf64f3c6-6e64-48c5-a7cc-6c35b4f9aebf/resourceGroups/toystore/providers/Microsoft.Sql/servers/toyfactory/databases/toystore
                                _splitmerge
CreateMode                    :


Sending split request
-CertificateThumbprint : The term '-CertificateThumbprint' is not recognized as the name of a cmdlet, function, script 
file, or operable program. Check the spelling of the name, or if a path was included, verify that the path is correct 
and try again.
At C:\Code\Lesson06\Splitting\SplitToyStoreShard.ps1:97 char:5
+     -CertificateThumbprint $CertificateThumbprint
+     ~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : ObjectNotFound: (-CertificateThumbprint:String) [], CommandNotFoundException
    + FullyQualifiedErrorId : CommandNotFoundException
-CertificateThumbprint : The term '-CertificateThumbprint' is not recognized as the name of a cmdlet, function, script file, or operable program. Check the spelling of
the name, or if a path was included, verify that the path is correct and try again.
At C:\Code\Lesson06\Splitting\SplitToyStoreShard.ps1:97 char:5
+     -CertificateThumbprint $CertificateThumbprint
+     ~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : ObjectNotFound: (-CertificateThumbprint:String) [], CommandNotFoundException
    + FullyQualifiedErrorId : CommandNotFoundException

Began split operation with id ab71b957-6dc1-4e9d-807d-c2f20ae62dc1
Polling request status. Press Ctrl-C to end
Progress: 0% | Status: Queued | Details: [Informational] Operation has been queued.
Progress: 100% | Status: Failed | Details: [Error] Failed to process request. Microsoft.Azure.SqlDatabase.ElasticScale.SplitMerge.Worker.InvalidSplitMergeOperationException: Shard '[DataSource=toyfactory.database.windows.net Database=toystore_900]' is not a member of shard map 'toystorerangemap'. To move data to this shard, it must first be added to the shard map. ---> Microsoft.Azure.SqlDatabase.ElasticScale.ShardManagement.ShardManagementException: Shard corresponding to location '[DataSource=toyfactory.database.windows.net Database=toystore_900]' could not be found in shard map 'toystorerangemap' .
   at Microsoft.Azure.SqlDatabase.ElasticScale.ShardManagement.ShardMap.GetShard(ShardLocation location)
   at Microsoft.Azure.SqlDatabase.ElasticScale.SplitMerge.Worker.SplitMergeService.DoSplitMergeInternal[T](SplitMergeRequestContext`1 requestContext) in d:\_Bld\8089\4133\Sources\Src\ShardSplitMerge\FsmWorkerRole\Service\SplitMergeService.cs:line 542
   --- End of inner exception stack trace ---
   at Microsoft.Azure.SqlDatabase.ElasticScale.SplitMerge.Worker.SplitMergeService.DoSplitMergeInternal[T](SplitMergeRequestContext`1 requestContext) in d:\_Bld\8089\4133\Sources\Src\ShardSplitMerge\FsmWorkerRole\Service\SplitMergeService.cs:line 631
   at Microsoft.Azure.SqlDatabase.ElasticScale.SplitMerge.Worker.SplitMergeService.ExecuteOne(SqlMessageFetcher sqlMessageFetcher) in d:\_Bld\8089\4133\Sources\Src\ShardSplitMerge\FsmWorkerRole\Service\SplitMergeService.cs:line 377
   at Microsoft.Azure.SqlDatabase.ElasticScale.SplitMerge.Worker.SplitMergeService.TryExecuteOne(SqlMessageFetcher sqlMessageFetcher, MessageDeletionStrategy messageDeletionStrategy) in d:\_Bld\8089\4133\Sources\Src\ShardSplitMerge\FsmWorkerRole\Service\SplitMergeService.cs:line 212
MessageOperationId: ab71b957-6dc1-4e9d-807d-c2f20ae62dc1
ErrorCode: ShardNotFound
PS C:\Code\Lesson06\Splitting> TerminatingError(): "[Error] Failed to process request. Microsoft.Azure.SqlDatabase.ElasticScale.SplitMerge.Worker.InvalidSplitMergeOperationException: Shard '[DataSource=toyfactory.database.windows.net Database=toystore_900]' is not a member of shard map 'toystorerangemap'. To move data to this shard, it must first be added to the shard map. ---> Microsoft.Azure.SqlDatabase.ElasticScale.ShardManagement.ShardManagementException: Shard corresponding to location '[DataSource=toyfactory.database.windows.net Database=toystore_900]' could not be found in shard map 'toystorerangemap' .
   at Microsoft.Azure.SqlDatabase.ElasticScale.ShardManagement.ShardMap.GetShard(ShardLocation location)
   at Microsoft.Azure.SqlDatabase.ElasticScale.SplitMerge.Worker.SplitMergeService.DoSplitMergeInternal[T](SplitMergeRequestContext`1 requestContext) in d:\_Bld\8089\4133\Sources\Src\ShardSplitMerge\FsmWorkerRole\Service\SplitMergeService.cs:line 542
   --- End of inner exception stack trace ---
   at Microsoft.Azure.SqlDatabase.ElasticScale.SplitMerge.Worker.SplitMergeService.DoSplitMergeInternal[T](SplitMergeRequestContext`1 requestContext) in d:\_Bld\8089\4133\Sources\Src\ShardSplitMerge\FsmWorkerRole\Service\SplitMergeService.cs:line 631
   at Microsoft.Azure.SqlDatabase.ElasticScale.SplitMerge.Worker.SplitMergeService.ExecuteOne(SqlMessageFetcher sqlMessageFetcher) in d:\_Bld\8089\4133\Sources\Src\ShardSplitMerge\FsmWorkerRole\Service\SplitMergeService.cs:line 377
   at Microsoft.Azure.SqlDatabase.ElasticScale.SplitMerge.Worker.SplitMergeService.TryExecuteOne(SqlMessageFetcher sqlMessageFetcher, MessageDeletionStrategy messageDeletionStrategy) in d:\_Bld\8089\4133\Sources\Src\ShardSplitMerge\FsmWorkerRole\Service\SplitMergeService.cs:line 212
MessageOperationId: ab71b957-6dc1-4e9d-807d-c2f20ae62dc1
ErrorCode: ShardNotFound"
>> TerminatingError(): "[Error] Failed to process request. Microsoft.Azure.SqlDatabase.ElasticScale.SplitMerge.Worker.InvalidSplitMergeOperationException: Shard '[DataSource=toyfactory.database.windows.net Database=toystore_900]' is not a member of shard map 'toystorerangemap'. To move data to this shard, it must first be added to the shard map. ---> Microsoft.Azure.SqlDatabase.ElasticScale.ShardManagement.ShardManagementException: Shard corresponding to location '[DataSource=toyfactory.database.windows.net Database=toystore_900]' could not be found in shard map 'toystorerangemap' .
   at Microsoft.Azure.SqlDatabase.ElasticScale.ShardManagement.ShardMap.GetShard(ShardLocation location)
   at Microsoft.Azure.SqlDatabase.ElasticScale.SplitMerge.Worker.SplitMergeService.DoSplitMergeInternal[T](SplitMergeRequestContext`1 requestContext) in d:\_Bld\8089\4133\Sources\Src\ShardSplitMerge\FsmWorkerRole\Service\SplitMergeService.cs:line 542
   --- End of inner exception stack trace ---
   at Microsoft.Azure.SqlDatabase.ElasticScale.SplitMerge.Worker.SplitMergeService.DoSplitMergeInternal[T](SplitMergeRequestContext`1 requestContext) in d:\_Bld\8089\4133\Sources\Src\ShardSplitMerge\FsmWorkerRole\Service\SplitMergeService.cs:line 631
   at Microsoft.Azure.SqlDatabase.ElasticScale.SplitMerge.Worker.SplitMergeService.ExecuteOne(SqlMessageFetcher sqlMessageFetcher) in d:\_Bld\8089\4133\Sources\Src\ShardSplitMerge\FsmWorkerRole\Service\SplitMergeService.cs:line 377
   at Microsoft.Azure.SqlDatabase.ElasticScale.SplitMerge.Worker.SplitMergeService.TryExecuteOne(SqlMessageFetcher sqlMessageFetcher, MessageDeletionStrategy messageDeletionStrategy) in d:\_Bld\8089\4133\Sources\Src\ShardSplitMerge\FsmWorkerRole\Service\SplitMergeService.cs:line 212
MessageOperationId: ab71b957-6dc1-4e9d-807d-c2f20ae62dc1
ErrorCode: ShardNotFound"
>> TerminatingError(): "[Error] Failed to process request. Microsoft.Azure.SqlDatabase.ElasticScale.SplitMerge.Worker.InvalidSplitMergeOperationException: Shard '[DataSource=toyfactory.database.windows.net Database=toystore_900]' is not a member of shard map 'toystorerangemap'. To move data to this shard, it must first be added to the shard map. ---> Microsoft.Azure.SqlDatabase.ElasticScale.ShardManagement.ShardManagementException: Shard corresponding to location '[DataSource=toyfactory.database.windows.net Database=toystore_900]' could not be found in shard map 'toystorerangemap' .
   at Microsoft.Azure.SqlDatabase.ElasticScale.ShardManagement.ShardMap.GetShard(ShardLocation location)
   at Microsoft.Azure.SqlDatabase.ElasticScale.SplitMerge.Worker.SplitMergeService.DoSplitMergeInternal[T](SplitMergeRequestContext`1 requestContext) in d:\_Bld\8089\4133\Sources\Src\ShardSplitMerge\FsmWorkerRole\Service\SplitMergeService.cs:line 542
   --- End of inner exception stack trace ---
   at Microsoft.Azure.SqlDatabase.ElasticScale.SplitMerge.Worker.SplitMergeService.DoSplitMergeInternal[T](SplitMergeRequestContext`1 requestContext) in d:\_Bld\8089\4133\Sources\Src\ShardSplitMerge\FsmWorkerRole\Service\SplitMergeService.cs:line 631
   at Microsoft.Azure.SqlDatabase.ElasticScale.SplitMerge.Worker.SplitMergeService.ExecuteOne(SqlMessageFetcher sqlMessageFetcher) in d:\_Bld\8089\4133\Sources\Src\ShardSplitMerge\FsmWorkerRole\Service\SplitMergeService.cs:line 377
   at Microsoft.Azure.SqlDatabase.ElasticScale.SplitMerge.Worker.SplitMergeService.TryExecuteOne(SqlMessageFetcher sqlMessageFetcher, MessageDeletionStrategy messageDeletionStrategy) in d:\_Bld\8089\4133\Sources\Src\ShardSplitMerge\FsmWorkerRole\Service\SplitMergeService.cs:line 212
MessageOperationId: ab71b957-6dc1-4e9d-807d-c2f20ae62dc1
ErrorCode: ShardNotFound"
[Error] Failed to process request. Microsoft.Azure.SqlDatabase.ElasticScale.SplitMerge.Worker.InvalidSplitMergeOperationException: Shard
'[DataSource=toyfactory.database.windows.net Database=toystore_900]' is not a member of shard map 'toystorerangemap'. To move data to this shard, it must first be added
to the shard map. ---> Microsoft.Azure.SqlDatabase.ElasticScale.ShardManagement.ShardManagementException: Shard corresponding to location
'[DataSource=toyfactory.database.windows.net Database=toystore_900]' could not be found in shard map 'toystorerangemap' .
   at Microsoft.Azure.SqlDatabase.ElasticScale.ShardManagement.ShardMap.GetShard(ShardLocation location)
   at Microsoft.Azure.SqlDatabase.ElasticScale.SplitMerge.Worker.SplitMergeService.DoSplitMergeInternal[T](SplitMergeRequestContext`1 requestContext) in
d:\_Bld\8089\4133\Sources\Src\ShardSplitMerge\FsmWorkerRole\Service\SplitMergeService.cs:line 542
   --- End of inner exception stack trace ---
   at Microsoft.Azure.SqlDatabase.ElasticScale.SplitMerge.Worker.SplitMergeService.DoSplitMergeInternal[T](SplitMergeRequestContext`1 requestContext) in
d:\_Bld\8089\4133\Sources\Src\ShardSplitMerge\FsmWorkerRole\Service\SplitMergeService.cs:line 631
   at Microsoft.Azure.SqlDatabase.ElasticScale.SplitMerge.Worker.SplitMergeService.ExecuteOne(SqlMessageFetcher sqlMessageFetcher) in
d:\_Bld\8089\4133\Sources\Src\ShardSplitMerge\FsmWorkerRole\Service\SplitMergeService.cs:line 377
   at Microsoft.Azure.SqlDatabase.ElasticScale.SplitMerge.Worker.SplitMergeService.TryExecuteOne(SqlMessageFetcher sqlMessageFetcher, MessageDeletionStrategy
messageDeletionStrategy) in d:\_Bld\8089\4133\Sources\Src\ShardSplitMerge\FsmWorkerRole\Service\SplitMergeService.cs:line 212
MessageOperationId: ab71b957-6dc1-4e9d-807d-c2f20ae62dc1
ErrorCode: ShardNotFound
At C:\Code\Lesson06\Splitting\SplitMerge\SplitMerge.psm1:363 char:13
+             throw $statusJson.Details
+             ~~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : OperationStopped: ([Error] Failed ...: ShardNotFound:String) [], RuntimeException
    + FullyQualifiedErrorId : [Error] Failed to process request. Microsoft.Azure.SqlDatabase.ElasticScale.SplitMerge.Worker.InvalidSplitMergeOperationException: Shard '
   [DataSource=toyfactory.database.windows.net Database=toystore_900]' is not a member of shard map 'toystorerangemap'. To move data to this shard, it must first be ad
  ded to the shard map. ---> Microsoft.Azure.SqlDatabase.ElasticScale.ShardManagement.ShardManagementException: Shard corresponding to location '[DataSource=toyfactor
 y.database.windows.net Database=toystore_900]' could not be found in shard map 'toystorerangemap' .
   at Microsoft.Azure.SqlDatabase.ElasticScale.ShardManagement.ShardMap.GetShard(ShardLocation location)
       at Microsoft.Azure.SqlDatabase.ElasticScale.SplitMerge.Worker.SplitMergeService.DoSplitMergeInternal[T](SplitMergeRequestContext`1 requestContext) in d:\_Bld\808
   9\4133\Sources\Src\ShardSplitMerge\FsmWorkerRole\Service\SplitMergeService.cs:line 542
   --- End of inner exception stack trace ---
       at Microsoft.Azure.SqlDatabase.ElasticScale.SplitMerge.Worker.SplitMergeService.DoSplitMergeInternal[T](SplitMergeRequestContext`1 requestContext) in d:\_Bld\808
   9\4133\Sources\Src\ShardSplitMerge\FsmWorkerRole\Service\SplitMergeService.cs:line 631
       at Microsoft.Azure.SqlDatabase.ElasticScale.SplitMerge.Worker.SplitMergeService.ExecuteOne(SqlMessageFetcher sqlMessageFetcher) in d:\_Bld\8089\4133\Sources\Src\
   ShardSplitMerge\FsmWorkerRole\Service\SplitMergeService.cs:line 377
       at Microsoft.Azure.SqlDatabase.ElasticScale.SplitMerge.Worker.SplitMergeService.TryExecuteOne(SqlMessageFetcher sqlMessageFetcher, MessageDeletionStrategy messag
   eDeletionStrategy) in d:\_Bld\8089\4133\Sources\Src\ShardSplitMerge\FsmWorkerRole\Service\SplitMergeService.cs:line 212
MessageOperationId: ab71b957-6dc1-4e9d-807d-c2f20ae62dc1
ErrorCode: ShardNotFound

PS C:\Code\Lesson06\Splitting> clear
PS C:\Code\Lesson06\Splitting> .\SplitToyStoreShard.ps1 -ResourceGroup toystore -SqlServer toyfactory -UserName sqladmin -Password Packt@pub2 -SplitMergeDatabase toystore_splitmerge -SplitMergeServiceEndpoint "https://splitmerge.cloudapp.net/" -ShardMapManagerDatabaseName toystore_SMM -Shard2 toystore_Shard_900 -ShardMapName toystorerangemap -SplitRangeLow 800 -SplitRangeHigh 1000 -SplitValue 900
Transcript started, output file is C:\Code\Lesson06\Splitting\Log\SplitToyStoreShard.txt
WARNING: The output object type of this cmdlet will be modified in a future release.


ResourceGroupName : toystore
Location          : eastus2
ProvisioningState : Succeeded
Tags              :
ResourceId        : /subscriptions/bf64f3c6-6e64-48c5-a7cc-6c35b4f9aebf/resourceGroups/toystore



ResourceGroupName        : toystore
ServerName               : toyfactory
Location                 : East US 2
SqlAdministratorLogin    : sqladmin
SqlAdministratorPassword :
ServerVersion            : 12.0
Tags                     :



ResourceGroupName             : toystore
ServerName                    : toyfactory
DatabaseName                  : toystore_splitmerge
Location                      : East US 2
DatabaseId                    : 0c8a58bf-7e77-40be-9bb5-bbf3fb976af6
Edition                       : Basic
CollationName                 : SQL_Latin1_General_CP1_CI_AS
CatalogCollation              :
MaxSizeBytes                  : 2147483648
Status                        : Online
CreationDate                  : 12/22/2017 1:17:29 PM
CurrentServiceObjectiveId     : dd6d99bb-f193-4ec1-86f2-43d3bccbc49c
CurrentServiceObjectiveName   : Basic
RequestedServiceObjectiveId   : dd6d99bb-f193-4ec1-86f2-43d3bccbc49c
RequestedServiceObjectiveName :
ElasticPoolName               :
EarliestRestoreDate           : 12/22/2017 1:48:41 PM
Tags                          :
ResourceId                    : /subscriptions/bf64f3c6-6e64-48c5-a7cc-6c35b4f9aebf/resourceGroups/toystore/providers/Microsoft.Sql/servers/toyfactory/databases/toystore
                                _splitmerge
CreateMode                    :


Sending split request
Polling request status. Press Ctrl-C to end
Progress: 0% | Status: Queued | Details: [Informational] Operation has been queued.
Progress: 100% | Status: Failed | Details: [Error] Failed to process request. Microsoft.Azure.SqlDatabase.ElasticScale.SplitMerge.Worker.InvalidSplitMergeOperationException: The source mapping could not be found in the shard map 'toystorerangemap' using the lookup key '900'. ---> Microsoft.Azure.SqlDatabase.ElasticScale.ShardManagement.ShardManagementException: Mapping containing the given key value could not be located in the shard map 'toystorerangemap'. Error occurred while executing stored procedure '__ShardManagement.spFindShardMappingByKeyGlobal' for operation 'Lookup'.
   at Microsoft.Azure.SqlDatabase.ElasticScale.ShardManagement.RangeShardMapper`1.Lookup(TKey key, Boolean useCache)
   at Microsoft.Azure.SqlDatabase.ElasticScale.ShardManagement.RangeShardMap`1.GetMappingForKey(TKey key)
   at Microsoft.Azure.SqlDatabase.ElasticScale.SplitMerge.Worker.ShardMapManagerAbstraction.RangeShardMapAbstraction`1.GetMappingForKey(T key) in d:\_Bld\8089\4133\Sources\Src\ShardSplitMerge\FsmWorkerRole\ShardMapManagerAbstraction\ShardMap.cs:line 299
   at Microsoft.Azure.SqlDatabase.ElasticScale.SplitMerge.Worker.SplitMergeService.DoSplitMergeInternal[T](SplitMergeRequestContext`1 requestContext) in d:\_Bld\8089\4133\Sources\Src\ShardSplitMerge\FsmWorkerRole\Service\SplitMergeService.cs:line 455
   --- End of inner exception stack trace ---
   at Microsoft.Azure.SqlDatabase.ElasticScale.SplitMerge.Worker.SplitMergeService.DoSplitMergeInternal[T](SplitMergeRequestContext`1 requestContext) in d:\_Bld\8089\4133\Sources\Src\ShardSplitMerge\FsmWorkerRole\Service\SplitMergeService.cs:line 631
   at Microsoft.Azure.SqlDatabase.ElasticScale.SplitMerge.Worker.SplitMergeService.ExecuteOne(SqlMessageFetcher sqlMessageFetcher) in d:\_Bld\8089\4133\Sources\Src\ShardSplitMerge\FsmWorkerRole\Service\SplitMergeService.cs:line 377
   at Microsoft.Azure.SqlDatabase.ElasticScale.SplitMerge.Worker.SplitMergeService.TryExecuteOne(SqlMessageFetcher sqlMessageFetcher, MessageDeletionStrategy messageDeletionStrategy) in d:\_Bld\8089\4133\Sources\Src\ShardSplitMerge\FsmWorkerRole\Service\SplitMergeService.cs:line 212
MessageOperationId: 0cfc1199-139f-4a67-996b-225f12de0452
ErrorCode: SourceMappingNotFound
PS C:\Code\Lesson06\Splitting> TerminatingError(): "[Error] Failed to process request. Microsoft.Azure.SqlDatabase.ElasticScale.SplitMerge.Worker.InvalidSplitMergeOperationException: The source mapping could not be found in the shard map 'toystorerangemap' using the lookup key '900'. ---> Microsoft.Azure.SqlDatabase.ElasticScale.ShardManagement.ShardManagementException: Mapping containing the given key value could not be located in the shard map 'toystorerangemap'. Error occurred while executing stored procedure '__ShardManagement.spFindShardMappingByKeyGlobal' for operation 'Lookup'.
   at Microsoft.Azure.SqlDatabase.ElasticScale.ShardManagement.RangeShardMapper`1.Lookup(TKey key, Boolean useCache)
   at Microsoft.Azure.SqlDatabase.ElasticScale.ShardManagement.RangeShardMap`1.GetMappingForKey(TKey key)
   at Microsoft.Azure.SqlDatabase.ElasticScale.SplitMerge.Worker.ShardMapManagerAbstraction.RangeShardMapAbstraction`1.GetMappingForKey(T key) in d:\_Bld\8089\4133\Sources\Src\ShardSplitMerge\FsmWorkerRole\ShardMapManagerAbstraction\ShardMap.cs:line 299
   at Microsoft.Azure.SqlDatabase.ElasticScale.SplitMerge.Worker.SplitMergeService.DoSplitMergeInternal[T](SplitMergeRequestContext`1 requestContext) in d:\_Bld\8089\4133\Sources\Src\ShardSplitMerge\FsmWorkerRole\Service\SplitMergeService.cs:line 455
   --- End of inner exception stack trace ---
   at Microsoft.Azure.SqlDatabase.ElasticScale.SplitMerge.Worker.SplitMergeService.DoSplitMergeInternal[T](SplitMergeRequestContext`1 requestContext) in d:\_Bld\8089\4133\Sources\Src\ShardSplitMerge\FsmWorkerRole\Service\SplitMergeService.cs:line 631
   at Microsoft.Azure.SqlDatabase.ElasticScale.SplitMerge.Worker.SplitMergeService.ExecuteOne(SqlMessageFetcher sqlMessageFetcher) in d:\_Bld\8089\4133\Sources\Src\ShardSplitMerge\FsmWorkerRole\Service\SplitMergeService.cs:line 377
   at Microsoft.Azure.SqlDatabase.ElasticScale.SplitMerge.Worker.SplitMergeService.TryExecuteOne(SqlMessageFetcher sqlMessageFetcher, MessageDeletionStrategy messageDeletionStrategy) in d:\_Bld\8089\4133\Sources\Src\ShardSplitMerge\FsmWorkerRole\Service\SplitMergeService.cs:line 212
MessageOperationId: 0cfc1199-139f-4a67-996b-225f12de0452
ErrorCode: SourceMappingNotFound"
>> TerminatingError(): "[Error] Failed to process request. Microsoft.Azure.SqlDatabase.ElasticScale.SplitMerge.Worker.InvalidSplitMergeOperationException: The source mapping could not be found in the shard map 'toystorerangemap' using the lookup key '900'. ---> Microsoft.Azure.SqlDatabase.ElasticScale.ShardManagement.ShardManagementException: Mapping containing the given key value could not be located in the shard map 'toystorerangemap'. Error occurred while executing stored procedure '__ShardManagement.spFindShardMappingByKeyGlobal' for operation 'Lookup'.
   at Microsoft.Azure.SqlDatabase.ElasticScale.ShardManagement.RangeShardMapper`1.Lookup(TKey key, Boolean useCache)
   at Microsoft.Azure.SqlDatabase.ElasticScale.ShardManagement.RangeShardMap`1.GetMappingForKey(TKey key)
   at Microsoft.Azure.SqlDatabase.ElasticScale.SplitMerge.Worker.ShardMapManagerAbstraction.RangeShardMapAbstraction`1.GetMappingForKey(T key) in d:\_Bld\8089\4133\Sources\Src\ShardSplitMerge\FsmWorkerRole\ShardMapManagerAbstraction\ShardMap.cs:line 299
   at Microsoft.Azure.SqlDatabase.ElasticScale.SplitMerge.Worker.SplitMergeService.DoSplitMergeInternal[T](SplitMergeRequestContext`1 requestContext) in d:\_Bld\8089\4133\Sources\Src\ShardSplitMerge\FsmWorkerRole\Service\SplitMergeService.cs:line 455
   --- End of inner exception stack trace ---
   at Microsoft.Azure.SqlDatabase.ElasticScale.SplitMerge.Worker.SplitMergeService.DoSplitMergeInternal[T](SplitMergeRequestContext`1 requestContext) in d:\_Bld\8089\4133\Sources\Src\ShardSplitMerge\FsmWorkerRole\Service\SplitMergeService.cs:line 631
   at Microsoft.Azure.SqlDatabase.ElasticScale.SplitMerge.Worker.SplitMergeService.ExecuteOne(SqlMessageFetcher sqlMessageFetcher) in d:\_Bld\8089\4133\Sources\Src\ShardSplitMerge\FsmWorkerRole\Service\SplitMergeService.cs:line 377
   at Microsoft.Azure.SqlDatabase.ElasticScale.SplitMerge.Worker.SplitMergeService.TryExecuteOne(SqlMessageFetcher sqlMessageFetcher, MessageDeletionStrategy messageDeletionStrategy) in d:\_Bld\8089\4133\Sources\Src\ShardSplitMerge\FsmWorkerRole\Service\SplitMergeService.cs:line 212
MessageOperationId: 0cfc1199-139f-4a67-996b-225f12de0452
ErrorCode: SourceMappingNotFound"
>> TerminatingError(): "[Error] Failed to process request. Microsoft.Azure.SqlDatabase.ElasticScale.SplitMerge.Worker.InvalidSplitMergeOperationException: The source mapping could not be found in the shard map 'toystorerangemap' using the lookup key '900'. ---> Microsoft.Azure.SqlDatabase.ElasticScale.ShardManagement.ShardManagementException: Mapping containing the given key value could not be located in the shard map 'toystorerangemap'. Error occurred while executing stored procedure '__ShardManagement.spFindShardMappingByKeyGlobal' for operation 'Lookup'.
   at Microsoft.Azure.SqlDatabase.ElasticScale.ShardManagement.RangeShardMapper`1.Lookup(TKey key, Boolean useCache)
   at Microsoft.Azure.SqlDatabase.ElasticScale.ShardManagement.RangeShardMap`1.GetMappingForKey(TKey key)
   at Microsoft.Azure.SqlDatabase.ElasticScale.SplitMerge.Worker.ShardMapManagerAbstraction.RangeShardMapAbstraction`1.GetMappingForKey(T key) in d:\_Bld\8089\4133\Sources\Src\ShardSplitMerge\FsmWorkerRole\ShardMapManagerAbstraction\ShardMap.cs:line 299
   at Microsoft.Azure.SqlDatabase.ElasticScale.SplitMerge.Worker.SplitMergeService.DoSplitMergeInternal[T](SplitMergeRequestContext`1 requestContext) in d:\_Bld\8089\4133\Sources\Src\ShardSplitMerge\FsmWorkerRole\Service\SplitMergeService.cs:line 455
   --- End of inner exception stack trace ---
   at Microsoft.Azure.SqlDatabase.ElasticScale.SplitMerge.Worker.SplitMergeService.DoSplitMergeInternal[T](SplitMergeRequestContext`1 requestContext) in d:\_Bld\8089\4133\Sources\Src\ShardSplitMerge\FsmWorkerRole\Service\SplitMergeService.cs:line 631
   at Microsoft.Azure.SqlDatabase.ElasticScale.SplitMerge.Worker.SplitMergeService.ExecuteOne(SqlMessageFetcher sqlMessageFetcher) in d:\_Bld\8089\4133\Sources\Src\ShardSplitMerge\FsmWorkerRole\Service\SplitMergeService.cs:line 377
   at Microsoft.Azure.SqlDatabase.ElasticScale.SplitMerge.Worker.SplitMergeService.TryExecuteOne(SqlMessageFetcher sqlMessageFetcher, MessageDeletionStrategy messageDeletionStrategy) in d:\_Bld\8089\4133\Sources\Src\ShardSplitMerge\FsmWorkerRole\Service\SplitMergeService.cs:line 212
MessageOperationId: 0cfc1199-139f-4a67-996b-225f12de0452
ErrorCode: SourceMappingNotFound"
[Error] Failed to process request. Microsoft.Azure.SqlDatabase.ElasticScale.SplitMerge.Worker.InvalidSplitMergeOperationException: The source mapping could not be found
in the shard map 'toystorerangemap' using the lookup key '900'. ---> Microsoft.Azure.SqlDatabase.ElasticScale.ShardManagement.ShardManagementException: Mapping
containing the given key value could not be located in the shard map 'toystorerangemap'. Error occurred while executing stored procedure
'__ShardManagement.spFindShardMappingByKeyGlobal' for operation 'Lookup'.
   at Microsoft.Azure.SqlDatabase.ElasticScale.ShardManagement.RangeShardMapper`1.Lookup(TKey key, Boolean useCache)
   at Microsoft.Azure.SqlDatabase.ElasticScale.ShardManagement.RangeShardMap`1.GetMappingForKey(TKey key)
   at Microsoft.Azure.SqlDatabase.ElasticScale.SplitMerge.Worker.ShardMapManagerAbstraction.RangeShardMapAbstraction`1.GetMappingForKey(T key) in
d:\_Bld\8089\4133\Sources\Src\ShardSplitMerge\FsmWorkerRole\ShardMapManagerAbstraction\ShardMap.cs:line 299
   at Microsoft.Azure.SqlDatabase.ElasticScale.SplitMerge.Worker.SplitMergeService.DoSplitMergeInternal[T](SplitMergeRequestContext`1 requestContext) in
d:\_Bld\8089\4133\Sources\Src\ShardSplitMerge\FsmWorkerRole\Service\SplitMergeService.cs:line 455
   --- End of inner exception stack trace ---
   at Microsoft.Azure.SqlDatabase.ElasticScale.SplitMerge.Worker.SplitMergeService.DoSplitMergeInternal[T](SplitMergeRequestContext`1 requestContext) in
d:\_Bld\8089\4133\Sources\Src\ShardSplitMerge\FsmWorkerRole\Service\SplitMergeService.cs:line 631
   at Microsoft.Azure.SqlDatabase.ElasticScale.SplitMerge.Worker.SplitMergeService.ExecuteOne(SqlMessageFetcher sqlMessageFetcher) in
d:\_Bld\8089\4133\Sources\Src\ShardSplitMerge\FsmWorkerRole\Service\SplitMergeService.cs:line 377
   at Microsoft.Azure.SqlDatabase.ElasticScale.SplitMerge.Worker.SplitMergeService.TryExecuteOne(SqlMessageFetcher sqlMessageFetcher, MessageDeletionStrategy
messageDeletionStrategy) in d:\_Bld\8089\4133\Sources\Src\ShardSplitMerge\FsmWorkerRole\Service\SplitMergeService.cs:line 212
MessageOperationId: 0cfc1199-139f-4a67-996b-225f12de0452
ErrorCode: SourceMappingNotFound
At C:\Code\Lesson06\Splitting\SplitMerge\SplitMerge.psm1:363 char:13
+             throw $statusJson.Details
+             ~~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : OperationStopped: ([Error] Failed ...MappingNotFound:String) [], RuntimeException
    + FullyQualifiedErrorId : [Error] Failed to process request. Microsoft.Azure.SqlDatabase.ElasticScale.SplitMerge.Worker.InvalidSplitMergeOperationException: The sou
   rce mapping could not be found in the shard map 'toystorerangemap' using the lookup key '900'. ---> Microsoft.Azure.SqlDatabase.ElasticScale.ShardManagement.ShardMa
  nagementException: Mapping containing the given key value could not be located in the shard map 'toystorerangemap'. Error occurred while executing stored procedure
 '__ShardManagement.spFindShardMappingByKeyGlobal' for operation 'Lookup'.
   at Microsoft.Azure.SqlDatabase.ElasticScale.ShardManagement.RangeShardMapper`1.Lookup(TKey key, Boolean useCache)
   at Microsoft.Azure.SqlDatabase.ElasticScale.ShardManagement.RangeShardMap`1.GetMappingForKey(TKey key)
       at Microsoft.Azure.SqlDatabase.ElasticScale.SplitMerge.Worker.ShardMapManagerAbstraction.RangeShardMapAbstraction`1.GetMappingForKey(T key) in d:\_Bld\8089\4133\
   Sources\Src\ShardSplitMerge\FsmWorkerRole\ShardMapManagerAbstraction\ShardMap.cs:line 299
       at Microsoft.Azure.SqlDatabase.ElasticScale.SplitMerge.Worker.SplitMergeService.DoSplitMergeInternal[T](SplitMergeRequestContext`1 requestContext) in d:\_Bld\808
   9\4133\Sources\Src\ShardSplitMerge\FsmWorkerRole\Service\SplitMergeService.cs:line 455
   --- End of inner exception stack trace ---
       at Microsoft.Azure.SqlDatabase.ElasticScale.SplitMerge.Worker.SplitMergeService.DoSplitMergeInternal[T](SplitMergeRequestContext`1 requestContext) in d:\_Bld\808
   9\4133\Sources\Src\ShardSplitMerge\FsmWorkerRole\Service\SplitMergeService.cs:line 631
       at Microsoft.Azure.SqlDatabase.ElasticScale.SplitMerge.Worker.SplitMergeService.ExecuteOne(SqlMessageFetcher sqlMessageFetcher) in d:\_Bld\8089\4133\Sources\Src\
   ShardSplitMerge\FsmWorkerRole\Service\SplitMergeService.cs:line 377
       at Microsoft.Azure.SqlDatabase.ElasticScale.SplitMerge.Worker.SplitMergeService.TryExecuteOne(SqlMessageFetcher sqlMessageFetcher, MessageDeletionStrategy messag
   eDeletionStrategy) in d:\_Bld\8089\4133\Sources\Src\ShardSplitMerge\FsmWorkerRole\Service\SplitMergeService.cs:line 212
MessageOperationId: 0cfc1199-139f-4a67-996b-225f12de0452
ErrorCode: SourceMappingNotFound

PS C:\Code\Lesson06\Splitting> .\SplitToyStoreShard.ps1 -ResourceGroup toystore -SqlServer toyfactory -UserName sqladmin -Password Packt@pub2 -SplitMergeDatabase toystore_splitmerge -SplitMergeServiceEndpoint "https://splitmerge.cloudapp.net/" -ShardMapManagerDatabaseName toystore_SMM -Shard2 toystore_Shard_900 -ShardMapName toystorerangemap -SplitRangeLow 800 -SplitRangeHigh 1000 -SplitValue 800
Transcript started, output file is C:\Code\Lesson06\Splitting\Log\SplitToyStoreShard.txt
WARNING: The output object type of this cmdlet will be modified in a future release.


ResourceGroupName : toystore
Location          : eastus2
ProvisioningState : Succeeded
Tags              :
ResourceId        : /subscriptions/bf64f3c6-6e64-48c5-a7cc-6c35b4f9aebf/resourceGroups/toystore



ResourceGroupName        : toystore
ServerName               : toyfactory
Location                 : East US 2
SqlAdministratorLogin    : sqladmin
SqlAdministratorPassword :
ServerVersion            : 12.0
Tags                     :



ResourceGroupName             : toystore
ServerName                    : toyfactory
DatabaseName                  : toystore_splitmerge
Location                      : East US 2
DatabaseId                    : 0c8a58bf-7e77-40be-9bb5-bbf3fb976af6
Edition                       : Basic
CollationName                 : SQL_Latin1_General_CP1_CI_AS
CatalogCollation              :
MaxSizeBytes                  : 2147483648
Status                        : Online
CreationDate                  : 12/22/2017 1:17:29 PM
CurrentServiceObjectiveId     : dd6d99bb-f193-4ec1-86f2-43d3bccbc49c
CurrentServiceObjectiveName   : Basic
RequestedServiceObjectiveId   : dd6d99bb-f193-4ec1-86f2-43d3bccbc49c
RequestedServiceObjectiveName :
ElasticPoolName               :
EarliestRestoreDate           : 12/22/2017 1:48:41 PM
Tags                          :
ResourceId                    : /subscriptions/bf64f3c6-6e64-48c5-a7cc-6c35b4f9aebf/resourceGroups/toystore/providers/Microsoft.Sql/servers/toyfactory/databases/toystore
                                _splitmerge
CreateMode                    :


Sending split request
Polling request status. Press Ctrl-C to end
Progress: 0% | Status: Queued | Details: [Informational] Operation has been queued.
Progress: 5% | Status: Starting | Details: [Informational] Starting Split-Merge state machine for request.
Progress: 100% | Status: Failed | Details: [Error] The request failed.
PS C:\Code\Lesson06\Splitting> TerminatingError(): "[Error] The request failed."
>> TerminatingError(): "[Error] The request failed."
>> TerminatingError(): "[Error] The request failed."
[Error] The request failed.
At C:\Code\Lesson06\Splitting\SplitMerge\SplitMerge.psm1:363 char:13
+             throw $statusJson.Details
+             ~~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : OperationStopped: ([Error] The request failed.:String) [], RuntimeException
    + FullyQualifiedErrorId : [Error] The request failed.

PS C:\Code\Lesson06\Splitting> .\SplitToyStoreShard.ps1 -ResourceGroup toystore -SqlServer toyfactory -UserName sqladmin -Password Packt@pub2 -SplitMergeDatabase toystore_splitmerge -SplitMergeServiceEndpoint "https://splitmerge.cloudapp.net/" -ShardMapManagerDatabaseName toystore_SMM -Shard2 toystore_Shard_900 -ShardMapName toystorerangemap -SplitRangeLow 0 -SplitRangeHigh 2000 -SplitValue 800
Transcript started, output file is C:\Code\Lesson06\Splitting\Log\SplitToyStoreShard.txt
WARNING: The output object type of this cmdlet will be modified in a future release.


ResourceGroupName : toystore
Location          : eastus2
ProvisioningState : Succeeded
Tags              :
ResourceId        : /subscriptions/bf64f3c6-6e64-48c5-a7cc-6c35b4f9aebf/resourceGroups/toystore



ResourceGroupName        : toystore
ServerName               : toyfactory
Location                 : East US 2
SqlAdministratorLogin    : sqladmin
SqlAdministratorPassword :
ServerVersion            : 12.0
Tags                     :



ResourceGroupName             : toystore
ServerName                    : toyfactory
DatabaseName                  : toystore_splitmerge
Location                      : East US 2
DatabaseId                    : 0c8a58bf-7e77-40be-9bb5-bbf3fb976af6
Edition                       : Basic
CollationName                 : SQL_Latin1_General_CP1_CI_AS
CatalogCollation              :
MaxSizeBytes                  : 2147483648
Status                        : Online
CreationDate                  : 12/22/2017 1:17:29 PM
CurrentServiceObjectiveId     : dd6d99bb-f193-4ec1-86f2-43d3bccbc49c
CurrentServiceObjectiveName   : Basic
RequestedServiceObjectiveId   : dd6d99bb-f193-4ec1-86f2-43d3bccbc49c
RequestedServiceObjectiveName :
ElasticPoolName               :
EarliestRestoreDate           : 12/22/2017 1:48:41 PM
Tags                          :
ResourceId                    : /subscriptions/bf64f3c6-6e64-48c5-a7cc-6c35b4f9aebf/resourceGroups/toystore/providers/Microsoft.Sql/servers/toyfactory/databases/toystore
                                _splitmerge
CreateMode                    :


Sending split request
Polling request status. Press Ctrl-C to end
Progress: 0% | Status: Queued | Details: [Informational] Operation has been queued.
Progress: 100% | Status: Failed | Details: [Error] The request failed.
PS C:\Code\Lesson06\Splitting> TerminatingError(): "[Error] The request failed."
>> TerminatingError(): "[Error] The request failed."
>> TerminatingError(): "[Error] The request failed."
[Error] The request failed.
At C:\Code\Lesson06\Splitting\SplitMerge\SplitMerge.psm1:363 char:13
+             throw $statusJson.Details
+             ~~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : OperationStopped: ([Error] The request failed.:String) [], RuntimeException
    + FullyQualifiedErrorId : [Error] The request failed.

PS C:\Code\Lesson06\Splitting> cd ..
PS C:\Code\Lesson06> clear
PS C:\Code\Lesson06> cd .\Sharding
PS C:\Code\Lesson06\Sharding> .\Sharding.ps1 -ResourceGroup toystore -SqlServer toyfactory -UserName sqladmin -Password Packt@pub2 -ShardMapManagerDatabase toystore_SMM -DatabaseToShard 
>> TerminatingError(Sharding.ps1): "Missing an argument for parameter 'DatabaseToShard'. Specify a parameter of type 'System.String' and try again."
C:\Code\Lesson06\Sharding\Sharding.ps1 : Missing an argument for parameter 'DatabaseToShard'. Specify a parameter of 
type 'System.String' and try again.
At line:1 char:140
+ ... ord Packt@pub2 -ShardMapManagerDatabase toystore_SMM -DatabaseToShard
+                                                          ~~~~~~~~~~~~~~~~
    + CategoryInfo          : InvalidArgument: (:) [Sharding.ps1], ParameterBindingException
    + FullyQualifiedErrorId : MissingArgument,Sharding.ps1
C:\Code\Lesson06\Sharding\Sharding.ps1 : Missing an argument for parameter 'DatabaseToShard'. Specify a parameter of type 'System.String' and try again.
At line:1 char:140
+ ... ord Packt@pub2 -ShardMapManagerDatabase toystore_SMM -DatabaseToShard
+                                                          ~~~~~~~~~~~~~~~~
    + CategoryInfo          : InvalidArgument: (:) [Sharding.ps1], ParameterBindingException
    + FullyQualifiedErrorId : MissingArgument,Sharding.ps1

PS C:\Code\Lesson06\Sharding> .\Sharding.ps1 -ResourceGroup toystore -SqlServer toyfactory -UserName sqladmin -Password Packt@pub2 -ShardMapManagerDatabase toystore_SMM -DatabaseToShard toystore
Transcript started, output file is C:\Code\Lesson06\Sharding\Log\Sharding.txt
PS C:\Code\Lesson06\Sharding> TerminatingError(Set-AzureRmContext): "Cannot validate argument on parameter 'SubscriptionId'. The argument is null or empty. Provide an argument that is not null or empty, and then try the command again."
Set-AzureRmContext : Cannot validate argument on parameter 'SubscriptionId'. The argument is null or empty. Provide an 
argument that is not null or empty, and then try the command again.
At C:\Code\Lesson06\Sharding\Sharding.ps1:48 char:36
+ Set-AzureRmContext -SubscriptionId $SubscriptionID | Out-Null
+                                    ~~~~~~~~~~~~~~~
    + CategoryInfo          : InvalidData: (:) [Set-AzureRmContext], ParameterBindingValidationException
    + FullyQualifiedErrorId : ParameterArgumentValidationError,Microsoft.Azure.Commands.Profile.SetAzureRMContextCommand
Set-AzureRmContext : Cannot validate argument on parameter 'SubscriptionId'. The argument is null or empty. Provide an argument that is not null or empty, and then try
the command again.
At C:\Code\Lesson06\Sharding\Sharding.ps1:48 char:36
+ Set-AzureRmContext -SubscriptionId $SubscriptionID | Out-Null
+                                    ~~~~~~~~~~~~~~~
    + CategoryInfo          : InvalidData: (:) [Set-AzureRmContext], ParameterBindingValidationException
    + FullyQualifiedErrorId : ParameterArgumentValidationError,Microsoft.Azure.Commands.Profile.SetAzureRMContextCommand

>> TerminatingError(Get-AzureRmResourceGroup): "Run Login-AzureRmAccount to login."
Get-AzureRmResourceGroup : Run Login-AzureRmAccount to login.
At C:\Code\Lesson06\Sharding\ProvisionAzureSQLDatabase.ps1:29 char:1
+ Get-AzureRmResourceGroup -Name $ResourceGroup -Location $Location -Er ...
+ ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : InvalidOperation: (:) [Get-AzureRmResourceGroup], PSInvalidOperationException
    + FullyQualifiedErrorId : InvalidOperation,Microsoft.Azure.Commands.Resources.GetAzureResourceGroupCommand
Get-AzureRmResourceGroup : Run Login-AzureRmAccount to login.
At C:\Code\Lesson06\Sharding\ProvisionAzureSQLDatabase.ps1:29 char:1
+ Get-AzureRmResourceGroup -Name $ResourceGroup -Location $Location -Er ...
+ ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : InvalidOperation: (:) [Get-AzureRmResourceGroup], PSInvalidOperationException
    + FullyQualifiedErrorId : InvalidOperation,Microsoft.Azure.Commands.Resources.GetAzureResourceGroupCommand

Provisioning Azure Resource Group toystore
PS C:\Code\Lesson06\Sharding> TerminatingError(New-AzureRmResourceGroup): "Run Login-AzureRmAccount to login."
New-AzureRmResourceGroup : Run Login-AzureRmAccount to login.
At C:\Code\Lesson06\Sharding\ProvisionAzureSQLDatabase.ps1:40 char:1
+ New-AzureRmResourceGroup @_ResourceGroup;
+ ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : InvalidOperation: (:) [New-AzureRmResourceGroup], PSInvalidOperationException
    + FullyQualifiedErrorId : InvalidOperation,Microsoft.Azure.Commands.Resources.NewAzureResourceGroupCommand
New-AzureRmResourceGroup : Run Login-AzureRmAccount to login.
At C:\Code\Lesson06\Sharding\ProvisionAzureSQLDatabase.ps1:40 char:1
+ New-AzureRmResourceGroup @_ResourceGroup;
+ ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : InvalidOperation: (:) [New-AzureRmResourceGroup], PSInvalidOperationException
    + FullyQualifiedErrorId : InvalidOperation,Microsoft.Azure.Commands.Resources.NewAzureResourceGroupCommand

>> TerminatingError(Get-AzureRmSqlServer): "Run Login-AzureRmAccount to login."
Get-AzureRmSqlServer : Run Login-AzureRmAccount to login.
At C:\Code\Lesson06\Sharding\ProvisionAzureSQLDatabase.ps1:49 char:1
+ Get-AzureRmSqlServer -ServerName $SQLServer -ResourceGroupName $Resou ...
+ ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : InvalidOperation: (:) [Get-AzureRmSqlServer], PSInvalidOperationException
    + FullyQualifiedErrorId : InvalidOperation,Microsoft.Azure.Commands.Sql.Server.Cmdlet.GetAzureSqlServer
Get-AzureRmSqlServer : Run Login-AzureRmAccount to login.
At C:\Code\Lesson06\Sharding\ProvisionAzureSQLDatabase.ps1:49 char:1
+ Get-AzureRmSqlServer -ServerName $SQLServer -ResourceGroupName $Resou ...
+ ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : InvalidOperation: (:) [Get-AzureRmSqlServer], PSInvalidOperationException
    + FullyQualifiedErrorId : InvalidOperation,Microsoft.Azure.Commands.Sql.Server.Cmdlet.GetAzureSqlServer

Provisioning Azure SQL Server toyfactory
PS C:\Code\Lesson06\Sharding> TerminatingError(New-AzureRmSqlServer): "Run Login-AzureRmAccount to login."
New-AzureRmSqlServer : Run Login-AzureRmAccount to login.
At C:\Code\Lesson06\Sharding\ProvisionAzureSQLDatabase.ps1:65 char:1
+ New-AzureRmSqlServer @_SqlServer;
+ ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : InvalidOperation: (:) [New-AzureRmSqlServer], PSInvalidOperationException
    + FullyQualifiedErrorId : InvalidOperation,Microsoft.Azure.Commands.Sql.Server.Cmdlet.NewAzureSqlServer
New-AzureRmSqlServer : Run Login-AzureRmAccount to login.
At C:\Code\Lesson06\Sharding\ProvisionAzureSQLDatabase.ps1:65 char:1
+ New-AzureRmSqlServer @_SqlServer;
+ ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : InvalidOperation: (:) [New-AzureRmSqlServer], PSInvalidOperationException
    + FullyQualifiedErrorId : InvalidOperation,Microsoft.Azure.Commands.Sql.Server.Cmdlet.NewAzureSqlServer

>> TerminatingError(Get-AzureRmSqlDatabase): "Run Login-AzureRmAccount to login."
Get-AzureRmSqlDatabase : Run Login-AzureRmAccount to login.
At C:\Code\Lesson06\Sharding\ProvisionAzureSQLDatabase.ps1:74 char:1
+ Get-AzureRmSqlDatabase -DatabaseName $SQLDatabase -ServerName $SQLSer ...
+ ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : InvalidOperation: (:) [Get-AzureRmSqlDatabase], PSInvalidOperationException
    + FullyQualifiedErrorId : InvalidOperation,Microsoft.Azure.Commands.Sql.Database.Cmdlet.GetAzureSqlDatabase
Get-AzureRmSqlDatabase : Run Login-AzureRmAccount to login.
At C:\Code\Lesson06\Sharding\ProvisionAzureSQLDatabase.ps1:74 char:1
+ Get-AzureRmSqlDatabase -DatabaseName $SQLDatabase -ServerName $SQLSer ...
+ ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : InvalidOperation: (:) [Get-AzureRmSqlDatabase], PSInvalidOperationException
    + FullyQualifiedErrorId : InvalidOperation,Microsoft.Azure.Commands.Sql.Database.Cmdlet.GetAzureSqlDatabase

Provisioning Azure SQL Database toystore_SMM
PS C:\Code\Lesson06\Sharding> TerminatingError(New-AzureRmSqlDatabase): "Run Login-AzureRmAccount to login."
New-AzureRmSqlDatabase : Run Login-AzureRmAccount to login.
At C:\Code\Lesson06\Sharding\ProvisionAzureSQLDatabase.ps1:87 char:1
+ New-AzureRmSqlDatabase @_SqlDatabase;
+ ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : InvalidOperation: (:) [New-AzureRmSqlDatabase], PSInvalidOperationException
    + FullyQualifiedErrorId : InvalidOperation,Microsoft.Azure.Commands.Sql.Database.Cmdlet.NewAzureSqlDatabase
New-AzureRmSqlDatabase : Run Login-AzureRmAccount to login.
At C:\Code\Lesson06\Sharding\ProvisionAzureSQLDatabase.ps1:87 char:1
+ New-AzureRmSqlDatabase @_SqlDatabase;
+ ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : InvalidOperation: (:) [New-AzureRmSqlDatabase], PSInvalidOperationException
    + FullyQualifiedErrorId : InvalidOperation,Microsoft.Azure.Commands.Sql.Database.Cmdlet.NewAzureSqlDatabase

PS C:\Code\Lesson06\Sharding> TerminatingError(Set-AzureSqlDatabase): "Cannot validate argument on parameter 'Database'. The argument is null. Provide a valid value for the argument, and then try running the command again."
Set-AzureSqlDatabase : Cannot validate argument on parameter 'Database'. The argument is null. Provide a valid value 
for the argument, and then try running the command again.
At C:\Code\Lesson06\Sharding\Sharding.ps1:76 char:69
+ ... ectionContext $SqlServerContext -Database $SqlDatabaseContext -NewDat ...
+                                               ~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : InvalidData: (:) [Set-AzureSqlDatabase], ParameterBindingValidationException
    + FullyQualifiedErrorId : 
ParameterArgumentValidationError,Microsoft.WindowsAzure.Commands.SqlDatabase.Database.Cmdlet.SetAzureSqlDatabase
Set-AzureSqlDatabase : Cannot validate argument on parameter 'Database'. The argument is null. Provide a valid value for the argument, and then try running the command
again.
At C:\Code\Lesson06\Sharding\Sharding.ps1:76 char:69
+ ... ectionContext $SqlServerContext -Database $SqlDatabaseContext -NewDat ...
+                                               ~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : InvalidData: (:) [Set-AzureSqlDatabase], ParameterBindingValidationException
    + FullyQualifiedErrorId : ParameterArgumentValidationError,Microsoft.WindowsAzure.Commands.SqlDatabase.Database.Cmdlet.SetAzureSqlDatabase

>> TerminatingError(Get-AzureRmResourceGroup): "Run Login-AzureRmAccount to login."
Get-AzureRmResourceGroup : Run Login-AzureRmAccount to login.
At C:\Code\Lesson06\Sharding\ProvisionAzureSQLDatabase.ps1:29 char:1
+ Get-AzureRmResourceGroup -Name $ResourceGroup -Location $Location -Er ...
+ ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : InvalidOperation: (:) [Get-AzureRmResourceGroup], PSInvalidOperationException
    + FullyQualifiedErrorId : InvalidOperation,Microsoft.Azure.Commands.Resources.GetAzureResourceGroupCommand
Get-AzureRmResourceGroup : Run Login-AzureRmAccount to login.
At C:\Code\Lesson06\Sharding\ProvisionAzureSQLDatabase.ps1:29 char:1
+ Get-AzureRmResourceGroup -Name $ResourceGroup -Location $Location -Er ...
+ ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : InvalidOperation: (:) [Get-AzureRmResourceGroup], PSInvalidOperationException
    + FullyQualifiedErrorId : InvalidOperation,Microsoft.Azure.Commands.Resources.GetAzureResourceGroupCommand

Provisioning Azure Resource Group toystore
PS C:\Code\Lesson06\Sharding> TerminatingError(New-AzureRmResourceGroup): "Run Login-AzureRmAccount to login."
New-AzureRmResourceGroup : Run Login-AzureRmAccount to login.
At C:\Code\Lesson06\Sharding\ProvisionAzureSQLDatabase.ps1:40 char:1
+ New-AzureRmResourceGroup @_ResourceGroup;
+ ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : InvalidOperation: (:) [New-AzureRmResourceGroup], PSInvalidOperationException
    + FullyQualifiedErrorId : InvalidOperation,Microsoft.Azure.Commands.Resources.NewAzureResourceGroupCommand
New-AzureRmResourceGroup : Run Login-AzureRmAccount to login.
At C:\Code\Lesson06\Sharding\ProvisionAzureSQLDatabase.ps1:40 char:1
+ New-AzureRmResourceGroup @_ResourceGroup;
+ ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : InvalidOperation: (:) [New-AzureRmResourceGroup], PSInvalidOperationException
    + FullyQualifiedErrorId : InvalidOperation,Microsoft.Azure.Commands.Resources.NewAzureResourceGroupCommand

>> TerminatingError(Get-AzureRmSqlServer): "Run Login-AzureRmAccount to login."
Get-AzureRmSqlServer : Run Login-AzureRmAccount to login.
At C:\Code\Lesson06\Sharding\ProvisionAzureSQLDatabase.ps1:49 char:1
+ Get-AzureRmSqlServer -ServerName $SQLServer -ResourceGroupName $Resou ...
+ ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : InvalidOperation: (:) [Get-AzureRmSqlServer], PSInvalidOperationException
    + FullyQualifiedErrorId : InvalidOperation,Microsoft.Azure.Commands.Sql.Server.Cmdlet.GetAzureSqlServer
Get-AzureRmSqlServer : Run Login-AzureRmAccount to login.
At C:\Code\Lesson06\Sharding\ProvisionAzureSQLDatabase.ps1:49 char:1
+ Get-AzureRmSqlServer -ServerName $SQLServer -ResourceGroupName $Resou ...
+ ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : InvalidOperation: (:) [Get-AzureRmSqlServer], PSInvalidOperationException
    + FullyQualifiedErrorId : InvalidOperation,Microsoft.Azure.Commands.Sql.Server.Cmdlet.GetAzureSqlServer

Provisioning Azure SQL Server toyfactory
PS C:\Code\Lesson06\Sharding> TerminatingError(New-AzureRmSqlServer): "Run Login-AzureRmAccount to login."
New-AzureRmSqlServer : Run Login-AzureRmAccount to login.
At C:\Code\Lesson06\Sharding\ProvisionAzureSQLDatabase.ps1:65 char:1
+ New-AzureRmSqlServer @_SqlServer;
+ ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : InvalidOperation: (:) [New-AzureRmSqlServer], PSInvalidOperationException
    + FullyQualifiedErrorId : InvalidOperation,Microsoft.Azure.Commands.Sql.Server.Cmdlet.NewAzureSqlServer
New-AzureRmSqlServer : Run Login-AzureRmAccount to login.
At C:\Code\Lesson06\Sharding\ProvisionAzureSQLDatabase.ps1:65 char:1
+ New-AzureRmSqlServer @_SqlServer;
+ ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : InvalidOperation: (:) [New-AzureRmSqlServer], PSInvalidOperationException
    + FullyQualifiedErrorId : InvalidOperation,Microsoft.Azure.Commands.Sql.Server.Cmdlet.NewAzureSqlServer

>> TerminatingError(Get-AzureRmSqlDatabase): "Run Login-AzureRmAccount to login."
Get-AzureRmSqlDatabase : Run Login-AzureRmAccount to login.
At C:\Code\Lesson06\Sharding\ProvisionAzureSQLDatabase.ps1:74 char:1
+ Get-AzureRmSqlDatabase -DatabaseName $SQLDatabase -ServerName $SQLSer ...
+ ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : InvalidOperation: (:) [Get-AzureRmSqlDatabase], PSInvalidOperationException
    + FullyQualifiedErrorId : InvalidOperation,Microsoft.Azure.Commands.Sql.Database.Cmdlet.GetAzureSqlDatabase
Get-AzureRmSqlDatabase : Run Login-AzureRmAccount to login.
At C:\Code\Lesson06\Sharding\ProvisionAzureSQLDatabase.ps1:74 char:1
+ Get-AzureRmSqlDatabase -DatabaseName $SQLDatabase -ServerName $SQLSer ...
+ ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : InvalidOperation: (:) [Get-AzureRmSqlDatabase], PSInvalidOperationException
    + FullyQualifiedErrorId : InvalidOperation,Microsoft.Azure.Commands.Sql.Database.Cmdlet.GetAzureSqlDatabase

Provisioning Azure SQL Database toystore_Shard_900
PS C:\Code\Lesson06\Sharding> TerminatingError(New-AzureRmSqlDatabase): "Run Login-AzureRmAccount to login."
New-AzureRmSqlDatabase : Run Login-AzureRmAccount to login.
At C:\Code\Lesson06\Sharding\ProvisionAzureSQLDatabase.ps1:87 char:1
+ New-AzureRmSqlDatabase @_SqlDatabase;
+ ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : InvalidOperation: (:) [New-AzureRmSqlDatabase], PSInvalidOperationException
    + FullyQualifiedErrorId : InvalidOperation,Microsoft.Azure.Commands.Sql.Database.Cmdlet.NewAzureSqlDatabase
PS C:\Code\Lesson06\Sharding> TerminatingError(): "The pipeline has been stopped."
>> TerminatingError(): "The pipeline has been stopped."
>> TerminatingError(): "The pipeline has been stopped."
>> TerminatingError(): "The pipeline has been stopped."
>> TerminatingError(): "The pipeline has been stopped."
PS C:\Code\Lesson06\Sharding> cls
PS C:\Code\Lesson06\Sharding> .\Sharding.ps1 -ResourceGroup toystore -SqlServer toyfactory -UserName sqladmin -Password Packt@pub2 -ShardMapManagerDatabase toystore_SMM -DatabaseToShard toystore
Transcript started, output file is C:\Code\Lesson06\Sharding\Log\Sharding.txt
WARNING: The output object type of this cmdlet will be modified in a future release.


ResourceGroupName : toystore
Location          : eastus2
ProvisioningState : Succeeded
Tags              :
ResourceId        : /subscriptions/bf64f3c6-6e64-48c5-a7cc-6c35b4f9aebf/resourceGroups/toystore



ResourceGroupName        : toystore
ServerName               : toyfactory
Location                 : East US 2
SqlAdministratorLogin    : sqladmin
SqlAdministratorPassword :
ServerVersion            : 12.0
Tags                     :



ResourceGroupName             : toystore
ServerName                    : toyfactory
DatabaseName                  : toystore_SMM
Location                      : East US 2
DatabaseId                    : 7a7003e9-031d-4c3c-bce4-f1e9814439b7
Edition                       : Standard
CollationName                 : SQL_Latin1_General_CP1_CI_AS
CatalogCollation              :
MaxSizeBytes                  : 268435456000
Status                        : Online
CreationDate                  : 12/23/2017 8:10:40 AM
CurrentServiceObjectiveId     : f1173c43-91bd-4aaa-973c-54e79e15235b
CurrentServiceObjectiveName   : S0
RequestedServiceObjectiveId   : f1173c43-91bd-4aaa-973c-54e79e15235b
RequestedServiceObjectiveName :
ElasticPoolName               :
EarliestRestoreDate           : 12/23/2017 8:41:43 AM
Tags                          :
ResourceId                    : /subscriptions/bf64f3c6-6e64-48c5-a7cc-6c35b4f9aebf/resourceGroups/toystore/providers/Microsoft.Sql/servers/toyfactory/databases/toystore
                                _SMM
CreateMode                    :


PS C:\Code\Lesson06\Sharding> TerminatingError(Set-AzureSqlDatabase): "Cannot validate argument on parameter 'Database'. The argument is null. Provide a valid value for the argument, and then try running the command again."
Set-AzureSqlDatabase : Cannot validate argument on parameter 'Database'. The argument is null. Provide a valid value 
for the argument, and then try running the command again.
At C:\Code\Lesson06\Sharding\Sharding.ps1:77 char:69
+ ... ectionContext $SqlServerContext -Database $SqlDatabaseContext -NewDat ...
+                                               ~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : InvalidData: (:) [Set-AzureSqlDatabase], ParameterBindingValidationException
    + FullyQualifiedErrorId : 
ParameterArgumentValidationError,Microsoft.WindowsAzure.Commands.SqlDatabase.Database.Cmdlet.SetAzureSqlDatabase
Set-AzureSqlDatabase : Cannot validate argument on parameter 'Database'. The argument is null. Provide a valid value for the argument, and then try running the command
again.
At C:\Code\Lesson06\Sharding\Sharding.ps1:77 char:69
+ ... ectionContext $SqlServerContext -Database $SqlDatabaseContext -NewDat ...
+                                               ~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : InvalidData: (:) [Set-AzureSqlDatabase], ParameterBindingValidationException
    + FullyQualifiedErrorId : ParameterArgumentValidationError,Microsoft.WindowsAzure.Commands.SqlDatabase.Database.Cmdlet.SetAzureSqlDatabase

WARNING: The output object type of this cmdlet will be modified in a future release.
ResourceGroupName : toystore
Location          : eastus2
ProvisioningState : Succeeded
Tags              :
ResourceId        : /subscriptions/bf64f3c6-6e64-48c5-a7cc-6c35b4f9aebf/resourceGroups/toystore



ResourceGroupName        : toystore
ServerName               : toyfactory
Location                 : East US 2
SqlAdministratorLogin    : sqladmin
SqlAdministratorPassword :
ServerVersion            : 12.0
Tags                     :



ResourceGroupName             : toystore
ServerName                    : toyfactory
DatabaseName                  : toystore_Shard_900
Location                      : East US 2
DatabaseId                    : 7ccf4b99-78f5-4950-90d2-07f8525db1cc
Edition                       : Standard
CollationName                 : SQL_Latin1_General_CP1_CI_AS
CatalogCollation              :
MaxSizeBytes                  : 268435456000
Status                        : Online
CreationDate                  : 12/23/2017 8:12:24 AM
CurrentServiceObjectiveId     : f1173c43-91bd-4aaa-973c-54e79e15235b
CurrentServiceObjectiveName   : S0
RequestedServiceObjectiveId   : f1173c43-91bd-4aaa-973c-54e79e15235b
RequestedServiceObjectiveName :
ElasticPoolName               :
EarliestRestoreDate           : 12/23/2017 8:43:50 AM
Tags                          :
ResourceId                    : /subscriptions/bf64f3c6-6e64-48c5-a7cc-6c35b4f9aebf/resourceGroups/toystore/providers/Microsoft.Sql/servers/toyfactory/databases/toystore
                                _Shard_900
CreateMode                    :


Import-Module : The specified module 'C:\Code\Lesson06\Sharding\Elastic DB tool 
scripts\ShardManagement\ShardManagement.psm1' was not loaded because no valid module file was found in any module 
directory.
At C:\Code\Lesson06\Sharding\Sharding.ps1:95 char:1
+ Import-Module "$PSScriptRoot\Elastic DB tool scripts\ShardManagement\ ...
+ ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : ResourceUnavailable: (C:\Code\Lesson0...Management.psm1:String) [Import-Module], 
FileNotFoundException
    + FullyQualifiedErrorId : Modules_ModuleNotFound,Microsoft.PowerShell.Commands.ImportModuleCommand
Import-Module : The specified module 'C:\Code\Lesson06\Sharding\Elastic DB tool scripts\ShardManagement\ShardManagement.psm1' was not loaded because no valid module
file was found in any module directory.
At C:\Code\Lesson06\Sharding\Sharding.ps1:95 char:1
+ Import-Module "$PSScriptRoot\Elastic DB tool scripts\ShardManagement\ ...
+ ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : ResourceUnavailable: (C:\Code\Lesson0...Management.psm1:String) [Import-Module], FileNotFoundException
    + FullyQualifiedErrorId : Modules_ModuleNotFound,Microsoft.PowerShell.Commands.ImportModuleCommand

Configuring database toystore_SMM as Shard Map Manager
New-ShardMapManager : The term 'New-ShardMapManager' is not recognized as the name of a cmdlet, function, script file, 
or operable program. Check the spelling of the name, or if a path was included, verify that the path is correct and try 
again.
At C:\Code\Lesson06\Sharding\Sharding.ps1:99 char:20
+ $ShardMapManager = New-ShardMapManager -UserName $UserName -Password  ...
+                    ~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : ObjectNotFound: (New-ShardMapManager:String) [], CommandNotFoundException
    + FullyQualifiedErrorId : CommandNotFoundException
New-ShardMapManager : The term 'New-ShardMapManager' is not recognized as the name of a cmdlet, function, script file, or operable program. Check the spelling of the
name, or if a path was included, verify that the path is correct and try again.
At C:\Code\Lesson06\Sharding\Sharding.ps1:99 char:20
+ $ShardMapManager = New-ShardMapManager -UserName $UserName -Password  ...
+                    ~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : ObjectNotFound: (New-ShardMapManager:String) [], CommandNotFoundException
    + FullyQualifiedErrorId : CommandNotFoundException

New-RangeShardMap : The term 'New-RangeShardMap' is not recognized as the name of a cmdlet, function, script file, or 
operable program. Check the spelling of the name, or if a path was included, verify that the path is correct and try 
again.
At C:\Code\Lesson06\Sharding\Sharding.ps1:105 char:13
+ $ShardMap = New-RangeShardMap -KeyType $([int]) -ShardMapManager $Sha ...
+             ~~~~~~~~~~~~~~~~~
    + CategoryInfo          : ObjectNotFound: (New-RangeShardMap:String) [], CommandNotFoundException
    + FullyQualifiedErrorId : CommandNotFoundException
New-RangeShardMap : The term 'New-RangeShardMap' is not recognized as the name of a cmdlet, function, script file, or operable program. Check the spelling of the name,
or if a path was included, verify that the path is correct and try again.
At C:\Code\Lesson06\Sharding\Sharding.ps1:105 char:13
+ $ShardMap = New-RangeShardMap -KeyType $([int]) -ShardMapManager $Sha ...
+             ~~~~~~~~~~~~~~~~~
    + CategoryInfo          : ObjectNotFound: (New-RangeShardMap:String) [], CommandNotFoundException
    + FullyQualifiedErrorId : CommandNotFoundException

Adding toystore_Shard_800_900 and toystore_Shard_900 to the Shard Map toystorerangemap
Add-Shard : The term 'Add-Shard' is not recognized as the name of a cmdlet, function, script file, or operable program. 
Check the spelling of the name, or if a path was included, verify that the path is correct and try again.
At C:\Code\Lesson06\Sharding\Sharding.ps1:112 char:5
+     Add-Shard -ShardMap $ShardMap -SqlServerName $SQLServerFQDN -SqlD ...
+     ~~~~~~~~~
    + CategoryInfo          : ObjectNotFound: (Add-Shard:String) [], CommandNotFoundException
    + FullyQualifiedErrorId : CommandNotFoundException
Add-Shard : The term 'Add-Shard' is not recognized as the name of a cmdlet, function, script file, or operable program. Check the spelling of the name, or if a path was
included, verify that the path is correct and try again.
At C:\Code\Lesson06\Sharding\Sharding.ps1:112 char:5
+     Add-Shard -ShardMap $ShardMap -SqlServerName $SQLServerFQDN -SqlD ...
+     ~~~~~~~~~
    + CategoryInfo          : ObjectNotFound: (Add-Shard:String) [], CommandNotFoundException
    + FullyQualifiedErrorId : CommandNotFoundException

Add-Shard : The term 'Add-Shard' is not recognized as the name of a cmdlet, function, script file, or operable program. 
Check the spelling of the name, or if a path was included, verify that the path is correct and try again.
At C:\Code\Lesson06\Sharding\Sharding.ps1:112 char:5
+     Add-Shard -ShardMap $ShardMap -SqlServerName $SQLServerFQDN -SqlD ...
+     ~~~~~~~~~
    + CategoryInfo          : ObjectNotFound: (Add-Shard:String) [], CommandNotFoundException
    + FullyQualifiedErrorId : CommandNotFoundException
Add-Shard : The term 'Add-Shard' is not recognized as the name of a cmdlet, function, script file, or operable program. Check the spelling of the name, or if a path was
included, verify that the path is correct and try again.
At C:\Code\Lesson06\Sharding\Sharding.ps1:112 char:5
+     Add-Shard -ShardMap $ShardMap -SqlServerName $SQLServerFQDN -SqlD ...
+     ~~~~~~~~~
    + CategoryInfo          : ObjectNotFound: (Add-Shard:String) [], CommandNotFoundException
    + FullyQualifiedErrorId : CommandNotFoundException

Add range keys to toystore_Shard_800_900 (Shard1)
Add-RangeMapping : The term 'Add-RangeMapping' is not recognized as the name of a cmdlet, function, script file, or 
operable program. Check the spelling of the name, or if a path was included, verify that the path is correct and try 
again.
At C:\Code\Lesson06\Sharding\Sharding.ps1:122 char:1
+ Add-RangeMapping -KeyType $([int]) -RangeShardMap $ShardMap -RangeLow ...
+ ~~~~~~~~~~~~~~~~
    + CategoryInfo          : ObjectNotFound: (Add-RangeMapping:String) [], CommandNotFoundException
    + FullyQualifiedErrorId : CommandNotFoundException
Add-RangeMapping : The term 'Add-RangeMapping' is not recognized as the name of a cmdlet, function, script file, or operable program. Check the spelling of the name, or
if a path was included, verify that the path is correct and try again.
At C:\Code\Lesson06\Sharding\Sharding.ps1:122 char:1
+ Add-RangeMapping -KeyType $([int]) -RangeShardMap $ShardMap -RangeLow ...
+ ~~~~~~~~~~~~~~~~
    + CategoryInfo          : ObjectNotFound: (Add-RangeMapping:String) [], CommandNotFoundException
    + FullyQualifiedErrorId : CommandNotFoundException

Adding schema mappings to the Shard Map Manager Database
PS C:\Code\Lesson06\Sharding> TerminatingError(New-Object): "Cannot find type [Microsoft.Azure.SqlDatabase.ElasticScale.ShardManagement.Schema.SchemaInfo]: verify that the assembly containing this type is loaded."
New-Object : Cannot find type [Microsoft.Azure.SqlDatabase.ElasticScale.ShardManagement.Schema.SchemaInfo]: verify that 
the assembly containing this type is loaded.
At C:\Code\Lesson06\Sharding\Sharding.ps1:131 char:15
+ ... chemaInfo = New-Object Microsoft.Azure.SqlDatabase.ElasticScale.Shard ...
+                 ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : InvalidType: (:) [New-Object], PSArgumentException
    + FullyQualifiedErrorId : TypeNotFound,Microsoft.PowerShell.Commands.NewObjectCommand
New-Object : Cannot find type [Microsoft.Azure.SqlDatabase.ElasticScale.ShardManagement.Schema.SchemaInfo]: verify that the assembly containing this type is loaded.
At C:\Code\Lesson06\Sharding\Sharding.ps1:131 char:15
+ ... chemaInfo = New-Object Microsoft.Azure.SqlDatabase.ElasticScale.Shard ...
+                 ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : InvalidType: (:) [New-Object], PSArgumentException
    + FullyQualifiedErrorId : TypeNotFound,Microsoft.PowerShell.Commands.NewObjectCommand

>> TerminatingError(New-Object): "Cannot find type [Microsoft.Azure.SqlDatabase.ElasticScale.ShardManagement.Schema.ShardedTableInfo]: verify that the assembly containing this type is loaded."
New-Object : Cannot find type [Microsoft.Azure.SqlDatabase.ElasticScale.ShardManagement.Schema.ShardedTableInfo]: 
verify that the assembly containing this type is loaded.
At C:\Code\Lesson06\Sharding\Sharding.ps1:133 char:19
+ ... aInfo.Add($(New-Object Microsoft.Azure.SqlDatabase.ElasticScale.Shard ...
+                 ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : InvalidType: (:) [New-Object], PSArgumentException
    + FullyQualifiedErrorId : TypeNotFound,Microsoft.PowerShell.Commands.NewObjectCommand
New-Object : Cannot find type [Microsoft.Azure.SqlDatabase.ElasticScale.ShardManagement.Schema.ShardedTableInfo]: verify that the assembly containing this type is
loaded.
At C:\Code\Lesson06\Sharding\Sharding.ps1:133 char:19
+ ... aInfo.Add($(New-Object Microsoft.Azure.SqlDatabase.ElasticScale.Shard ...
+                 ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : InvalidType: (:) [New-Object], PSArgumentException
    + FullyQualifiedErrorId : TypeNotFound,Microsoft.PowerShell.Commands.NewObjectCommand

You cannot call a method on a null-valued expression.
At C:\Code\Lesson06\Sharding\Sharding.ps1:133 char:19
+ ... aInfo.Add($(New-Object Microsoft.Azure.SqlDatabase.ElasticScale.Shard ...
+                 ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : InvalidOperation: (:) [], RuntimeException
    + FullyQualifiedErrorId : InvokeMethodOnNull
You cannot call a method on a null-valued expression.
At C:\Code\Lesson06\Sharding\Sharding.ps1:133 char:19
+ ... aInfo.Add($(New-Object Microsoft.Azure.SqlDatabase.ElasticScale.Shard ...
+                 ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : InvalidOperation: (:) [], RuntimeException
    + FullyQualifiedErrorId : InvokeMethodOnNull

>> TerminatingError(New-Object): "Cannot find type [Microsoft.Azure.SqlDatabase.ElasticScale.ShardManagement.Schema.ShardedTableInfo]: verify that the assembly containing this type is loaded."
New-Object : Cannot find type [Microsoft.Azure.SqlDatabase.ElasticScale.ShardManagement.Schema.ShardedTableInfo]: 
verify that the assembly containing this type is loaded.
At C:\Code\Lesson06\Sharding\Sharding.ps1:134 char:19
+ ... aInfo.Add($(New-Object Microsoft.Azure.SqlDatabase.ElasticScale.Shard ...
+                 ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : InvalidType: (:) [New-Object], PSArgumentException
    + FullyQualifiedErrorId : TypeNotFound,Microsoft.PowerShell.Commands.NewObjectCommand
New-Object : Cannot find type [Microsoft.Azure.SqlDatabase.ElasticScale.ShardManagement.Schema.ShardedTableInfo]: verify that the assembly containing this type is
loaded.
At C:\Code\Lesson06\Sharding\Sharding.ps1:134 char:19
+ ... aInfo.Add($(New-Object Microsoft.Azure.SqlDatabase.ElasticScale.Shard ...
+                 ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : InvalidType: (:) [New-Object], PSArgumentException
    + FullyQualifiedErrorId : TypeNotFound,Microsoft.PowerShell.Commands.NewObjectCommand

You cannot call a method on a null-valued expression.
At C:\Code\Lesson06\Sharding\Sharding.ps1:134 char:19
+ ... aInfo.Add($(New-Object Microsoft.Azure.SqlDatabase.ElasticScale.Shard ...
+                 ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : InvalidOperation: (:) [], RuntimeException
    + FullyQualifiedErrorId : InvokeMethodOnNull
You cannot call a method on a null-valued expression.
At C:\Code\Lesson06\Sharding\Sharding.ps1:134 char:19
+ ... aInfo.Add($(New-Object Microsoft.Azure.SqlDatabase.ElasticScale.Shard ...
+                 ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : InvalidOperation: (:) [], RuntimeException
    + FullyQualifiedErrorId : InvokeMethodOnNull

>> TerminatingError(New-Object): "Cannot find type [Microsoft.Azure.SqlDatabase.ElasticScale.ShardManagement.Schema.ReferenceTableInfo]: verify that the assembly containing this type is loaded."
New-Object : Cannot find type [Microsoft.Azure.SqlDatabase.ElasticScale.ShardManagement.Schema.ReferenceTableInfo]: 
verify that the assembly containing this type is loaded.
At C:\Code\Lesson06\Sharding\Sharding.ps1:136 char:19
+ ... aInfo.Add($(New-Object Microsoft.Azure.SqlDatabase.ElasticScale.Shard ...
+                 ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : InvalidType: (:) [New-Object], PSArgumentException
    + FullyQualifiedErrorId : TypeNotFound,Microsoft.PowerShell.Commands.NewObjectCommand
New-Object : Cannot find type [Microsoft.Azure.SqlDatabase.ElasticScale.ShardManagement.Schema.ReferenceTableInfo]: verify that the assembly containing this type is
loaded.
At C:\Code\Lesson06\Sharding\Sharding.ps1:136 char:19
+ ... aInfo.Add($(New-Object Microsoft.Azure.SqlDatabase.ElasticScale.Shard ...
+                 ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : InvalidType: (:) [New-Object], PSArgumentException
    + FullyQualifiedErrorId : TypeNotFound,Microsoft.PowerShell.Commands.NewObjectCommand

You cannot call a method on a null-valued expression.
At C:\Code\Lesson06\Sharding\Sharding.ps1:136 char:19
+ ... aInfo.Add($(New-Object Microsoft.Azure.SqlDatabase.ElasticScale.Shard ...
+                 ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : InvalidOperation: (:) [], RuntimeException
    + FullyQualifiedErrorId : InvokeMethodOnNull
You cannot call a method on a null-valued expression.
At C:\Code\Lesson06\Sharding\Sharding.ps1:136 char:19
+ ... aInfo.Add($(New-Object Microsoft.Azure.SqlDatabase.ElasticScale.Shard ...
+                 ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : InvalidOperation: (:) [], RuntimeException
    + FullyQualifiedErrorId : InvokeMethodOnNull

You cannot call a method on a null-valued expression.
At C:\Code\Lesson06\Sharding\Sharding.ps1:138 char:1
+ $SchemaInfoCollection = $ShardMapManager.GetSchemaInfoCollection()
+ ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : InvalidOperation: (:) [], RuntimeException
    + FullyQualifiedErrorId : InvokeMethodOnNull
You cannot call a method on a null-valued expression.
At C:\Code\Lesson06\Sharding\Sharding.ps1:138 char:1
+ $SchemaInfoCollection = $ShardMapManager.GetSchemaInfoCollection()
+ ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : InvalidOperation: (:) [], RuntimeException
    + FullyQualifiedErrorId : InvokeMethodOnNull

You cannot call a method on a null-valued expression.
At C:\Code\Lesson06\Sharding\Sharding.ps1:143 char:2
+     $SchemaInfoCollection.Add($ShardMapName, $SchemaInfo)
+     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : InvalidOperation: (:) [], RuntimeException
    + FullyQualifiedErrorId : InvokeMethodOnNull
You cannot call a method on a null-valued expression.
At C:\Code\Lesson06\Sharding\Sharding.ps1:143 char:2
+     $SchemaInfoCollection.Add($ShardMapName, $SchemaInfo)
+     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : InvalidOperation: (:) [], RuntimeException
    + FullyQualifiedErrorId : InvokeMethodOnNull

toystore is now Sharded.


PS SQLSERVER:\> C:
PS C:\Code\Lesson06\Sharding> cls
PS C:\Code\Lesson06\Sharding> .\Sharding.ps1 -ResourceGroup toystore -SqlServer toyfactory -UserName sqladmin -Password Packt@pub2 -ShardMapManagerDatabase toystore_SMM -DatabaseToShard toystore
Transcript started, output file is C:\Code\Lesson06\Sharding\Log\Sharding.txt
WARNING: The output object type of this cmdlet will be modified in a future release.


ResourceGroupName : toystore
Location          : eastus2
ProvisioningState : Succeeded
Tags              :
ResourceId        : /subscriptions/bf64f3c6-6e64-48c5-a7cc-6c35b4f9aebf/resourceGroups/toystore



ResourceGroupName        : toystore
ServerName               : toyfactory
Location                 : East US 2
SqlAdministratorLogin    : sqladmin
SqlAdministratorPassword :
ServerVersion            : 12.0
Tags                     :



ResourceGroupName             : toystore
ServerName                    : toyfactory
DatabaseName                  : toystore_SMM
Location                      : East US 2
DatabaseId                    : 7a7003e9-031d-4c3c-bce4-f1e9814439b7
Edition                       : Standard
CollationName                 : SQL_Latin1_General_CP1_CI_AS
CatalogCollation              :
MaxSizeBytes                  : 268435456000
Status                        : Online
CreationDate                  : 12/23/2017 8:10:40 AM
CurrentServiceObjectiveId     : f1173c43-91bd-4aaa-973c-54e79e15235b
CurrentServiceObjectiveName   : S0
RequestedServiceObjectiveId   : f1173c43-91bd-4aaa-973c-54e79e15235b
RequestedServiceObjectiveName :
ElasticPoolName               :
EarliestRestoreDate           : 12/23/2017 8:41:43 AM
Tags                          :
ResourceId                    : /subscriptions/bf64f3c6-6e64-48c5-a7cc-6c35b4f9aebf/resourceGroups/toystore/providers/Microsoft.Sql/servers/toyfactory/databases/toystore
                                _SMM
CreateMode                    :


PS C:\Code\Lesson06\Sharding> TerminatingError(Set-AzureSqlDatabase): "Cannot validate argument on parameter 'Database'. The argument is null. Provide a valid value for the argument, and then try running the command again."
Set-AzureSqlDatabase : Cannot validate argument on parameter 'Database'. The argument is null. Provide a valid value 
for the argument, and then try running the command again.
At C:\Code\Lesson06\Sharding\Sharding.ps1:77 char:69
+ ... ectionContext $SqlServerContext -Database $SqlDatabaseContext -NewDat ...
+                                               ~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : InvalidData: (:) [Set-AzureSqlDatabase], ParameterBindingValidationException
    + FullyQualifiedErrorId : 
ParameterArgumentValidationError,Microsoft.WindowsAzure.Commands.SqlDatabase.Database.Cmdlet.SetAzureSqlDatabase
Set-AzureSqlDatabase : Cannot validate argument on parameter 'Database'. The argument is null. Provide a valid value for the argument, and then try running the command
again.
At C:\Code\Lesson06\Sharding\Sharding.ps1:77 char:69
+ ... ectionContext $SqlServerContext -Database $SqlDatabaseContext -NewDat ...
+                                               ~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : InvalidData: (:) [Set-AzureSqlDatabase], ParameterBindingValidationException
    + FullyQualifiedErrorId : ParameterArgumentValidationError,Microsoft.WindowsAzure.Commands.SqlDatabase.Database.Cmdlet.SetAzureSqlDatabase

WARNING: The output object type of this cmdlet will be modified in a future release.
ResourceGroupName : toystore
Location          : eastus2
ProvisioningState : Succeeded
Tags              :
ResourceId        : /subscriptions/bf64f3c6-6e64-48c5-a7cc-6c35b4f9aebf/resourceGroups/toystore



ResourceGroupName        : toystore
ServerName               : toyfactory
Location                 : East US 2
SqlAdministratorLogin    : sqladmin
SqlAdministratorPassword :
ServerVersion            : 12.0
Tags                     :



ResourceGroupName             : toystore
ServerName                    : toyfactory
DatabaseName                  : toystore_Shard_900
Location                      : East US 2
DatabaseId                    : 7ccf4b99-78f5-4950-90d2-07f8525db1cc
Edition                       : Standard
CollationName                 : SQL_Latin1_General_CP1_CI_AS
CatalogCollation              :
MaxSizeBytes                  : 268435456000
Status                        : Online
CreationDate                  : 12/23/2017 8:12:24 AM
CurrentServiceObjectiveId     : f1173c43-91bd-4aaa-973c-54e79e15235b
CurrentServiceObjectiveName   : S0
RequestedServiceObjectiveId   : f1173c43-91bd-4aaa-973c-54e79e15235b
RequestedServiceObjectiveName :
ElasticPoolName               :
EarliestRestoreDate           : 12/23/2017 8:43:50 AM
Tags                          :
ResourceId                    : /subscriptions/bf64f3c6-6e64-48c5-a7cc-6c35b4f9aebf/resourceGroups/toystore/providers/Microsoft.Sql/servers/toyfactory/databases/toystore
                                _Shard_900
CreateMode                    :


Invoke-Sqlcmd : The pipeline has been stopped.
At C:\Code\Lesson06\Sharding\Sharding.ps1:89 char:5
+     Invoke-Sqlcmd -ServerInstance $SQLServerFQDN -Username $UserName  ...
+     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : InvalidOperation: (:) [Invoke-Sqlcmd], PipelineStoppedException
    + FullyQualifiedErrorId : SqlExectionError,Microsoft.SqlServer.Management.PowerShell.GetScriptCommand
Invoke-Sqlcmd : The pipeline has been stopped.
At C:\Code\Lesson06\Sharding\Sharding.ps1:89 char:5
+     Invoke-Sqlcmd -ServerInstance $SQLServerFQDN -Username $UserName  ...
+     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : InvalidOperation: (:) [Invoke-Sqlcmd], PipelineStoppedException
    + FullyQualifiedErrorId : SqlExectionError,Microsoft.SqlServer.Management.PowerShell.GetScriptCommand

>> TerminatingError(Invoke-Sqlcmd): "There is already an object named 'Application' in the database.
CREATE SCHEMA failed due to previous errors."
Invoke-Sqlcmd : There is already an object named 'Application' in the database.
CREATE SCHEMA failed due to previous errors.
At C:\Code\Lesson06\Sharding\Sharding.ps1:89 char:5
+     Invoke-Sqlcmd -ServerInstance $SQLServerFQDN -Username $UserName  ...
+     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : InvalidOperation: (:) [Invoke-Sqlcmd], SqlPowerShellSqlExecutionException
    + FullyQualifiedErrorId : SqlError,Microsoft.SqlServer.Management.PowerShell.GetScriptCommand
Invoke-Sqlcmd : There is already an object named 'Application' in the database.
CREATE SCHEMA failed due to previous errors.
At C:\Code\Lesson06\Sharding\Sharding.ps1:89 char:5
+     Invoke-Sqlcmd -ServerInstance $SQLServerFQDN -Username $UserName  ...
+     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : InvalidOperation: (:) [Invoke-Sqlcmd], SqlPowerShellSqlExecutionException
    + FullyQualifiedErrorId : SqlError,Microsoft.SqlServer.Management.PowerShell.GetScriptCommand

Invoke-Sqlcmd : The pipeline has been stopped.
At C:\Code\Lesson06\Sharding\Sharding.ps1:89 char:5
+     Invoke-Sqlcmd -ServerInstance $SQLServerFQDN -Username $UserName  ...
+     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : InvalidOperation: (:) [Invoke-Sqlcmd], PipelineStoppedException
    + FullyQualifiedErrorId : SqlExectionError,Microsoft.SqlServer.Management.PowerShell.GetScriptCommand
Invoke-Sqlcmd : The pipeline has been stopped.
At C:\Code\Lesson06\Sharding\Sharding.ps1:89 char:5
+     Invoke-Sqlcmd -ServerInstance $SQLServerFQDN -Username $UserName  ...
+     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : InvalidOperation: (:) [Invoke-Sqlcmd], PipelineStoppedException
    + FullyQualifiedErrorId : SqlExectionError,Microsoft.SqlServer.Management.PowerShell.GetScriptCommand

>> TerminatingError(Invoke-Sqlcmd): "There is already an object named 'Countries' in the database."
Invoke-Sqlcmd : There is already an object named 'Countries' in the database.
At C:\Code\Lesson06\Sharding\Sharding.ps1:89 char:5
+     Invoke-Sqlcmd -ServerInstance $SQLServerFQDN -Username $UserName  ...
+     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : InvalidOperation: (:) [Invoke-Sqlcmd], SqlPowerShellSqlExecutionException
    + FullyQualifiedErrorId : SqlError,Microsoft.SqlServer.Management.PowerShell.GetScriptCommand
Invoke-Sqlcmd : There is already an object named 'Countries' in the database.
At C:\Code\Lesson06\Sharding\Sharding.ps1:89 char:5
+     Invoke-Sqlcmd -ServerInstance $SQLServerFQDN -Username $UserName  ...
+     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : InvalidOperation: (:) [Invoke-Sqlcmd], SqlPowerShellSqlExecutionException
    + FullyQualifiedErrorId : SqlError,Microsoft.SqlServer.Management.PowerShell.GetScriptCommand

Invoke-Sqlcmd : The pipeline has been stopped.
At C:\Code\Lesson06\Sharding\Sharding.ps1:89 char:5
+     Invoke-Sqlcmd -ServerInstance $SQLServerFQDN -Username $UserName  ...
+     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : InvalidOperation: (:) [Invoke-Sqlcmd], PipelineStoppedException
    + FullyQualifiedErrorId : SqlExectionError,Microsoft.SqlServer.Management.PowerShell.GetScriptCommand
Invoke-Sqlcmd : The pipeline has been stopped.
At C:\Code\Lesson06\Sharding\Sharding.ps1:89 char:5
+     Invoke-Sqlcmd -ServerInstance $SQLServerFQDN -Username $UserName  ...
+     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : InvalidOperation: (:) [Invoke-Sqlcmd], PipelineStoppedException
    + FullyQualifiedErrorId : SqlExectionError,Microsoft.SqlServer.Management.PowerShell.GetScriptCommand

>> TerminatingError(Invoke-Sqlcmd): "There is already an object named 'Customers' in the database."
Invoke-Sqlcmd : There is already an object named 'Customers' in the database.
At C:\Code\Lesson06\Sharding\Sharding.ps1:89 char:5
+     Invoke-Sqlcmd -ServerInstance $SQLServerFQDN -Username $UserName  ...
+     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : InvalidOperation: (:) [Invoke-Sqlcmd], SqlPowerShellSqlExecutionException
    + FullyQualifiedErrorId : SqlError,Microsoft.SqlServer.Management.PowerShell.GetScriptCommand
Invoke-Sqlcmd : There is already an object named 'Customers' in the database.
At C:\Code\Lesson06\Sharding\Sharding.ps1:89 char:5
+     Invoke-Sqlcmd -ServerInstance $SQLServerFQDN -Username $UserName  ...
+     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : InvalidOperation: (:) [Invoke-Sqlcmd], SqlPowerShellSqlExecutionException
    + FullyQualifiedErrorId : SqlError,Microsoft.SqlServer.Management.PowerShell.GetScriptCommand

Invoke-Sqlcmd : The pipeline has been stopped.
At C:\Code\Lesson06\Sharding\Sharding.ps1:89 char:5
+     Invoke-Sqlcmd -ServerInstance $SQLServerFQDN -Username $UserName  ...
+     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : InvalidOperation: (:) [Invoke-Sqlcmd], PipelineStoppedException
    + FullyQualifiedErrorId : SqlExectionError,Microsoft.SqlServer.Management.PowerShell.GetScriptCommand
Invoke-Sqlcmd : The pipeline has been stopped.
At C:\Code\Lesson06\Sharding\Sharding.ps1:89 char:5
+     Invoke-Sqlcmd -ServerInstance $SQLServerFQDN -Username $UserName  ...
+     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : InvalidOperation: (:) [Invoke-Sqlcmd], PipelineStoppedException
    + FullyQualifiedErrorId : SqlExectionError,Microsoft.SqlServer.Management.PowerShell.GetScriptCommand

>> TerminatingError(Invoke-Sqlcmd): "There is already an object named 'Orders' in the database."
Invoke-Sqlcmd : There is already an object named 'Orders' in the database.
At C:\Code\Lesson06\Sharding\Sharding.ps1:89 char:5
+     Invoke-Sqlcmd -ServerInstance $SQLServerFQDN -Username $UserName  ...
+     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : InvalidOperation: (:) [Invoke-Sqlcmd], SqlPowerShellSqlExecutionException
    + FullyQualifiedErrorId : SqlError,Microsoft.SqlServer.Management.PowerShell.GetScriptCommand
Invoke-Sqlcmd : There is already an object named 'Orders' in the database.
At C:\Code\Lesson06\Sharding\Sharding.ps1:89 char:5
+     Invoke-Sqlcmd -ServerInstance $SQLServerFQDN -Username $UserName  ...
+     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : InvalidOperation: (:) [Invoke-Sqlcmd], SqlPowerShellSqlExecutionException
    + FullyQualifiedErrorId : SqlError,Microsoft.SqlServer.Management.PowerShell.GetScriptCommand

Configuring database toystore_SMM as Shard Map Manager
Adding toystore_Shard_800_900 and toystore_Shard_900 to the Shard Map toystorerangemap
Add range keys to toystore_Shard_800_900 (Shard1)
Adding schema mappings to the Shard Map Manager Database
toystore is now Sharded.


PS C:\Code\Lesson06\Sharding> cd .
PS C:\Code\Lesson06\Sharding> cd ..
PS C:\Code\Lesson06> cd .\Splitting
PS C:\Code\Lesson06\Splitting> clear
PS C:\Code\Lesson06\Splitting> .\SplitToyStoreShard.ps1 -ResourceGroup toystore -SqlServer toyfactory -UserName sqladmin -Password Packt@pub2 -SplitMergeDatabase toystore_splitmerge -SplitMergeServiceEndpoint "https://splitmerge.cloudapp.net/" -ShardMapManagerDatabaseName toystore_SMM -Shard2 toystore_Shard_900 -ShardMapName toystorerangemap -SplitRangeLow 0 -SplitRangeHigh 200 -SplitValue 100
Transcript started, output file is C:\Code\Lesson06\Splitting\Log\SplitToyStoreShard.txt
WARNING: The output object type of this cmdlet will be modified in a future release.


ResourceGroupName : toystore
Location          : eastus2
ProvisioningState : Succeeded
Tags              :
ResourceId        : /subscriptions/bf64f3c6-6e64-48c5-a7cc-6c35b4f9aebf/resourceGroups/toystore



ResourceGroupName        : toystore
ServerName               : toyfactory
Location                 : East US 2
SqlAdministratorLogin    : sqladmin
SqlAdministratorPassword :
ServerVersion            : 12.0
Tags                     :



ResourceGroupName             : toystore
ServerName                    : toyfactory
DatabaseName                  : toystore_splitmerge
Location                      : East US 2
DatabaseId                    : 0c8a58bf-7e77-40be-9bb5-bbf3fb976af6
Edition                       : Basic
CollationName                 : SQL_Latin1_General_CP1_CI_AS
CatalogCollation              :
MaxSizeBytes                  : 2147483648
Status                        : Online
CreationDate                  : 12/22/2017 1:17:29 PM
CurrentServiceObjectiveId     : dd6d99bb-f193-4ec1-86f2-43d3bccbc49c
CurrentServiceObjectiveName   : Basic
RequestedServiceObjectiveId   : dd6d99bb-f193-4ec1-86f2-43d3bccbc49c
RequestedServiceObjectiveName :
ElasticPoolName               :
EarliestRestoreDate           : 12/22/2017 1:48:41 PM
Tags                          :
ResourceId                    : /subscriptions/bf64f3c6-6e64-48c5-a7cc-6c35b4f9aebf/resourceGroups/toystore/providers/Microsoft.Sql/servers/toyfactory/databases/toystore
                                _splitmerge
CreateMode                    :


Sending split request
Polling request status. Press Ctrl-C to end
Progress: 0% | Status: Queued | Details: [Informational] Operation has been queued.
Progress: 100% | Status: Failed | Details: [Error] Failed to process request. Microsoft.Azure.SqlDatabase.ElasticScale.SplitMerge.Worker.InvalidSplitMergeOperationException: The source mapping could not be found in the shard map 'toystorerangemap' using the lookup key '100'. ---> Microsoft.Azure.SqlDatabase.ElasticScale.ShardManagement.ShardManagementException: Mapping containing the given key value could not be located in the shard map 'toystorerangemap'. Error occurred while executing stored procedure '__ShardManagement.spFindShardMappingByKeyGlobal' for operation 'Lookup'.
   at Microsoft.Azure.SqlDatabase.ElasticScale.ShardManagement.RangeShardMapper`1.Lookup(TKey key, Boolean useCache)
   at Microsoft.Azure.SqlDatabase.ElasticScale.ShardManagement.RangeShardMap`1.GetMappingForKey(TKey key)
   at Microsoft.Azure.SqlDatabase.ElasticScale.SplitMerge.Worker.ShardMapManagerAbstraction.RangeShardMapAbstraction`1.GetMappingForKey(T key) in d:\_Bld\8089\4133\Sources\Src\ShardSplitMerge\FsmWorkerRole\ShardMapManagerAbstraction\ShardMap.cs:line 299
   at Microsoft.Azure.SqlDatabase.ElasticScale.SplitMerge.Worker.SplitMergeService.DoSplitMergeInternal[T](SplitMergeRequestContext`1 requestContext) in d:\_Bld\8089\4133\Sources\Src\ShardSplitMerge\FsmWorkerRole\Service\SplitMergeService.cs:line 455
   --- End of inner exception stack trace ---
   at Microsoft.Azure.SqlDatabase.ElasticScale.SplitMerge.Worker.SplitMergeService.DoSplitMergeInternal[T](SplitMergeRequestContext`1 requestContext) in d:\_Bld\8089\4133\Sources\Src\ShardSplitMerge\FsmWorkerRole\Service\SplitMergeService.cs:line 631
   at Microsoft.Azure.SqlDatabase.ElasticScale.SplitMerge.Worker.SplitMergeService.ExecuteOne(SqlMessageFetcher sqlMessageFetcher) in d:\_Bld\8089\4133\Sources\Src\ShardSplitMerge\FsmWorkerRole\Service\SplitMergeService.cs:line 377
   at Microsoft.Azure.SqlDatabase.ElasticScale.SplitMerge.Worker.SplitMergeService.TryExecuteOne(SqlMessageFetcher sqlMessageFetcher, MessageDeletionStrategy messageDeletionStrategy) in d:\_Bld\8089\4133\Sources\Src\ShardSplitMerge\FsmWorkerRole\Service\SplitMergeService.cs:line 212
MessageOperationId: 61fe07c1-21be-4ae5-933c-b2ba270be253
ErrorCode: SourceMappingNotFound
PS C:\Code\Lesson06\Splitting> TerminatingError(): "[Error] Failed to process request. Microsoft.Azure.SqlDatabase.ElasticScale.SplitMerge.Worker.InvalidSplitMergeOperationException: The source mapping could not be found in the shard map 'toystorerangemap' using the lookup key '100'. ---> Microsoft.Azure.SqlDatabase.ElasticScale.ShardManagement.ShardManagementException: Mapping containing the given key value could not be located in the shard map 'toystorerangemap'. Error occurred while executing stored procedure '__ShardManagement.spFindShardMappingByKeyGlobal' for operation 'Lookup'.
   at Microsoft.Azure.SqlDatabase.ElasticScale.ShardManagement.RangeShardMapper`1.Lookup(TKey key, Boolean useCache)
   at Microsoft.Azure.SqlDatabase.ElasticScale.ShardManagement.RangeShardMap`1.GetMappingForKey(TKey key)
   at Microsoft.Azure.SqlDatabase.ElasticScale.SplitMerge.Worker.ShardMapManagerAbstraction.RangeShardMapAbstraction`1.GetMappingForKey(T key) in d:\_Bld\8089\4133\Sources\Src\ShardSplitMerge\FsmWorkerRole\ShardMapManagerAbstraction\ShardMap.cs:line 299
   at Microsoft.Azure.SqlDatabase.ElasticScale.SplitMerge.Worker.SplitMergeService.DoSplitMergeInternal[T](SplitMergeRequestContext`1 requestContext) in d:\_Bld\8089\4133\Sources\Src\ShardSplitMerge\FsmWorkerRole\Service\SplitMergeService.cs:line 455
   --- End of inner exception stack trace ---
   at Microsoft.Azure.SqlDatabase.ElasticScale.SplitMerge.Worker.SplitMergeService.DoSplitMergeInternal[T](SplitMergeRequestContext`1 requestContext) in d:\_Bld\8089\4133\Sources\Src\ShardSplitMerge\FsmWorkerRole\Service\SplitMergeService.cs:line 631
   at Microsoft.Azure.SqlDatabase.ElasticScale.SplitMerge.Worker.SplitMergeService.ExecuteOne(SqlMessageFetcher sqlMessageFetcher) in d:\_Bld\8089\4133\Sources\Src\ShardSplitMerge\FsmWorkerRole\Service\SplitMergeService.cs:line 377
   at Microsoft.Azure.SqlDatabase.ElasticScale.SplitMerge.Worker.SplitMergeService.TryExecuteOne(SqlMessageFetcher sqlMessageFetcher, MessageDeletionStrategy messageDeletionStrategy) in d:\_Bld\8089\4133\Sources\Src\ShardSplitMerge\FsmWorkerRole\Service\SplitMergeService.cs:line 212
MessageOperationId: 61fe07c1-21be-4ae5-933c-b2ba270be253
ErrorCode: SourceMappingNotFound"
>> TerminatingError(): "[Error] Failed to process request. Microsoft.Azure.SqlDatabase.ElasticScale.SplitMerge.Worker.InvalidSplitMergeOperationException: The source mapping could not be found in the shard map 'toystorerangemap' using the lookup key '100'. ---> Microsoft.Azure.SqlDatabase.ElasticScale.ShardManagement.ShardManagementException: Mapping containing the given key value could not be located in the shard map 'toystorerangemap'. Error occurred while executing stored procedure '__ShardManagement.spFindShardMappingByKeyGlobal' for operation 'Lookup'.
   at Microsoft.Azure.SqlDatabase.ElasticScale.ShardManagement.RangeShardMapper`1.Lookup(TKey key, Boolean useCache)
   at Microsoft.Azure.SqlDatabase.ElasticScale.ShardManagement.RangeShardMap`1.GetMappingForKey(TKey key)
   at Microsoft.Azure.SqlDatabase.ElasticScale.SplitMerge.Worker.ShardMapManagerAbstraction.RangeShardMapAbstraction`1.GetMappingForKey(T key) in d:\_Bld\8089\4133\Sources\Src\ShardSplitMerge\FsmWorkerRole\ShardMapManagerAbstraction\ShardMap.cs:line 299
   at Microsoft.Azure.SqlDatabase.ElasticScale.SplitMerge.Worker.SplitMergeService.DoSplitMergeInternal[T](SplitMergeRequestContext`1 requestContext) in d:\_Bld\8089\4133\Sources\Src\ShardSplitMerge\FsmWorkerRole\Service\SplitMergeService.cs:line 455
   --- End of inner exception stack trace ---
   at Microsoft.Azure.SqlDatabase.ElasticScale.SplitMerge.Worker.SplitMergeService.DoSplitMergeInternal[T](SplitMergeRequestContext`1 requestContext) in d:\_Bld\8089\4133\Sources\Src\ShardSplitMerge\FsmWorkerRole\Service\SplitMergeService.cs:line 631
   at Microsoft.Azure.SqlDatabase.ElasticScale.SplitMerge.Worker.SplitMergeService.ExecuteOne(SqlMessageFetcher sqlMessageFetcher) in d:\_Bld\8089\4133\Sources\Src\ShardSplitMerge\FsmWorkerRole\Service\SplitMergeService.cs:line 377
   at Microsoft.Azure.SqlDatabase.ElasticScale.SplitMerge.Worker.SplitMergeService.TryExecuteOne(SqlMessageFetcher sqlMessageFetcher, MessageDeletionStrategy messageDeletionStrategy) in d:\_Bld\8089\4133\Sources\Src\ShardSplitMerge\FsmWorkerRole\Service\SplitMergeService.cs:line 212
MessageOperationId: 61fe07c1-21be-4ae5-933c-b2ba270be253
ErrorCode: SourceMappingNotFound"
>> TerminatingError(): "[Error] Failed to process request. Microsoft.Azure.SqlDatabase.ElasticScale.SplitMerge.Worker.InvalidSplitMergeOperationException: The source mapping could not be found in the shard map 'toystorerangemap' using the lookup key '100'. ---> Microsoft.Azure.SqlDatabase.ElasticScale.ShardManagement.ShardManagementException: Mapping containing the given key value could not be located in the shard map 'toystorerangemap'. Error occurred while executing stored procedure '__ShardManagement.spFindShardMappingByKeyGlobal' for operation 'Lookup'.
   at Microsoft.Azure.SqlDatabase.ElasticScale.ShardManagement.RangeShardMapper`1.Lookup(TKey key, Boolean useCache)
   at Microsoft.Azure.SqlDatabase.ElasticScale.ShardManagement.RangeShardMap`1.GetMappingForKey(TKey key)
   at Microsoft.Azure.SqlDatabase.ElasticScale.SplitMerge.Worker.ShardMapManagerAbstraction.RangeShardMapAbstraction`1.GetMappingForKey(T key) in d:\_Bld\8089\4133\Sources\Src\ShardSplitMerge\FsmWorkerRole\ShardMapManagerAbstraction\ShardMap.cs:line 299
   at Microsoft.Azure.SqlDatabase.ElasticScale.SplitMerge.Worker.SplitMergeService.DoSplitMergeInternal[T](SplitMergeRequestContext`1 requestContext) in d:\_Bld\8089\4133\Sources\Src\ShardSplitMerge\FsmWorkerRole\Service\SplitMergeService.cs:line 455
   --- End of inner exception stack trace ---
   at Microsoft.Azure.SqlDatabase.ElasticScale.SplitMerge.Worker.SplitMergeService.DoSplitMergeInternal[T](SplitMergeRequestContext`1 requestContext) in d:\_Bld\8089\4133\Sources\Src\ShardSplitMerge\FsmWorkerRole\Service\SplitMergeService.cs:line 631
   at Microsoft.Azure.SqlDatabase.ElasticScale.SplitMerge.Worker.SplitMergeService.ExecuteOne(SqlMessageFetcher sqlMessageFetcher) in d:\_Bld\8089\4133\Sources\Src\ShardSplitMerge\FsmWorkerRole\Service\SplitMergeService.cs:line 377
   at Microsoft.Azure.SqlDatabase.ElasticScale.SplitMerge.Worker.SplitMergeService.TryExecuteOne(SqlMessageFetcher sqlMessageFetcher, MessageDeletionStrategy messageDeletionStrategy) in d:\_Bld\8089\4133\Sources\Src\ShardSplitMerge\FsmWorkerRole\Service\SplitMergeService.cs:line 212
MessageOperationId: 61fe07c1-21be-4ae5-933c-b2ba270be253
ErrorCode: SourceMappingNotFound"
[Error] Failed to process request. Microsoft.Azure.SqlDatabase.ElasticScale.SplitMerge.Worker.InvalidSplitMergeOperationException: The source mapping could not be found
in the shard map 'toystorerangemap' using the lookup key '100'. ---> Microsoft.Azure.SqlDatabase.ElasticScale.ShardManagement.ShardManagementException: Mapping
containing the given key value could not be located in the shard map 'toystorerangemap'. Error occurred while executing stored procedure
'__ShardManagement.spFindShardMappingByKeyGlobal' for operation 'Lookup'.
   at Microsoft.Azure.SqlDatabase.ElasticScale.ShardManagement.RangeShardMapper`1.Lookup(TKey key, Boolean useCache)
   at Microsoft.Azure.SqlDatabase.ElasticScale.ShardManagement.RangeShardMap`1.GetMappingForKey(TKey key)
   at Microsoft.Azure.SqlDatabase.ElasticScale.SplitMerge.Worker.ShardMapManagerAbstraction.RangeShardMapAbstraction`1.GetMappingForKey(T key) in
d:\_Bld\8089\4133\Sources\Src\ShardSplitMerge\FsmWorkerRole\ShardMapManagerAbstraction\ShardMap.cs:line 299
   at Microsoft.Azure.SqlDatabase.ElasticScale.SplitMerge.Worker.SplitMergeService.DoSplitMergeInternal[T](SplitMergeRequestContext`1 requestContext) in
d:\_Bld\8089\4133\Sources\Src\ShardSplitMerge\FsmWorkerRole\Service\SplitMergeService.cs:line 455
   --- End of inner exception stack trace ---
   at Microsoft.Azure.SqlDatabase.ElasticScale.SplitMerge.Worker.SplitMergeService.DoSplitMergeInternal[T](SplitMergeRequestContext`1 requestContext) in
d:\_Bld\8089\4133\Sources\Src\ShardSplitMerge\FsmWorkerRole\Service\SplitMergeService.cs:line 631
   at Microsoft.Azure.SqlDatabase.ElasticScale.SplitMerge.Worker.SplitMergeService.ExecuteOne(SqlMessageFetcher sqlMessageFetcher) in
d:\_Bld\8089\4133\Sources\Src\ShardSplitMerge\FsmWorkerRole\Service\SplitMergeService.cs:line 377
   at Microsoft.Azure.SqlDatabase.ElasticScale.SplitMerge.Worker.SplitMergeService.TryExecuteOne(SqlMessageFetcher sqlMessageFetcher, MessageDeletionStrategy
messageDeletionStrategy) in d:\_Bld\8089\4133\Sources\Src\ShardSplitMerge\FsmWorkerRole\Service\SplitMergeService.cs:line 212
MessageOperationId: 61fe07c1-21be-4ae5-933c-b2ba270be253
ErrorCode: SourceMappingNotFound
At C:\Code\Lesson06\Splitting\SplitMerge\SplitMerge.psm1:363 char:13
+             throw $statusJson.Details
+             ~~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : OperationStopped: ([Error] Failed ...MappingNotFound:String) [], RuntimeException
    + FullyQualifiedErrorId : [Error] Failed to process request. Microsoft.Azure.SqlDatabase.ElasticScale.SplitMerge.Worker.InvalidSplitMergeOperationException: The sou
   rce mapping could not be found in the shard map 'toystorerangemap' using the lookup key '100'. ---> Microsoft.Azure.SqlDatabase.ElasticScale.ShardManagement.ShardMa
  nagementException: Mapping containing the given key value could not be located in the shard map 'toystorerangemap'. Error occurred while executing stored procedure
 '__ShardManagement.spFindShardMappingByKeyGlobal' for operation 'Lookup'.
   at Microsoft.Azure.SqlDatabase.ElasticScale.ShardManagement.RangeShardMapper`1.Lookup(TKey key, Boolean useCache)
   at Microsoft.Azure.SqlDatabase.ElasticScale.ShardManagement.RangeShardMap`1.GetMappingForKey(TKey key)
       at Microsoft.Azure.SqlDatabase.ElasticScale.SplitMerge.Worker.ShardMapManagerAbstraction.RangeShardMapAbstraction`1.GetMappingForKey(T key) in d:\_Bld\8089\4133\
   Sources\Src\ShardSplitMerge\FsmWorkerRole\ShardMapManagerAbstraction\ShardMap.cs:line 299
       at Microsoft.Azure.SqlDatabase.ElasticScale.SplitMerge.Worker.SplitMergeService.DoSplitMergeInternal[T](SplitMergeRequestContext`1 requestContext) in d:\_Bld\808
   9\4133\Sources\Src\ShardSplitMerge\FsmWorkerRole\Service\SplitMergeService.cs:line 455
   --- End of inner exception stack trace ---
       at Microsoft.Azure.SqlDatabase.ElasticScale.SplitMerge.Worker.SplitMergeService.DoSplitMergeInternal[T](SplitMergeRequestContext`1 requestContext) in d:\_Bld\808
   9\4133\Sources\Src\ShardSplitMerge\FsmWorkerRole\Service\SplitMergeService.cs:line 631
       at Microsoft.Azure.SqlDatabase.ElasticScale.SplitMerge.Worker.SplitMergeService.ExecuteOne(SqlMessageFetcher sqlMessageFetcher) in d:\_Bld\8089\4133\Sources\Src\
   ShardSplitMerge\FsmWorkerRole\Service\SplitMergeService.cs:line 377
       at Microsoft.Azure.SqlDatabase.ElasticScale.SplitMerge.Worker.SplitMergeService.TryExecuteOne(SqlMessageFetcher sqlMessageFetcher, MessageDeletionStrategy messag
   eDeletionStrategy) in d:\_Bld\8089\4133\Sources\Src\ShardSplitMerge\FsmWorkerRole\Service\SplitMergeService.cs:line 212
MessageOperationId: 61fe07c1-21be-4ae5-933c-b2ba270be253
ErrorCode: SourceMappingNotFound

PS C:\Code\Lesson06\Splitting> .\SplitToyStoreShard.ps1 -ResourceGroup toystore -SqlServer toyfactory -UserName sqladmin -Password Packt@pub2 -SplitMergeDatabase toystore_splitmerge -SplitMergeServiceEndpoint "https://splitmerge.cloudapp.net/" -ShardMapManagerDatabaseName toystore_SMM -Shard2 toystore_Shard_900 -ShardMapName toystorerangemap -SplitRangeLow 0 -SplitRangeHigh 200 -SplitValue 100
Transcript started, output file is C:\Code\Lesson06\Splitting\Log\SplitToyStoreShard.txt
WARNING: The output object type of this cmdlet will be modified in a future release.


ResourceGroupName : toystore
Location          : eastus2
ProvisioningState : Succeeded
Tags              :
ResourceId        : /subscriptions/bf64f3c6-6e64-48c5-a7cc-6c35b4f9aebf/resourceGroups/toystore



ResourceGroupName        : toystore
ServerName               : toyfactory
Location                 : East US 2
SqlAdministratorLogin    : sqladmin
SqlAdministratorPassword :
ServerVersion            : 12.0
Tags                     :



ResourceGroupName             : toystore
ServerName                    : toyfactory
DatabaseName                  : toystore_splitmerge
Location                      : East US 2
DatabaseId                    : 0c8a58bf-7e77-40be-9bb5-bbf3fb976af6
Edition                       : Basic
CollationName                 : SQL_Latin1_General_CP1_CI_AS
CatalogCollation              :
MaxSizeBytes                  : 2147483648
Status                        : Online
CreationDate                  : 12/22/2017 1:17:29 PM
CurrentServiceObjectiveId     : dd6d99bb-f193-4ec1-86f2-43d3bccbc49c
CurrentServiceObjectiveName   : Basic
RequestedServiceObjectiveId   : dd6d99bb-f193-4ec1-86f2-43d3bccbc49c
RequestedServiceObjectiveName :
ElasticPoolName               :
EarliestRestoreDate           : 12/22/2017 1:48:41 PM
Tags                          :
ResourceId                    : /subscriptions/bf64f3c6-6e64-48c5-a7cc-6c35b4f9aebf/resourceGroups/toystore/providers/Microsoft.Sql/servers/toyfactory/databases/toystore
                                _splitmerge
CreateMode                    :


Sending split request
PS C:\Code\Lesson06\Splitting> TerminatingError(): "Failure to submit request: @{Details=[Exception] System.ArgumentException: Requested value '$([int])' was not found.
   at System.Enum.TryParseEnum(Type enumType, String value, Boolean ignoreCase, EnumResult& parseResult)
   at Microsoft.Azure.SqlDatabase.ElasticScale.SplitMerge.Web.Controllers.SplitMergeController.ParseFormData(SplitMergeOperationType operationType, FormDataCollection formData)
   at Microsoft.Azure.SqlDatabase.ElasticScale.SplitMerge.Web.Controllers.SplitMergeController.ProcessNormalRequest(FormDataCollection formData)}.Details"
>> TerminatingError(): "Failure to submit request: @{Details=[Exception] System.ArgumentException: Requested value '$([int])' was not found.
   at System.Enum.TryParseEnum(Type enumType, String value, Boolean ignoreCase, EnumResult& parseResult)
   at Microsoft.Azure.SqlDatabase.ElasticScale.SplitMerge.Web.Controllers.SplitMergeController.ParseFormData(SplitMergeOperationType operationType, FormDataCollection formData)
   at Microsoft.Azure.SqlDatabase.ElasticScale.SplitMerge.Web.Controllers.SplitMergeController.ProcessNormalRequest(FormDataCollection formData)}.Details"
>> TerminatingError(): "Failure to submit request: @{Details=[Exception] System.ArgumentException: Requested value '$([int])' was not found.
   at System.Enum.TryParseEnum(Type enumType, String value, Boolean ignoreCase, EnumResult& parseResult)
   at Microsoft.Azure.SqlDatabase.ElasticScale.SplitMerge.Web.Controllers.SplitMergeController.ParseFormData(SplitMergeOperationType operationType, FormDataCollection formData)
   at Microsoft.Azure.SqlDatabase.ElasticScale.SplitMerge.Web.Controllers.SplitMergeController.ProcessNormalRequest(FormDataCollection formData)}.Details"
>> TerminatingError(): "Failure to submit request: @{Details=[Exception] System.ArgumentException: Requested value '$([int])' was not found.
   at System.Enum.TryParseEnum(Type enumType, String value, Boolean ignoreCase, EnumResult& parseResult)
   at Microsoft.Azure.SqlDatabase.ElasticScale.SplitMerge.Web.Controllers.SplitMergeController.ParseFormData(SplitMergeOperationType operationType, FormDataCollection formData)
   at Microsoft.Azure.SqlDatabase.ElasticScale.SplitMerge.Web.Controllers.SplitMergeController.ProcessNormalRequest(FormDataCollection formData)}.Details"
Failure to submit request: @{Details=[Exception] System.ArgumentException: Requested value '$([int])' was not found.
   at System.Enum.TryParseEnum(Type enumType, String value, Boolean ignoreCase, EnumResult& parseResult)
   at Microsoft.Azure.SqlDatabase.ElasticScale.SplitMerge.Web.Controllers.SplitMergeController.ParseFormData(SplitMergeOperationType operationType, FormDataCollection
formData)
   at Microsoft.Azure.SqlDatabase.ElasticScale.SplitMerge.Web.Controllers.SplitMergeController.ProcessNormalRequest(FormDataCollection formData)}.Details
At C:\Code\Lesson06\Splitting\SplitMerge\SplitMerge.psm1:280 char:9
+         throw "Failure to submit request: $postResponseJson.Details"
+         ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : OperationStopped: (Failure to subm...mData)}.Details:String) [], RuntimeException
    + FullyQualifiedErrorId : Failure to submit request: @{Details=[Exception] System.ArgumentException: Requested value '$([int])' was not found.
   at System.Enum.TryParseEnum(Type enumType, String value, Boolean ignoreCase, EnumResult& parseResult)
       at Microsoft.Azure.SqlDatabase.ElasticScale.SplitMerge.Web.Controllers.SplitMergeController.ParseFormData(SplitMergeOperationType operationType, FormDataCollecti
   on formData)
   at Microsoft.Azure.SqlDatabase.ElasticScale.SplitMerge.Web.Controllers.SplitMergeController.ProcessNormalRequest(FormDataCollection formData)}.Details

PS C:\Code\Lesson06\Splitting> cd ..
PS C:\Code\Lesson06> cd .\Sharding
PS C:\Code\Lesson06\Sharding> .\Sharding.ps1 -ResourceGroup toystore -SqlServer toyfactory -UserName sqladmin -Password Packt@pub2 -ShardMapManagerDatabase toystore_SMM -DatabaseToShard toystore
Transcript started, output file is C:\Code\Lesson06\Sharding\Log\Sharding.txt
WARNING: The output object type of this cmdlet will be modified in a future release.


ResourceGroupName : toystore
Location          : eastus2
ProvisioningState : Succeeded
Tags              :
ResourceId        : /subscriptions/bf64f3c6-6e64-48c5-a7cc-6c35b4f9aebf/resourceGroups/toystore



ResourceGroupName        : toystore
ServerName               : toyfactory
Location                 : East US 2
SqlAdministratorLogin    : sqladmin
SqlAdministratorPassword :
ServerVersion            : 12.0
Tags                     :


Provisioning Azure SQL Database toystore_SMM

ResourceGroupName             : toystore
ServerName                    : toyfactory
DatabaseName                  : toystore_SMM
Location                      : East US 2
DatabaseId                    : c6f6fb4b-d7b8-4ffb-90cb-853f3ca6365d
Edition                       : Standard
CollationName                 : SQL_Latin1_General_CP1_CI_AS
CatalogCollation              :
MaxSizeBytes                  : 268435456000
Status                        : Online
CreationDate                  : 12/23/2017 8:43:59 AM
CurrentServiceObjectiveId     : f1173c43-91bd-4aaa-973c-54e79e15235b
CurrentServiceObjectiveName   : S0
RequestedServiceObjectiveId   : f1173c43-91bd-4aaa-973c-54e79e15235b
RequestedServiceObjectiveName :
ElasticPoolName               :
EarliestRestoreDate           : 12/23/2017 9:15:03 AM
Tags                          :
ResourceId                    : /subscriptions/bf64f3c6-6e64-48c5-a7cc-6c35b4f9aebf/resourceGroups/toystore/providers/Microsoft.Sql/servers/toyfactory/databases/toystore
                                _SMM
CreateMode                    :

WARNING: The output object type of this cmdlet will be modified in a future release.
ResourceGroupName : toystore
Location          : eastus2
ProvisioningState : Succeeded
Tags              :
ResourceId        : /subscriptions/bf64f3c6-6e64-48c5-a7cc-6c35b4f9aebf/resourceGroups/toystore



ResourceGroupName        : toystore
ServerName               : toyfactory
Location                 : East US 2
SqlAdministratorLogin    : sqladmin
SqlAdministratorPassword :
ServerVersion            : 12.0
Tags                     :


Provisioning Azure SQL Database toystore_Shard_200

ResourceGroupName             : toystore
ServerName                    : toyfactory
DatabaseName                  : toystore_Shard_200
Location                      : East US 2
DatabaseId                    : c3199485-9605-4628-b8bf-7d9a83f404d7
Edition                       : Standard
CollationName                 : SQL_Latin1_General_CP1_CI_AS
CatalogCollation              :
MaxSizeBytes                  : 268435456000
Status                        : Online
CreationDate                  : 12/23/2017 8:46:07 AM
CurrentServiceObjectiveId     : f1173c43-91bd-4aaa-973c-54e79e15235b
CurrentServiceObjectiveName   : S0
RequestedServiceObjectiveId   : f1173c43-91bd-4aaa-973c-54e79e15235b
RequestedServiceObjectiveName :
ElasticPoolName               :
EarliestRestoreDate           : 12/23/2017 9:17:14 AM
Tags                          :
ResourceId                    : /subscriptions/bf64f3c6-6e64-48c5-a7cc-6c35b4f9aebf/resourceGroups/toystore/providers/Microsoft.Sql/servers/toyfactory/databases/toystore
                                _Shard_200
CreateMode                    :

Invoke-Sqlcmd : A network-related or instance-specific error occurred while establishing a connection to SQL Server. 
The server was not found or was not accessible. Verify that the instance name is correct and that SQL Server is 
configured to allow remote connections. (provider: Named Pipes Provider, error: 40 - Could not open a connection to SQL 
Server)
At C:\Code\Lesson06\Sharding\Sharding.ps1:89 char:5
+     Invoke-Sqlcmd -ServerInstance $SQLServerFQDN -Username $UserName  ...
+     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : InvalidOperation: (:) [Invoke-Sqlcmd], SqlException
    + FullyQualifiedErrorId : SqlExectionError,Microsoft.SqlServer.Management.PowerShell.GetScriptCommand
Invoke-Sqlcmd : A network-related or instance-specific error occurred while establishing a connection to SQL Server. The server was not found or was not accessible.
Verify that the instance name is correct and that SQL Server is configured to allow remote connections. (provider: Named Pipes Provider, error: 40 - Could not open a
connection to SQL Server)
At C:\Code\Lesson06\Sharding\Sharding.ps1:89 char:5
+     Invoke-Sqlcmd -ServerInstance $SQLServerFQDN -Username $UserName  ...
+     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : InvalidOperation: (:) [Invoke-Sqlcmd], SqlException
    + FullyQualifiedErrorId : SqlExectionError,Microsoft.SqlServer.Management.PowerShell.GetScriptCommand

>> TerminatingError(Invoke-Sqlcmd): ""
Invoke-Sqlcmd : 
At C:\Code\Lesson06\Sharding\Sharding.ps1:89 char:5
+     Invoke-Sqlcmd -ServerInstance $SQLServerFQDN -Username $UserName  ...
+     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : ParserError: (:) [Invoke-Sqlcmd], ParserException
    + FullyQualifiedErrorId : ExecutionFailureException,Microsoft.SqlServer.Management.PowerShell.GetScriptCommand
Invoke-Sqlcmd :
At C:\Code\Lesson06\Sharding\Sharding.ps1:89 char:5
+     Invoke-Sqlcmd -ServerInstance $SQLServerFQDN -Username $UserName  ...
+     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : ParserError: (:) [Invoke-Sqlcmd], ParserException
    + FullyQualifiedErrorId : ExecutionFailureException,Microsoft.SqlServer.Management.PowerShell.GetScriptCommand

Invoke-Sqlcmd : A network-related or instance-specific error occurred while establishing a connection to SQL Server. 
The server was not found or was not accessible. Verify that the instance name is correct and that SQL Server is 
configured to allow remote connections. (provider: Named Pipes Provider, error: 40 - Could not open a connection to SQL 
Server)
At C:\Code\Lesson06\Sharding\Sharding.ps1:89 char:5
+     Invoke-Sqlcmd -ServerInstance $SQLServerFQDN -Username $UserName  ...
+     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : InvalidOperation: (:) [Invoke-Sqlcmd], SqlException
    + FullyQualifiedErrorId : SqlExectionError,Microsoft.SqlServer.Management.PowerShell.GetScriptCommand
Invoke-Sqlcmd : A network-related or instance-specific error occurred while establishing a connection to SQL Server. The server was not found or was not accessible.
Verify that the instance name is correct and that SQL Server is configured to allow remote connections. (provider: Named Pipes Provider, error: 40 - Could not open a
connection to SQL Server)
At C:\Code\Lesson06\Sharding\Sharding.ps1:89 char:5
+     Invoke-Sqlcmd -ServerInstance $SQLServerFQDN -Username $UserName  ...
+     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : InvalidOperation: (:) [Invoke-Sqlcmd], SqlException
    + FullyQualifiedErrorId : SqlExectionError,Microsoft.SqlServer.Management.PowerShell.GetScriptCommand

>> TerminatingError(Invoke-Sqlcmd): ""
Invoke-Sqlcmd : 
At C:\Code\Lesson06\Sharding\Sharding.ps1:89 char:5
+     Invoke-Sqlcmd -ServerInstance $SQLServerFQDN -Username $UserName  ...
+     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : ParserError: (:) [Invoke-Sqlcmd], ParserException
    + FullyQualifiedErrorId : ExecutionFailureException,Microsoft.SqlServer.Management.PowerShell.GetScriptCommand
Invoke-Sqlcmd :
At C:\Code\Lesson06\Sharding\Sharding.ps1:89 char:5
+     Invoke-Sqlcmd -ServerInstance $SQLServerFQDN -Username $UserName  ...
+     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : ParserError: (:) [Invoke-Sqlcmd], ParserException
    + FullyQualifiedErrorId : ExecutionFailureException,Microsoft.SqlServer.Management.PowerShell.GetScriptCommand

Invoke-Sqlcmd : A network-related or instance-specific error occurred while establishing a connection to SQL Server. 
The server was not found or was not accessible. Verify that the instance name is correct and that SQL Server is 
configured to allow remote connections. (provider: Named Pipes Provider, error: 40 - Could not open a connection to SQL 
Server)
At C:\Code\Lesson06\Sharding\Sharding.ps1:89 char:5
+     Invoke-Sqlcmd -ServerInstance $SQLServerFQDN -Username $UserName  ...
+     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : InvalidOperation: (:) [Invoke-Sqlcmd], SqlException
    + FullyQualifiedErrorId : SqlExectionError,Microsoft.SqlServer.Management.PowerShell.GetScriptCommand
Invoke-Sqlcmd : A network-related or instance-specific error occurred while establishing a connection to SQL Server. The server was not found or was not accessible.
Verify that the instance name is correct and that SQL Server is configured to allow remote connections. (provider: Named Pipes Provider, error: 40 - Could not open a
connection to SQL Server)
At C:\Code\Lesson06\Sharding\Sharding.ps1:89 char:5
+     Invoke-Sqlcmd -ServerInstance $SQLServerFQDN -Username $UserName  ...
+     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : InvalidOperation: (:) [Invoke-Sqlcmd], SqlException
    + FullyQualifiedErrorId : SqlExectionError,Microsoft.SqlServer.Management.PowerShell.GetScriptCommand

>> TerminatingError(Invoke-Sqlcmd): ""
Invoke-Sqlcmd : 
At C:\Code\Lesson06\Sharding\Sharding.ps1:89 char:5
+     Invoke-Sqlcmd -ServerInstance $SQLServerFQDN -Username $UserName  ...
+     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : ParserError: (:) [Invoke-Sqlcmd], ParserException
    + FullyQualifiedErrorId : ExecutionFailureException,Microsoft.SqlServer.Management.PowerShell.GetScriptCommand
Invoke-Sqlcmd :
At C:\Code\Lesson06\Sharding\Sharding.ps1:89 char:5
+     Invoke-Sqlcmd -ServerInstance $SQLServerFQDN -Username $UserName  ...
+     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : ParserError: (:) [Invoke-Sqlcmd], ParserException
    + FullyQualifiedErrorId : ExecutionFailureException,Microsoft.SqlServer.Management.PowerShell.GetScriptCommand

Invoke-Sqlcmd : The pipeline has been stopped.
At C:\Code\Lesson06\Sharding\Sharding.ps1:89 char:5
+     Invoke-Sqlcmd -ServerInstance $SQLServerFQDN -Username $UserName  ...
+     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : InvalidOperation: (:) [Invoke-Sqlcmd], PipelineStoppedException
    + FullyQualifiedErrorId : SqlExectionError,Microsoft.SqlServer.Management.PowerShell.GetScriptCommand
Invoke-Sqlcmd : The pipeline has been stopped.
At C:\Code\Lesson06\Sharding\Sharding.ps1:89 char:5
+     Invoke-Sqlcmd -ServerInstance $SQLServerFQDN -Username $UserName  ...
+     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : InvalidOperation: (:) [Invoke-Sqlcmd], PipelineStoppedException
    + FullyQualifiedErrorId : SqlExectionError,Microsoft.SqlServer.Management.PowerShell.GetScriptCommand

>> TerminatingError(Invoke-Sqlcmd): "The specified schema name "Sales" either does not exist or you do not have permission to use it."
Invoke-Sqlcmd : The specified schema name "Sales" either does not exist or you do not have permission to use it.
At C:\Code\Lesson06\Sharding\Sharding.ps1:89 char:5
+     Invoke-Sqlcmd -ServerInstance $SQLServerFQDN -Username $UserName  ...
+     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : InvalidOperation: (:) [Invoke-Sqlcmd], SqlPowerShellSqlExecutionException
    + FullyQualifiedErrorId : SqlError,Microsoft.SqlServer.Management.PowerShell.GetScriptCommand
Invoke-Sqlcmd : The specified schema name "Sales" either does not exist or you do not have permission to use it.
At C:\Code\Lesson06\Sharding\Sharding.ps1:89 char:5
+     Invoke-Sqlcmd -ServerInstance $SQLServerFQDN -Username $UserName  ...
+     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : InvalidOperation: (:) [Invoke-Sqlcmd], SqlPowerShellSqlExecutionException
    + FullyQualifiedErrorId : SqlError,Microsoft.SqlServer.Management.PowerShell.GetScriptCommand

Configuring database toystore_SMM as Shard Map Manager
Adding toystore_Shard_1_100 and toystore_Shard_200 to the Shard Map toystorerangemap
Add range keys to toystore_Shard_1_100 (Shard1)
Adding schema mappings to the Shard Map Manager Database
toystore is now Sharded.


PS C:\Code\Lesson06\Sharding> cd ..
PS C:\Code\Lesson06> cd .\Splitting
PS C:\Code\Lesson06\Splitting> clear
PS C:\Code\Lesson06\Splitting> .\SplitToyStoreShard.ps1 -ResourceGroup toystore -SqlServer toyfactory -UserName sqladmin -Password Packt@pub2 -SplitMergeDatabase toystore_splitmerge -SplitMergeServiceEndpoint "https://splitmerge.cloudapp.net/" -ShardMapManagerDatabaseName toystore_SMM -Shard2 toystore_Shard_900 -ShardMapName toystorerangemap -SplitRangeLow 1 -SplitRangeHigh 200 -SplitValue 100
PS C:\Code\Lesson06\Splitting> TerminatingError(): "The pipeline has been stopped."
>> TerminatingError(): "The pipeline has been stopped."
>> TerminatingError(): "The pipeline has been stopped."
PS C:\Code\Lesson06\Splitting> .\SplitToyStoreShard.ps1 -ResourceGroup toystore -SqlServer toyfactory -UserName sqladmin -Password Packt@pub2 -SplitMergeDatabase toystore_splitmerge -SplitMergeServiceEndpoint "https://splitmerge.cloudapp.net/" -ShardMapManagerDatabaseName toystore_SMM -Shard2 toystore_Shard_200 -ShardMapName toystorerangemap -SplitRangeLow 1 -SplitRangeHigh 200 -SplitValue 100
Transcript started, output file is C:\Code\Lesson06\Splitting\Log\SplitToyStoreShard.txt
WARNING: The output object type of this cmdlet will be modified in a future release.


ResourceGroupName : toystore
Location          : eastus2
ProvisioningState : Succeeded
Tags              :
ResourceId        : /subscriptions/bf64f3c6-6e64-48c5-a7cc-6c35b4f9aebf/resourceGroups/toystore



ResourceGroupName        : toystore
ServerName               : toyfactory
Location                 : East US 2
SqlAdministratorLogin    : sqladmin
SqlAdministratorPassword :
ServerVersion            : 12.0
Tags                     :



ResourceGroupName             : toystore
ServerName                    : toyfactory
DatabaseName                  : toystore_splitmerge
Location                      : East US 2
DatabaseId                    : 0c8a58bf-7e77-40be-9bb5-bbf3fb976af6
Edition                       : Basic
CollationName                 : SQL_Latin1_General_CP1_CI_AS
CatalogCollation              :
MaxSizeBytes                  : 2147483648
Status                        : Online
CreationDate                  : 12/22/2017 1:17:29 PM
CurrentServiceObjectiveId     : dd6d99bb-f193-4ec1-86f2-43d3bccbc49c
CurrentServiceObjectiveName   : Basic
RequestedServiceObjectiveId   : dd6d99bb-f193-4ec1-86f2-43d3bccbc49c
RequestedServiceObjectiveName :
ElasticPoolName               :
EarliestRestoreDate           : 12/22/2017 1:48:41 PM
Tags                          :
ResourceId                    : /subscriptions/bf64f3c6-6e64-48c5-a7cc-6c35b4f9aebf/resourceGroups/toystore/providers/Microsoft.Sql/servers/toyfactory/databases/toystore
                                _splitmerge
CreateMode                    :


Sending split request
Polling request status. Press Ctrl-C to end
Progress: 0% | Status: Queued | Details: [Informational] Operation has been queued.
Progress: 5% | Status: Starting | Details: [Informational] Starting Split-Merge state machine for request.
Progress: 5% | Status: Starting | Details: [Informational] Performing data consistency checks on target shards.
Progress: 20% | Status: CopyingReferenceTables | Details: [Informational] Successfully copied reference table [Application].[Countries].
Progress: 44% | Status: CopyingShardedTables | Details: [Informational] Moving key range [100:110) of sharded tables.
Progress: 99% | Status: Completing | Details: [Informational] Cleaning up source and target shards following a failure or cancellation requested by user.
Progress: 100% | Status: Failed | Details: [Error] The request failed.
PS C:\Code\Lesson06\Splitting> TerminatingError(): "[Error] The request failed."
>> TerminatingError(): "[Error] The request failed."
>> TerminatingError(): "[Error] The request failed."
[Error] The request failed.
At C:\Code\Lesson06\Splitting\SplitMerge\SplitMerge.psm1:363 char:13
+             throw $statusJson.Details
+             ~~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : OperationStopped: ([Error] The request failed.:String) [], RuntimeException
    + FullyQualifiedErrorId : [Error] The request failed.

PS C:\Code\Lesson06\Splitting> clear
PS C:\Code\Lesson06\Splitting> .\SplitToyStoreShard.ps1 -ResourceGroup toystore -SqlServer toyfactory -UserName sqladmin -Password Packt@pub2 -SplitMergeDatabase toystore_splitmerge -SplitMergeServiceEndpoint "https://splitmerge.cloudapp.net/" -ShardMapManagerDatabaseName toystore_SMM -Shard2 toystore_Shard_200 -ShardMapName toystorerangemap -SplitRangeLow 1 -SplitRangeHigh 200 -SplitValue 100
Transcript started, output file is C:\Code\Lesson06\Splitting\Log\SplitToyStoreShard.txt
WARNING: The output object type of this cmdlet will be modified in a future release.


ResourceGroupName : toystore
Location          : eastus2
ProvisioningState : Succeeded
Tags              :
ResourceId        : /subscriptions/bf64f3c6-6e64-48c5-a7cc-6c35b4f9aebf/resourceGroups/toystore



ResourceGroupName        : toystore
ServerName               : toyfactory
Location                 : East US 2
SqlAdministratorLogin    : sqladmin
SqlAdministratorPassword :
ServerVersion            : 12.0
Tags                     :



ResourceGroupName             : toystore
ServerName                    : toyfactory
DatabaseName                  : toystore_splitmerge
Location                      : East US 2
DatabaseId                    : 0c8a58bf-7e77-40be-9bb5-bbf3fb976af6
Edition                       : Basic
CollationName                 : SQL_Latin1_General_CP1_CI_AS
CatalogCollation              :
MaxSizeBytes                  : 2147483648
Status                        : Online
CreationDate                  : 12/22/2017 1:17:29 PM
CurrentServiceObjectiveId     : dd6d99bb-f193-4ec1-86f2-43d3bccbc49c
CurrentServiceObjectiveName   : Basic
RequestedServiceObjectiveId   : dd6d99bb-f193-4ec1-86f2-43d3bccbc49c
RequestedServiceObjectiveName :
ElasticPoolName               :
EarliestRestoreDate           : 12/22/2017 1:48:41 PM
Tags                          :
ResourceId                    : /subscriptions/bf64f3c6-6e64-48c5-a7cc-6c35b4f9aebf/resourceGroups/toystore/providers/Microsoft.Sql/servers/toyfactory/databases/toystore
                                _splitmerge
CreateMode                    :


Sending split request
Polling request status. Press Ctrl-C to end
Progress: 0% | Status: Queued | Details: [Informational] Operation has been queued.
Progress: 5% | Status: Starting | Details: [Informational] Starting Split-Merge state machine for request.
Progress: 5% | Status: Starting | Details: [Informational] Performing data consistency checks on target shards.
Progress: 80% | Status: CopyingShardedTables | Details: [Informational] Moving key range [100:110) of sharded tables.
Progress: 80% | Status: CopyingShardedTables | Details: [Informational] Successfully copied key range [100:110) for sharded table [Sales].[Customers].
Progress: 80% | Status: CopyingShardedTables | Details: [Informational] Successfully copied key range [100:110) for sharded table [Sales].[Orders].
Progress: 90% | Status: Completing | Details: [Informational] Successfully deleted moved shardlets in table [Sales].[Orders].
Progress: 90% | Status: Completing | Details: [Informational] Deleting any temp tables that were created while processing the request.
Progress: 100% | Status: Succeeded | Details: [Informational] Successfully processed request.


PS C:\Code\Lesson06\Splitting> .\SplitToyStoreShard.ps1 -ResourceGroup toystore -SqlServer toyfactory -UserName sqladmin -Password Packt@pub2 -SplitMergeDatabase toystore_splitmerge -SplitMergeServiceEndpoint "https://splitmerge.cloudapp.net/" -ShardMapManagerDatabaseName toystore_SMM -Shard2 toystore_Shard_200 -ShardMapName toystorerangemap -SplitRangeLow 1 -SplitRangeHigh 200 -SplitValue 100
Transcript started, output file is C:\Code\Lesson06\Splitting\Log\SplitToyStoreShard.txt
WARNING: The output object type of this cmdlet will be modified in a future release.


ResourceGroupName : toystore
Location          : eastus2
ProvisioningState : Succeeded
Tags              :
ResourceId        : /subscriptions/bf64f3c6-6e64-48c5-a7cc-6c35b4f9aebf/resourceGroups/toystore



ResourceGroupName        : toystore
ServerName               : toyfactory
Location                 : East US 2
SqlAdministratorLogin    : sqladmin
SqlAdministratorPassword :
ServerVersion            : 12.0
Tags                     :



ResourceGroupName             : toystore
ServerName                    : toyfactory
DatabaseName                  : toystore_splitmerge
Location                      : East US 2
DatabaseId                    : 0c8a58bf-7e77-40be-9bb5-bbf3fb976af6
Edition                       : Basic
CollationName                 : SQL_Latin1_General_CP1_CI_AS
CatalogCollation              :
MaxSizeBytes                  : 2147483648
Status                        : Online
CreationDate                  : 12/22/2017 1:17:29 PM
CurrentServiceObjectiveId     : dd6d99bb-f193-4ec1-86f2-43d3bccbc49c
CurrentServiceObjectiveName   : Basic
RequestedServiceObjectiveId   : dd6d99bb-f193-4ec1-86f2-43d3bccbc49c
RequestedServiceObjectiveName :
ElasticPoolName               :
EarliestRestoreDate           : 12/22/2017 1:48:41 PM
Tags                          :
ResourceId                    : /subscriptions/bf64f3c6-6e64-48c5-a7cc-6c35b4f9aebf/resourceGroups/toystore/providers/Microsoft.Sql/servers/toyfactory/databases/toystore
                                _splitmerge
CreateMode                    :


Sending split request
Polling request status. Press Ctrl-C to end
Progress: 0% | Status: Queued | Details: [Informational] Operation has been queued.
Progress: 100% | Status: Failed | Details: [Error] Failed to process request. Microsoft.Azure.SqlDatabase.ElasticScale.SplitMerge.Worker.InvalidSplitMergeOperationException: The source and target mappings both point to the same shard 'toystore_Shard_200'.
   at Microsoft.Azure.SqlDatabase.ElasticScale.SplitMerge.Worker.SplitMergeService.DoSplitMergeInternal[T](SplitMergeRequestContext`1 requestContext) in d:\_Bld\8089\4133\Sources\Src\ShardSplitMerge\FsmWorkerRole\Service\SplitMergeService.cs:line 429
   at Microsoft.Azure.SqlDatabase.ElasticScale.SplitMerge.Worker.SplitMergeService.ExecuteOne(SqlMessageFetcher sqlMessageFetcher) in d:\_Bld\8089\4133\Sources\Src\ShardSplitMerge\FsmWorkerRole\Service\SplitMergeService.cs:line 377
   at Microsoft.Azure.SqlDatabase.ElasticScale.SplitMerge.Worker.SplitMergeService.TryExecuteOne(SqlMessageFetcher sqlMessageFetcher, MessageDeletionStrategy messageDeletionStrategy) in d:\_Bld\8089\4133\Sources\Src\ShardSplitMerge\FsmWorkerRole\Service\SplitMergeService.cs:line 212
MessageOperationId: 19530045-d400-4a79-85c7-ffb3c91b4535
ErrorCode: SourceTargetSameShard
PS C:\Code\Lesson06\Splitting> TerminatingError(): "[Error] Failed to process request. Microsoft.Azure.SqlDatabase.ElasticScale.SplitMerge.Worker.InvalidSplitMergeOperationException: The source and target mappings both point to the same shard 'toystore_Shard_200'.
   at Microsoft.Azure.SqlDatabase.ElasticScale.SplitMerge.Worker.SplitMergeService.DoSplitMergeInternal[T](SplitMergeRequestContext`1 requestContext) in d:\_Bld\8089\4133\Sources\Src\ShardSplitMerge\FsmWorkerRole\Service\SplitMergeService.cs:line 429
   at Microsoft.Azure.SqlDatabase.ElasticScale.SplitMerge.Worker.SplitMergeService.ExecuteOne(SqlMessageFetcher sqlMessageFetcher) in d:\_Bld\8089\4133\Sources\Src\ShardSplitMerge\FsmWorkerRole\Service\SplitMergeService.cs:line 377
   at Microsoft.Azure.SqlDatabase.ElasticScale.SplitMerge.Worker.SplitMergeService.TryExecuteOne(SqlMessageFetcher sqlMessageFetcher, MessageDeletionStrategy messageDeletionStrategy) in d:\_Bld\8089\4133\Sources\Src\ShardSplitMerge\FsmWorkerRole\Service\SplitMergeService.cs:line 212
MessageOperationId: 19530045-d400-4a79-85c7-ffb3c91b4535
ErrorCode: SourceTargetSameShard"
>> TerminatingError(): "[Error] Failed to process request. Microsoft.Azure.SqlDatabase.ElasticScale.SplitMerge.Worker.InvalidSplitMergeOperationException: The source and target mappings both point to the same shard 'toystore_Shard_200'.
   at Microsoft.Azure.SqlDatabase.ElasticScale.SplitMerge.Worker.SplitMergeService.DoSplitMergeInternal[T](SplitMergeRequestContext`1 requestContext) in d:\_Bld\8089\4133\Sources\Src\ShardSplitMerge\FsmWorkerRole\Service\SplitMergeService.cs:line 429
   at Microsoft.Azure.SqlDatabase.ElasticScale.SplitMerge.Worker.SplitMergeService.ExecuteOne(SqlMessageFetcher sqlMessageFetcher) in d:\_Bld\8089\4133\Sources\Src\ShardSplitMerge\FsmWorkerRole\Service\SplitMergeService.cs:line 377
   at Microsoft.Azure.SqlDatabase.ElasticScale.SplitMerge.Worker.SplitMergeService.TryExecuteOne(SqlMessageFetcher sqlMessageFetcher, MessageDeletionStrategy messageDeletionStrategy) in d:\_Bld\8089\4133\Sources\Src\ShardSplitMerge\FsmWorkerRole\Service\SplitMergeService.cs:line 212
MessageOperationId: 19530045-d400-4a79-85c7-ffb3c91b4535
ErrorCode: SourceTargetSameShard"
>> TerminatingError(): "[Error] Failed to process request. Microsoft.Azure.SqlDatabase.ElasticScale.SplitMerge.Worker.InvalidSplitMergeOperationException: The source and target mappings both point to the same shard 'toystore_Shard_200'.
   at Microsoft.Azure.SqlDatabase.ElasticScale.SplitMerge.Worker.SplitMergeService.DoSplitMergeInternal[T](SplitMergeRequestContext`1 requestContext) in d:\_Bld\8089\4133\Sources\Src\ShardSplitMerge\FsmWorkerRole\Service\SplitMergeService.cs:line 429
   at Microsoft.Azure.SqlDatabase.ElasticScale.SplitMerge.Worker.SplitMergeService.ExecuteOne(SqlMessageFetcher sqlMessageFetcher) in d:\_Bld\8089\4133\Sources\Src\ShardSplitMerge\FsmWorkerRole\Service\SplitMergeService.cs:line 377
   at Microsoft.Azure.SqlDatabase.ElasticScale.SplitMerge.Worker.SplitMergeService.TryExecuteOne(SqlMessageFetcher sqlMessageFetcher, MessageDeletionStrategy messageDeletionStrategy) in d:\_Bld\8089\4133\Sources\Src\ShardSplitMerge\FsmWorkerRole\Service\SplitMergeService.cs:line 212
MessageOperationId: 19530045-d400-4a79-85c7-ffb3c91b4535
ErrorCode: SourceTargetSameShard"
[Error] Failed to process request. Microsoft.Azure.SqlDatabase.ElasticScale.SplitMerge.Worker.InvalidSplitMergeOperationException: The source and target mappings both
point to the same shard 'toystore_Shard_200'.
   at Microsoft.Azure.SqlDatabase.ElasticScale.SplitMerge.Worker.SplitMergeService.DoSplitMergeInternal[T](SplitMergeRequestContext`1 requestContext) in
d:\_Bld\8089\4133\Sources\Src\ShardSplitMerge\FsmWorkerRole\Service\SplitMergeService.cs:line 429
   at Microsoft.Azure.SqlDatabase.ElasticScale.SplitMerge.Worker.SplitMergeService.ExecuteOne(SqlMessageFetcher sqlMessageFetcher) in
d:\_Bld\8089\4133\Sources\Src\ShardSplitMerge\FsmWorkerRole\Service\SplitMergeService.cs:line 377
   at Microsoft.Azure.SqlDatabase.ElasticScale.SplitMerge.Worker.SplitMergeService.TryExecuteOne(SqlMessageFetcher sqlMessageFetcher, MessageDeletionStrategy
messageDeletionStrategy) in d:\_Bld\8089\4133\Sources\Src\ShardSplitMerge\FsmWorkerRole\Service\SplitMergeService.cs:line 212
MessageOperationId: 19530045-d400-4a79-85c7-ffb3c91b4535
ErrorCode: SourceTargetSameShard
At C:\Code\Lesson06\Splitting\SplitMerge\SplitMerge.psm1:363 char:13
+             throw $statusJson.Details
+             ~~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : OperationStopped: ([Error] Failed ...TargetSameShard:String) [], RuntimeException
    + FullyQualifiedErrorId : [Error] Failed to process request. Microsoft.Azure.SqlDatabase.ElasticScale.SplitMerge.Worker.InvalidSplitMergeOperationException: The sou
   rce and target mappings both point to the same shard 'toystore_Shard_200'.
       at Microsoft.Azure.SqlDatabase.ElasticScale.SplitMerge.Worker.SplitMergeService.DoSplitMergeInternal[T](SplitMergeRequestContext`1 requestContext) in d:\_Bld\808
   9\4133\Sources\Src\ShardSplitMerge\FsmWorkerRole\Service\SplitMergeService.cs:line 429
       at Microsoft.Azure.SqlDatabase.ElasticScale.SplitMerge.Worker.SplitMergeService.ExecuteOne(SqlMessageFetcher sqlMessageFetcher) in d:\_Bld\8089\4133\Sources\Src\
   ShardSplitMerge\FsmWorkerRole\Service\SplitMergeService.cs:line 377
       at Microsoft.Azure.SqlDatabase.ElasticScale.SplitMerge.Worker.SplitMergeService.TryExecuteOne(SqlMessageFetcher sqlMessageFetcher, MessageDeletionStrategy messag
   eDeletionStrategy) in d:\_Bld\8089\4133\Sources\Src\ShardSplitMerge\FsmWorkerRole\Service\SplitMergeService.cs:line 212
MessageOperationId: 19530045-d400-4a79-85c7-ffb3c91b4535
ErrorCode: SourceTargetSameShard

PS C:\Code\Lesson06\Splitting> Get-Mappings -ShardMap toystorerangemap
>> TerminatingError(Get-Mappings): "Method invocation failed because [System.String] does not contain a method named 'GetMappings'."
Get-Mappings : Method invocation failed because [System.String] does not contain a method named 'GetMappings'.
At line:1 char:1
+ Get-Mappings -ShardMap toystorerangemap
+ ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : InvalidOperation: (:) [Get-Mappings], RuntimeException
    + FullyQualifiedErrorId : MethodNotFound,Get-Mappings
Get-Mappings : Method invocation failed because [System.String] does not contain a method named 'GetMappings'.
At line:1 char:1
+ Get-Mappings -ShardMap toystorerangemap
+ ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : InvalidOperation: (:) [Get-Mappings], RuntimeException
    + FullyQualifiedErrorId : MethodNotFound,Get-Mappings

PS C:\Code\Lesson06\Splitting> cd ..
PS C:\Code\Lesson06> cd .\Sharding
PS C:\Code\Lesson06\Sharding> .\Sharding.ps1 -ResourceGroup toystore -SqlServer toyfactory -UserName sqladmin -Password Packt@pub2 -ShardMapManagerDatabase toystore_SMM -DatabaseToShard toystore
Transcript started, output file is C:\Code\Lesson06\Sharding\Log\Sharding.txt
WARNING: The output object type of this cmdlet will be modified in a future release.


ResourceGroupName : toystore
Location          : eastus2
ProvisioningState : Succeeded
Tags              :
ResourceId        : /subscriptions/bf64f3c6-6e64-48c5-a7cc-6c35b4f9aebf/resourceGroups/toystore



ResourceGroupName        : toystore
ServerName               : toyfactory
Location                 : East US 2
SqlAdministratorLogin    : sqladmin
SqlAdministratorPassword :
ServerVersion            : 12.0
Tags                     :


Provisioning Azure SQL Database toystore_SMM

ResourceGroupName             : toystore
ServerName                    : toyfactory
DatabaseName                  : toystore_SMM
Location                      : East US 2
DatabaseId                    : 110cb3f4-0d92-4991-baa6-8f760c894957
Edition                       : Standard
CollationName                 : SQL_Latin1_General_CP1_CI_AS
CatalogCollation              :
MaxSizeBytes                  : 268435456000
Status                        : Online
CreationDate                  : 12/23/2017 10:26:02 AM
CurrentServiceObjectiveId     : f1173c43-91bd-4aaa-973c-54e79e15235b
CurrentServiceObjectiveName   : S0
RequestedServiceObjectiveId   : f1173c43-91bd-4aaa-973c-54e79e15235b
RequestedServiceObjectiveName :
ElasticPoolName               :
EarliestRestoreDate           : 12/23/2017 10:57:14 AM
Tags                          :
ResourceId                    : /subscriptions/bf64f3c6-6e64-48c5-a7cc-6c35b4f9aebf/resourceGroups/toystore/providers/Microsoft.Sql/servers/toyfactory/databases/toystore
                                _SMM
CreateMode                    :

WARNING: The output object type of this cmdlet will be modified in a future release.
ResourceGroupName : toystore
Location          : eastus2
ProvisioningState : Succeeded
Tags              :
ResourceId        : /subscriptions/bf64f3c6-6e64-48c5-a7cc-6c35b4f9aebf/resourceGroups/toystore



ResourceGroupName        : toystore
ServerName               : toyfactory
Location                 : East US 2
SqlAdministratorLogin    : sqladmin
SqlAdministratorPassword :
ServerVersion            : 12.0
Tags                     :


Provisioning Azure SQL Database toystore_Shard_200

ResourceGroupName             : toystore
ServerName                    : toyfactory
DatabaseName                  : toystore_Shard_200
Location                      : East US 2
DatabaseId                    : 54fd062a-1241-4df6-9cb8-169c8265bab8
Edition                       : Standard
CollationName                 : SQL_Latin1_General_CP1_CI_AS
CatalogCollation              :
MaxSizeBytes                  : 268435456000
Status                        : Online
CreationDate                  : 12/23/2017 10:28:11 AM
CurrentServiceObjectiveId     : f1173c43-91bd-4aaa-973c-54e79e15235b
CurrentServiceObjectiveName   : S0
RequestedServiceObjectiveId   : f1173c43-91bd-4aaa-973c-54e79e15235b
RequestedServiceObjectiveName :
ElasticPoolName               :
EarliestRestoreDate           : 12/23/2017 10:59:13 AM
Tags                          :
ResourceId                    : /subscriptions/bf64f3c6-6e64-48c5-a7cc-6c35b4f9aebf/resourceGroups/toystore/providers/Microsoft.Sql/servers/toyfactory/databases/toystore
                                _Shard_200
CreateMode                    :

Configuring database toystore_SMM as Shard Map Manager
Adding toystore_Shard_1_100 and toystore_Shard_200 to the Shard Map toystorerangemap
Add range keys to toystore_Shard_1_100 (Shard1)
Adding schema mappings to the Shard Map Manager Database
toystore is now Sharded.


PS C:\Code\Lesson06\Sharding> cd ..
PS C:\Code\Lesson06> cd .\Splitting
PS C:\Code\Lesson06\Splitting> .\SplitToyStoreShard.ps1 -ResourceGroup toystore -SqlServer toyfactory -UserName sqladmin -Password Packt@pub2 -SplitMergeDatabase toystore_splitmerge -SplitMergeServiceEndpoint "https://splitmerge.cloudapp.net/" -ShardMapManagerDatabaseName toystore_SMM -Shard2 toystore_Shard_200 -ShardMapName toystorerangemap -SplitRangeLow 1 -SplitRangeHigh 200 -SplitValue 100
Transcript started, output file is C:\Code\Lesson06\Splitting\Log\SplitToyStoreShard.txt
WARNING: The output object type of this cmdlet will be modified in a future release.


ResourceGroupName : toystore
Location          : eastus2
ProvisioningState : Succeeded
Tags              :
ResourceId        : /subscriptions/bf64f3c6-6e64-48c5-a7cc-6c35b4f9aebf/resourceGroups/toystore



ResourceGroupName        : toystore
ServerName               : toyfactory
Location                 : East US 2
SqlAdministratorLogin    : sqladmin
SqlAdministratorPassword :
ServerVersion            : 12.0
Tags                     :


Provisioning Azure SQL Database toystore_splitmerge

ResourceGroupName             : toystore
ServerName                    : toyfactory
DatabaseName                  : toystore_splitmerge
Location                      : East US 2
DatabaseId                    : a17e42bf-809c-4a2e-b732-9e58d192f195
Edition                       : Basic
CollationName                 : SQL_Latin1_General_CP1_CI_AS
CatalogCollation              :
MaxSizeBytes                  : 2147483648
Status                        : Online
CreationDate                  : 12/23/2017 10:31:36 AM
CurrentServiceObjectiveId     : dd6d99bb-f193-4ec1-86f2-43d3bccbc49c
CurrentServiceObjectiveName   : Basic
RequestedServiceObjectiveId   : dd6d99bb-f193-4ec1-86f2-43d3bccbc49c
RequestedServiceObjectiveName :
ElasticPoolName               :
EarliestRestoreDate           : 12/23/2017 11:02:51 AM
Tags                          :
ResourceId                    : /subscriptions/bf64f3c6-6e64-48c5-a7cc-6c35b4f9aebf/resourceGroups/toystore/providers/Microsoft.Sql/servers/toyfactory/databases/toystore
                                _splitmerge
CreateMode                    :

Sending split request
PS C:\Code\Lesson06\Splitting> TerminatingError(): "Failure to submit request: @{Details=[Exception] System.Data.SqlClient.SqlException (0x80131904): Could not find stored procedure 'dbo.InsertRequest'.
   at System.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at System.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at System.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at System.Data.SqlClient.SqlCommand.FinishExecuteReader(SqlDataReader ds, RunBehavior runBehavior, String resetOptionsString)
   at System.Data.SqlClient.SqlCommand.RunExecuteReaderTds(CommandBehavior cmdBehavior, RunBehavior runBehavior, Boolean returnStream, Boolean async, Int32 timeout, Task& task, Boolean asyncWrite, SqlDataReader ds)
   at System.Data.SqlClient.SqlCommand.RunExecuteReader(CommandBehavior cmdBehavior, RunBehavior runBehavior, Boolean returnStream, String method, TaskCompletionSource`1 completion, Int32 timeout, Task& task, Boolean asyncWrite)
   at System.Data.SqlClient.SqlCommand.InternalExecuteNonQuery(TaskCompletionSource`1 completion, String methodName, Boolean sendToPipe, Int32 timeout, Boolean asyncWrite)
   at System.Data.SqlClient.SqlCommand.ExecuteNonQuery()
   at Microsoft.Practices.EnterpriseLibrary.TransientFaultHandling.ReliableSqlConnection.<>c__DisplayClass6`1.<ExecuteCommand>b__4()
   at Microsoft.Practices.EnterpriseLibrary.TransientFaultHandling.RetryPolicy.ExecuteAction[TResult](Func`1 func)
   at Microsoft.Practices.EnterpriseLibrary.TransientFaultHandling.ReliableSqlConnection.<>c__DisplayClass6`1.<ExecuteCommand>b__3()
   at Microsoft.Practices.EnterpriseLibrary.TransientFaultHandling.RetryPolicy.<>c__DisplayClass1.<ExecuteAction>b__0()
   at Microsoft.Practices.EnterpriseLibrary.TransientFaultHandling.RetryPolicy.ExecuteAction[TResult](Func`1 func)
   at Microsoft.Practices.EnterpriseLibrary.TransientFaultHandling.ReliableSqlConnection.ExecuteCommand[T](IDbCommand command, RetryPolicy retryPolicy, CommandBehavior behavior)
   at Microsoft.Azure.SqlDatabase.ElasticScale.SplitMerge.Client.SqlCommandExecutor.ExecuteNonQueryWithRetry(String connectionString, SqlCommand command, RetryPolicy retryPolicy)
   at Microsoft.Azure.SqlDatabase.ElasticScale.SplitMerge.Client.SqlCommandExecutor.ExecuteNonQueryWithRetry(String connectionString, String commandText, CommandType commandType, IEnumerable`1 parameters)
   at Microsoft.Azure.SqlDatabase.ElasticScale.SplitMerge.Client.Messaging.SqlMessageDispatcher.SendMessageRawXml(FsmMessage message)
   at Microsoft.Azure.SqlDatabase.ElasticScale.SplitMerge.Web.Controllers.SplitMergeController.ProcessNormalRequest(FormDataCollection formData)
ClientConnectionId:1939b3c6-99f2-43da-ab67-33de9168638c
Error Number:2812,State:62,Class:16
ClientConnectionId before routing:55ad4188-f056-4f21-998f-97a0a4954c16
Routing Destination:a503a89418a5.tr1.eastus2-a.worker.database.windows.net,11191}.Details"
>> TerminatingError(): "Failure to submit request: @{Details=[Exception] System.Data.SqlClient.SqlException (0x80131904): Could not find stored procedure 'dbo.InsertRequest'.
   at System.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at System.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at System.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at System.Data.SqlClient.SqlCommand.FinishExecuteReader(SqlDataReader ds, RunBehavior runBehavior, String resetOptionsString)
   at System.Data.SqlClient.SqlCommand.RunExecuteReaderTds(CommandBehavior cmdBehavior, RunBehavior runBehavior, Boolean returnStream, Boolean async, Int32 timeout, Task& task, Boolean asyncWrite, SqlDataReader ds)
   at System.Data.SqlClient.SqlCommand.RunExecuteReader(CommandBehavior cmdBehavior, RunBehavior runBehavior, Boolean returnStream, String method, TaskCompletionSource`1 completion, Int32 timeout, Task& task, Boolean asyncWrite)
   at System.Data.SqlClient.SqlCommand.InternalExecuteNonQuery(TaskCompletionSource`1 completion, String methodName, Boolean sendToPipe, Int32 timeout, Boolean asyncWrite)
   at System.Data.SqlClient.SqlCommand.ExecuteNonQuery()
   at Microsoft.Practices.EnterpriseLibrary.TransientFaultHandling.ReliableSqlConnection.<>c__DisplayClass6`1.<ExecuteCommand>b__4()
   at Microsoft.Practices.EnterpriseLibrary.TransientFaultHandling.RetryPolicy.ExecuteAction[TResult](Func`1 func)
   at Microsoft.Practices.EnterpriseLibrary.TransientFaultHandling.ReliableSqlConnection.<>c__DisplayClass6`1.<ExecuteCommand>b__3()
   at Microsoft.Practices.EnterpriseLibrary.TransientFaultHandling.RetryPolicy.<>c__DisplayClass1.<ExecuteAction>b__0()
   at Microsoft.Practices.EnterpriseLibrary.TransientFaultHandling.RetryPolicy.ExecuteAction[TResult](Func`1 func)
   at Microsoft.Practices.EnterpriseLibrary.TransientFaultHandling.ReliableSqlConnection.ExecuteCommand[T](IDbCommand command, RetryPolicy retryPolicy, CommandBehavior behavior)
   at Microsoft.Azure.SqlDatabase.ElasticScale.SplitMerge.Client.SqlCommandExecutor.ExecuteNonQueryWithRetry(String connectionString, SqlCommand command, RetryPolicy retryPolicy)
   at Microsoft.Azure.SqlDatabase.ElasticScale.SplitMerge.Client.SqlCommandExecutor.ExecuteNonQueryWithRetry(String connectionString, String commandText, CommandType commandType, IEnumerable`1 parameters)
   at Microsoft.Azure.SqlDatabase.ElasticScale.SplitMerge.Client.Messaging.SqlMessageDispatcher.SendMessageRawXml(FsmMessage message)
   at Microsoft.Azure.SqlDatabase.ElasticScale.SplitMerge.Web.Controllers.SplitMergeController.ProcessNormalRequest(FormDataCollection formData)
ClientConnectionId:1939b3c6-99f2-43da-ab67-33de9168638c
Error Number:2812,State:62,Class:16
ClientConnectionId before routing:55ad4188-f056-4f21-998f-97a0a4954c16
Routing Destination:a503a89418a5.tr1.eastus2-a.worker.database.windows.net,11191}.Details"
>> TerminatingError(): "Failure to submit request: @{Details=[Exception] System.Data.SqlClient.SqlException (0x80131904): Could not find stored procedure 'dbo.InsertRequest'.
   at System.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at System.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at System.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at System.Data.SqlClient.SqlCommand.FinishExecuteReader(SqlDataReader ds, RunBehavior runBehavior, String resetOptionsString)
   at System.Data.SqlClient.SqlCommand.RunExecuteReaderTds(CommandBehavior cmdBehavior, RunBehavior runBehavior, Boolean returnStream, Boolean async, Int32 timeout, Task& task, Boolean asyncWrite, SqlDataReader ds)
   at System.Data.SqlClient.SqlCommand.RunExecuteReader(CommandBehavior cmdBehavior, RunBehavior runBehavior, Boolean returnStream, String method, TaskCompletionSource`1 completion, Int32 timeout, Task& task, Boolean asyncWrite)
   at System.Data.SqlClient.SqlCommand.InternalExecuteNonQuery(TaskCompletionSource`1 completion, String methodName, Boolean sendToPipe, Int32 timeout, Boolean asyncWrite)
   at System.Data.SqlClient.SqlCommand.ExecuteNonQuery()
   at Microsoft.Practices.EnterpriseLibrary.TransientFaultHandling.ReliableSqlConnection.<>c__DisplayClass6`1.<ExecuteCommand>b__4()
   at Microsoft.Practices.EnterpriseLibrary.TransientFaultHandling.RetryPolicy.ExecuteAction[TResult](Func`1 func)
   at Microsoft.Practices.EnterpriseLibrary.TransientFaultHandling.ReliableSqlConnection.<>c__DisplayClass6`1.<ExecuteCommand>b__3()
   at Microsoft.Practices.EnterpriseLibrary.TransientFaultHandling.RetryPolicy.<>c__DisplayClass1.<ExecuteAction>b__0()
   at Microsoft.Practices.EnterpriseLibrary.TransientFaultHandling.RetryPolicy.ExecuteAction[TResult](Func`1 func)
   at Microsoft.Practices.EnterpriseLibrary.TransientFaultHandling.ReliableSqlConnection.ExecuteCommand[T](IDbCommand command, RetryPolicy retryPolicy, CommandBehavior behavior)
   at Microsoft.Azure.SqlDatabase.ElasticScale.SplitMerge.Client.SqlCommandExecutor.ExecuteNonQueryWithRetry(String connectionString, SqlCommand command, RetryPolicy retryPolicy)
   at Microsoft.Azure.SqlDatabase.ElasticScale.SplitMerge.Client.SqlCommandExecutor.ExecuteNonQueryWithRetry(String connectionString, String commandText, CommandType commandType, IEnumerable`1 parameters)
   at Microsoft.Azure.SqlDatabase.ElasticScale.SplitMerge.Client.Messaging.SqlMessageDispatcher.SendMessageRawXml(FsmMessage message)
   at Microsoft.Azure.SqlDatabase.ElasticScale.SplitMerge.Web.Controllers.SplitMergeController.ProcessNormalRequest(FormDataCollection formData)
ClientConnectionId:1939b3c6-99f2-43da-ab67-33de9168638c
Error Number:2812,State:62,Class:16
ClientConnectionId before routing:55ad4188-f056-4f21-998f-97a0a4954c16
Routing Destination:a503a89418a5.tr1.eastus2-a.worker.database.windows.net,11191}.Details"
>> TerminatingError(): "Failure to submit request: @{Details=[Exception] System.Data.SqlClient.SqlException (0x80131904): Could not find stored procedure 'dbo.InsertRequest'.
   at System.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at System.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at System.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at System.Data.SqlClient.SqlCommand.FinishExecuteReader(SqlDataReader ds, RunBehavior runBehavior, String resetOptionsString)
   at System.Data.SqlClient.SqlCommand.RunExecuteReaderTds(CommandBehavior cmdBehavior, RunBehavior runBehavior, Boolean returnStream, Boolean async, Int32 timeout, Task& task, Boolean asyncWrite, SqlDataReader ds)
   at System.Data.SqlClient.SqlCommand.RunExecuteReader(CommandBehavior cmdBehavior, RunBehavior runBehavior, Boolean returnStream, String method, TaskCompletionSource`1 completion, Int32 timeout, Task& task, Boolean asyncWrite)
   at System.Data.SqlClient.SqlCommand.InternalExecuteNonQuery(TaskCompletionSource`1 completion, String methodName, Boolean sendToPipe, Int32 timeout, Boolean asyncWrite)
   at System.Data.SqlClient.SqlCommand.ExecuteNonQuery()
   at Microsoft.Practices.EnterpriseLibrary.TransientFaultHandling.ReliableSqlConnection.<>c__DisplayClass6`1.<ExecuteCommand>b__4()
   at Microsoft.Practices.EnterpriseLibrary.TransientFaultHandling.RetryPolicy.ExecuteAction[TResult](Func`1 func)
   at Microsoft.Practices.EnterpriseLibrary.TransientFaultHandling.ReliableSqlConnection.<>c__DisplayClass6`1.<ExecuteCommand>b__3()
   at Microsoft.Practices.EnterpriseLibrary.TransientFaultHandling.RetryPolicy.<>c__DisplayClass1.<ExecuteAction>b__0()
   at Microsoft.Practices.EnterpriseLibrary.TransientFaultHandling.RetryPolicy.ExecuteAction[TResult](Func`1 func)
   at Microsoft.Practices.EnterpriseLibrary.TransientFaultHandling.ReliableSqlConnection.ExecuteCommand[T](IDbCommand command, RetryPolicy retryPolicy, CommandBehavior behavior)
   at Microsoft.Azure.SqlDatabase.ElasticScale.SplitMerge.Client.SqlCommandExecutor.ExecuteNonQueryWithRetry(String connectionString, SqlCommand command, RetryPolicy retryPolicy)
   at Microsoft.Azure.SqlDatabase.ElasticScale.SplitMerge.Client.SqlCommandExecutor.ExecuteNonQueryWithRetry(String connectionString, String commandText, CommandType commandType, IEnumerable`1 parameters)
   at Microsoft.Azure.SqlDatabase.ElasticScale.SplitMerge.Client.Messaging.SqlMessageDispatcher.SendMessageRawXml(FsmMessage message)
   at Microsoft.Azure.SqlDatabase.ElasticScale.SplitMerge.Web.Controllers.SplitMergeController.ProcessNormalRequest(FormDataCollection formData)
ClientConnectionId:1939b3c6-99f2-43da-ab67-33de9168638c
Error Number:2812,State:62,Class:16
ClientConnectionId before routing:55ad4188-f056-4f21-998f-97a0a4954c16
Routing Destination:a503a89418a5.tr1.eastus2-a.worker.database.windows.net,11191}.Details"
Failure to submit request: @{Details=[Exception] System.Data.SqlClient.SqlException (0x80131904): Could not find stored procedure 'dbo.InsertRequest'.
   at System.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at System.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at System.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler,
TdsParserStateObject stateObj, Boolean& dataReady)
   at System.Data.SqlClient.SqlCommand.FinishExecuteReader(SqlDataReader ds, RunBehavior runBehavior, String resetOptionsString)
   at System.Data.SqlClient.SqlCommand.RunExecuteReaderTds(CommandBehavior cmdBehavior, RunBehavior runBehavior, Boolean returnStream, Boolean async, Int32 timeout,
Task& task, Boolean asyncWrite, SqlDataReader ds)
   at System.Data.SqlClient.SqlCommand.RunExecuteReader(CommandBehavior cmdBehavior, RunBehavior runBehavior, Boolean returnStream, String method,
TaskCompletionSource`1 completion, Int32 timeout, Task& task, Boolean asyncWrite)
   at System.Data.SqlClient.SqlCommand.InternalExecuteNonQuery(TaskCompletionSource`1 completion, String methodName, Boolean sendToPipe, Int32 timeout, Boolean
asyncWrite)
   at System.Data.SqlClient.SqlCommand.ExecuteNonQuery()
   at Microsoft.Practices.EnterpriseLibrary.TransientFaultHandling.ReliableSqlConnection.<>c__DisplayClass6`1.<ExecuteCommand>b__4()
   at Microsoft.Practices.EnterpriseLibrary.TransientFaultHandling.RetryPolicy.ExecuteAction[TResult](Func`1 func)
   at Microsoft.Practices.EnterpriseLibrary.TransientFaultHandling.ReliableSqlConnection.<>c__DisplayClass6`1.<ExecuteCommand>b__3()
   at Microsoft.Practices.EnterpriseLibrary.TransientFaultHandling.RetryPolicy.<>c__DisplayClass1.<ExecuteAction>b__0()
   at Microsoft.Practices.EnterpriseLibrary.TransientFaultHandling.RetryPolicy.ExecuteAction[TResult](Func`1 func)
   at Microsoft.Practices.EnterpriseLibrary.TransientFaultHandling.ReliableSqlConnection.ExecuteCommand[T](IDbCommand command, RetryPolicy retryPolicy, CommandBehavior
behavior)
   at Microsoft.Azure.SqlDatabase.ElasticScale.SplitMerge.Client.SqlCommandExecutor.ExecuteNonQueryWithRetry(String connectionString, SqlCommand command, RetryPolicy
retryPolicy)
   at Microsoft.Azure.SqlDatabase.ElasticScale.SplitMerge.Client.SqlCommandExecutor.ExecuteNonQueryWithRetry(String connectionString, String commandText, CommandType
commandType, IEnumerable`1 parameters)
   at Microsoft.Azure.SqlDatabase.ElasticScale.SplitMerge.Client.Messaging.SqlMessageDispatcher.SendMessageRawXml(FsmMessage message)
   at Microsoft.Azure.SqlDatabase.ElasticScale.SplitMerge.Web.Controllers.SplitMergeController.ProcessNormalRequest(FormDataCollection formData)
ClientConnectionId:1939b3c6-99f2-43da-ab67-33de9168638c
Error Number:2812,State:62,Class:16
ClientConnectionId before routing:55ad4188-f056-4f21-998f-97a0a4954c16
Routing Destination:a503a89418a5.tr1.eastus2-a.worker.database.windows.net,11191}.Details
At C:\Code\Lesson06\Splitting\SplitMerge\SplitMerge.psm1:280 char:9
+         throw "Failure to submit request: $postResponseJson.Details"
+         ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : OperationStopped: (Failure to subm...,11191}.Details:String) [], RuntimeException
    + FullyQualifiedErrorId : Failure to submit request: @{Details=[Exception] System.Data.SqlClient.SqlException (0x80131904): Could not find stored procedure 'dbo.Ins
   ertRequest'.
   at System.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at System.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
       at System.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsP
   arserStateObject stateObj, Boolean& dataReady)
   at System.Data.SqlClient.SqlCommand.FinishExecuteReader(SqlDataReader ds, RunBehavior runBehavior, String resetOptionsString)
       at System.Data.SqlClient.SqlCommand.RunExecuteReaderTds(CommandBehavior cmdBehavior, RunBehavior runBehavior, Boolean returnStream, Boolean async, Int32 timeout,
    Task& task, Boolean asyncWrite, SqlDataReader ds)
       at System.Data.SqlClient.SqlCommand.RunExecuteReader(CommandBehavior cmdBehavior, RunBehavior runBehavior, Boolean returnStream, String method, TaskCompletionSou
   rce`1 completion, Int32 timeout, Task& task, Boolean asyncWrite)
       at System.Data.SqlClient.SqlCommand.InternalExecuteNonQuery(TaskCompletionSource`1 completion, String methodName, Boolean sendToPipe, Int32 timeout, Boolean asyn
   cWrite)
   at System.Data.SqlClient.SqlCommand.ExecuteNonQuery()
   at Microsoft.Practices.EnterpriseLibrary.TransientFaultHandling.ReliableSqlConnection.<>c__DisplayClass6`1.<ExecuteCommand>b__4()
   at Microsoft.Practices.EnterpriseLibrary.TransientFaultHandling.RetryPolicy.ExecuteAction[TResult](Func`1 func)
   at Microsoft.Practices.EnterpriseLibrary.TransientFaultHandling.ReliableSqlConnection.<>c__DisplayClass6`1.<ExecuteCommand>b__3()
   at Microsoft.Practices.EnterpriseLibrary.TransientFaultHandling.RetryPolicy.<>c__DisplayClass1.<ExecuteAction>b__0()
   at Microsoft.Practices.EnterpriseLibrary.TransientFaultHandling.RetryPolicy.ExecuteAction[TResult](Func`1 func)
       at Microsoft.Practices.EnterpriseLibrary.TransientFaultHandling.ReliableSqlConnection.ExecuteCommand[T](IDbCommand command, RetryPolicy retryPolicy, CommandBehav
   ior behavior)
       at Microsoft.Azure.SqlDatabase.ElasticScale.SplitMerge.Client.SqlCommandExecutor.ExecuteNonQueryWithRetry(String connectionString, SqlCommand command, RetryPolic
   y retryPolicy)
       at Microsoft.Azure.SqlDatabase.ElasticScale.SplitMerge.Client.SqlCommandExecutor.ExecuteNonQueryWithRetry(String connectionString, String commandText, CommandTyp
   e commandType, IEnumerable`1 parameters)
   at Microsoft.Azure.SqlDatabase.ElasticScale.SplitMerge.Client.Messaging.SqlMessageDispatcher.SendMessageRawXml(FsmMessage message)
   at Microsoft.Azure.SqlDatabase.ElasticScale.SplitMerge.Web.Controllers.SplitMergeController.ProcessNormalRequest(FormDataCollection formData)
ClientConnectionId:1939b3c6-99f2-43da-ab67-33de9168638c
Error Number:2812,State:62,Class:16
ClientConnectionId before routing:55ad4188-f056-4f21-998f-97a0a4954c16
Routing Destination:a503a89418a5.tr1.eastus2-a.worker.database.windows.net,11191}.Details

PS C:\Code\Lesson06\Splitting> .\SplitToyStoreShard.ps1 -ResourceGroup toystore -SqlServer toyfactory -UserName sqladmin -Password Packt@pub2 -SplitMergeDatabase toystore_splitmerge -SplitMergeServiceEndpoint "https://splitmerge.cloudapp.net/" -ShardMapManagerDatabaseName toystore_SMM -Shard2 toystore_Shard_200 -ShardMapName toystorerangemap -SplitRangeLow 1 -SplitRangeHigh 200 -SplitValue 100
Transcript started, output file is C:\Code\Lesson06\Splitting\Log\SplitToyStoreShard.txt
WARNING: The output object type of this cmdlet will be modified in a future release.


ResourceGroupName : toystore
Location          : eastus2
ProvisioningState : Succeeded
Tags              :
ResourceId        : /subscriptions/bf64f3c6-6e64-48c5-a7cc-6c35b4f9aebf/resourceGroups/toystore



ResourceGroupName        : toystore
ServerName               : toyfactory
Location                 : East US 2
SqlAdministratorLogin    : sqladmin
SqlAdministratorPassword :
ServerVersion            : 12.0
Tags                     :



ResourceGroupName             : toystore
ServerName                    : toyfactory
DatabaseName                  : toystore_splitmerge
Location                      : East US 2
DatabaseId                    : a17e42bf-809c-4a2e-b732-9e58d192f195
Edition                       : Basic
CollationName                 : SQL_Latin1_General_CP1_CI_AS
CatalogCollation              :
MaxSizeBytes                  : 2147483648
Status                        : Online
CreationDate                  : 12/23/2017 10:31:36 AM
CurrentServiceObjectiveId     : dd6d99bb-f193-4ec1-86f2-43d3bccbc49c
CurrentServiceObjectiveName   : Basic
RequestedServiceObjectiveId   : dd6d99bb-f193-4ec1-86f2-43d3bccbc49c
RequestedServiceObjectiveName :
ElasticPoolName               :
EarliestRestoreDate           : 12/23/2017 11:02:51 AM
Tags                          :
ResourceId                    : /subscriptions/bf64f3c6-6e64-48c5-a7cc-6c35b4f9aebf/resourceGroups/toystore/providers/Microsoft.Sql/servers/toyfactory/databases/toystore
                                _splitmerge
CreateMode                    :


Sending split request
PS C:\Code\Lesson06\Splitting> TerminatingError(Invoke-WebRequest): "Unable to connect to the remote server"
>> TerminatingError(Invoke-WebRequest): "Unable to connect to the remote server"
>> TerminatingError(Invoke-WebRequest): "Unable to connect to the remote server"
>> TerminatingError(Invoke-WebRequest): "Unable to connect to the remote server"
Invoke-WebRequest : Unable to connect to the remote server
At C:\Code\Lesson06\Splitting\SplitMerge\SplitMerge.psm1:86 char:13
+     $body = Invoke-WebRequest @certificate $SplitMergeServiceEndpoint ...
+             ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : InvalidOperation: (System.Net.HttpWebRequest:HttpWebRequest) [Invoke-WebRequest], WebException
    + FullyQualifiedErrorId : WebCmdletWebResponseException,Microsoft.PowerShell.Commands.InvokeWebRequestCommand

PS C:\Code\Lesson06\Splitting> .\SplitToyStoreShard.ps1 -ResourceGroup toystore -SqlServer toyfactory -UserName sqladmin -Password Packt@pub2 -SplitMergeDatabase toystore_splitmerge -SplitMergeServiceEndpoint "https://splitmerge.cloudapp.net/" -ShardMapManagerDatabaseName toystore_SMM -Shard2 toystore_Shard_200 -ShardMapName toystorerangemap -SplitRangeLow 1 -SplitRangeHigh 200 -SplitValue 100
Transcript started, output file is C:\Code\Lesson06\Splitting\Log\SplitToyStoreShard.txt
WARNING: The output object type of this cmdlet will be modified in a future release.


ResourceGroupName : toystore
Location          : eastus2
ProvisioningState : Succeeded
Tags              :
ResourceId        : /subscriptions/bf64f3c6-6e64-48c5-a7cc-6c35b4f9aebf/resourceGroups/toystore



ResourceGroupName        : toystore
ServerName               : toyfactory
Location                 : East US 2
SqlAdministratorLogin    : sqladmin
SqlAdministratorPassword :
ServerVersion            : 12.0
Tags                     :



ResourceGroupName             : toystore
ServerName                    : toyfactory
DatabaseName                  : toystore_splitmerge
Location                      : East US 2
DatabaseId                    : a17e42bf-809c-4a2e-b732-9e58d192f195
Edition                       : Basic
CollationName                 : SQL_Latin1_General_CP1_CI_AS
CatalogCollation              :
MaxSizeBytes                  : 2147483648
Status                        : Online
CreationDate                  : 12/23/2017 10:31:36 AM
CurrentServiceObjectiveId     : dd6d99bb-f193-4ec1-86f2-43d3bccbc49c
CurrentServiceObjectiveName   : Basic
RequestedServiceObjectiveId   : dd6d99bb-f193-4ec1-86f2-43d3bccbc49c
RequestedServiceObjectiveName :
ElasticPoolName               :
EarliestRestoreDate           : 12/23/2017 11:02:51 AM
Tags                          :
ResourceId                    : /subscriptions/bf64f3c6-6e64-48c5-a7cc-6c35b4f9aebf/resourceGroups/toystore/providers/Microsoft.Sql/servers/toyfactory/databases/toystore
                                _splitmerge
CreateMode                    :


Sending split request
PS C:\Code\Lesson06\Splitting> TerminatingError(Invoke-WebRequest): "Unable to connect to the remote server"
>> TerminatingError(Invoke-WebRequest): "Unable to connect to the remote server"
>> TerminatingError(Invoke-WebRequest): "Unable to connect to the remote server"
>> TerminatingError(Invoke-WebRequest): "Unable to connect to the remote server"
Invoke-WebRequest : Unable to connect to the remote server
At C:\Code\Lesson06\Splitting\SplitMerge\SplitMerge.psm1:86 char:13
+     $body = Invoke-WebRequest @certificate $SplitMergeServiceEndpoint ...
+             ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : InvalidOperation: (System.Net.HttpWebRequest:HttpWebRequest) [Invoke-WebRequest], WebException
    + FullyQualifiedErrorId : WebCmdletWebResponseException,Microsoft.PowerShell.Commands.InvokeWebRequestCommand

**********************
Windows PowerShell transcript start
Start time: 20171223163259
Username: WIN2012R2\Administrator
RunAs User: WIN2012R2\Administrator
Machine: WIN2012R2 (Microsoft Windows NT 6.3.9600.0)
Host Application: C:\Windows\System32\WindowsPowerShell\v1.0\powershell_ise.exe C:\Code\Lesson06\Splitting\SplitToyStoreShard.ps1
Process ID: 3728
PSVersion: 5.0.10586.117
PSCompatibleVersions: 1.0, 2.0, 3.0, 4.0, 5.0.10586.117
BuildVersion: 10.0.10586.117
CLRVersion: 4.0.30319.42000
WSManStackVersion: 3.0
PSRemotingProtocolVersion: 2.3
SerializationVersion: 1.1.0.1
**********************
Transcript started, output file is C:\Code\Lesson06\Splitting\Log\SplitToyStoreShard.txt
WARNING: The output object type of this cmdlet will be modified in a future release.


ResourceGroupName : toystore
Location          : eastus2
ProvisioningState : Succeeded
Tags              :
ResourceId        : /subscriptions/bf64f3c6-6e64-48c5-a7cc-6c35b4f9aebf/resourceGroups/toystore



ResourceGroupName        : toystore
ServerName               : toyfactory
Location                 : East US 2
SqlAdministratorLogin    : sqladmin
SqlAdministratorPassword :
ServerVersion            : 12.0
Tags                     :



ResourceGroupName             : toystore
ServerName                    : toyfactory
DatabaseName                  : toystore_splitmerge
Location                      : East US 2
DatabaseId                    : a17e42bf-809c-4a2e-b732-9e58d192f195
Edition                       : Basic
CollationName                 : SQL_Latin1_General_CP1_CI_AS
CatalogCollation              :
MaxSizeBytes                  : 2147483648
Status                        : Online
CreationDate                  : 12/23/2017 10:31:36 AM
CurrentServiceObjectiveId     : dd6d99bb-f193-4ec1-86f2-43d3bccbc49c
CurrentServiceObjectiveName   : Basic
RequestedServiceObjectiveId   : dd6d99bb-f193-4ec1-86f2-43d3bccbc49c
RequestedServiceObjectiveName :
ElasticPoolName               :
EarliestRestoreDate           : 12/23/2017 11:02:51 AM
Tags                          :
ResourceId                    : /subscriptions/bf64f3c6-6e64-48c5-a7cc-6c35b4f9aebf/resourceGroups/toystore/providers/Microsoft.Sql/servers/toyfactory/databases/toystore
                                _splitmerge
CreateMode                    :


Sending split request
PS>TerminatingError(Invoke-WebRequest): "The underlying connection was closed: Could not establish trust relationship for the SSL/TLS secure channel."
>> TerminatingError(Invoke-WebRequest): "The underlying connection was closed: Could not establish trust relationship for the SSL/TLS secure channel."
>> TerminatingError(Invoke-WebRequest): "The underlying connection was closed: Could not establish trust relationship for the SSL/TLS secure channel."
>> TerminatingError(Invoke-WebRequest): "The underlying connection was closed: Could not establish trust relationship for the SSL/TLS secure channel."
Invoke-WebRequest : The underlying connection was closed: Could not establish trust relationship for the SSL/TLS secure channel.
At C:\Code\Lesson06\Splitting\SplitMerge\SplitMerge.psm1:86 char:13
+     $body = Invoke-WebRequest @certificate $SplitMergeServiceEndpoint ...
+             ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : InvalidOperation: (System.Net.HttpWebRequest:HttpWebRequest) [Invoke-WebRequest], WebException
    + FullyQualifiedErrorId : WebCmdletWebResponseException,Microsoft.PowerShell.Commands.InvokeWebRequestCommand

PS C:\Code\Lesson06\Splitting> .\SplitToyStoreShard.ps1 -ResourceGroup toystore -SqlServer toyfactory -UserName sqladmin -Password Packt@pub2 -SplitMergeDatabase toystore_splitmerge -SplitMergeServiceEndpoint "https://52.177.172.172/" -ShardMapManagerDatabaseName toystore_SMM -Shard2 toystore_Shard_200 -ShardMapName toystorerangemap -SplitRangeLow 1 -SplitRangeHigh 200 -SplitValue 100
Transcript started, output file is C:\Code\Lesson06\Splitting\Log\SplitToyStoreShard.txt
WARNING: The output object type of this cmdlet will be modified in a future release.


ResourceGroupName : toystore
Location          : eastus2
ProvisioningState : Succeeded
Tags              :
ResourceId        : /subscriptions/bf64f3c6-6e64-48c5-a7cc-6c35b4f9aebf/resourceGroups/toystore



ResourceGroupName        : toystore
ServerName               : toyfactory
Location                 : East US 2
SqlAdministratorLogin    : sqladmin
SqlAdministratorPassword :
ServerVersion            : 12.0
Tags                     :



ResourceGroupName             : toystore
ServerName                    : toyfactory
DatabaseName                  : toystore_splitmerge
Location                      : East US 2
DatabaseId                    : a17e42bf-809c-4a2e-b732-9e58d192f195
Edition                       : Basic
CollationName                 : SQL_Latin1_General_CP1_CI_AS
CatalogCollation              :
MaxSizeBytes                  : 2147483648
Status                        : Online
CreationDate                  : 12/23/2017 10:31:36 AM
CurrentServiceObjectiveId     : dd6d99bb-f193-4ec1-86f2-43d3bccbc49c
CurrentServiceObjectiveName   : Basic
RequestedServiceObjectiveId   : dd6d99bb-f193-4ec1-86f2-43d3bccbc49c
RequestedServiceObjectiveName :
ElasticPoolName               :
EarliestRestoreDate           : 12/23/2017 11:02:51 AM
Tags                          :
ResourceId                    : /subscriptions/bf64f3c6-6e64-48c5-a7cc-6c35b4f9aebf/resourceGroups/toystore/providers/Microsoft.Sql/servers/toyfactory/databases/toystore
                                _splitmerge
CreateMode                    :


Sending split request
PS C:\Code\Lesson06\Splitting> TerminatingError(Invoke-WebRequest): "The underlying connection was closed: Could not establish trust relationship for the SSL/TLS secure channel."
>> TerminatingError(Invoke-WebRequest): "The underlying connection was closed: Could not establish trust relationship for the SSL/TLS secure channel."
>> TerminatingError(Invoke-WebRequest): "The underlying connection was closed: Could not establish trust relationship for the SSL/TLS secure channel."
>> TerminatingError(Invoke-WebRequest): "The underlying connection was closed: Could not establish trust relationship for the SSL/TLS secure channel."
Invoke-WebRequest : The underlying connection was closed: Could not establish trust relationship for the SSL/TLS secure channel.
At C:\Code\Lesson06\Splitting\SplitMerge\SplitMerge.psm1:86 char:13
+     $body = Invoke-WebRequest @certificate $SplitMergeServiceEndpoint ...
+             ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : InvalidOperation: (System.Net.HttpWebRequest:HttpWebRequest) [Invoke-WebRequest], WebException
    + FullyQualifiedErrorId : WebCmdletWebResponseException,Microsoft.PowerShell.Commands.InvokeWebRequestCommand

PS C:\Code\Lesson06\Splitting> .\SplitToyStoreShard.ps1 -ResourceGroup toystore -SqlServer toyfactory -UserName sqladmin -Password Packt@pub2 -SplitMergeDatabase toystore_splitmerge -SplitMergeServiceEndpoint "https://52.177.172.172/" -ShardMapManagerDatabaseName toystore_SMM -Shard2 toystore_Shard_200 -ShardMapName toystorerangemap -SplitRangeLow 1 -SplitRangeHigh 200 -SplitValue 100
Transcript started, output file is C:\Code\Lesson06\Splitting\Log\SplitToyStoreShard.txt
WARNING: The output object type of this cmdlet will be modified in a future release.


ResourceGroupName : toystore
Location          : eastus2
ProvisioningState : Succeeded
Tags              :
ResourceId        : /subscriptions/bf64f3c6-6e64-48c5-a7cc-6c35b4f9aebf/resourceGroups/toystore



ResourceGroupName        : toystore
ServerName               : toyfactory
Location                 : East US 2
SqlAdministratorLogin    : sqladmin
SqlAdministratorPassword :
ServerVersion            : 12.0
Tags                     :



ResourceGroupName             : toystore
ServerName                    : toyfactory
DatabaseName                  : toystore_splitmerge
Location                      : East US 2
DatabaseId                    : a17e42bf-809c-4a2e-b732-9e58d192f195
Edition                       : Basic
CollationName                 : SQL_Latin1_General_CP1_CI_AS
CatalogCollation              :
MaxSizeBytes                  : 2147483648
Status                        : Online
CreationDate                  : 12/23/2017 10:31:36 AM
CurrentServiceObjectiveId     : dd6d99bb-f193-4ec1-86f2-43d3bccbc49c
CurrentServiceObjectiveName   : Basic
RequestedServiceObjectiveId   : dd6d99bb-f193-4ec1-86f2-43d3bccbc49c
RequestedServiceObjectiveName :
ElasticPoolName               :
EarliestRestoreDate           : 12/23/2017 11:02:51 AM
Tags                          :
ResourceId                    : /subscriptions/bf64f3c6-6e64-48c5-a7cc-6c35b4f9aebf/resourceGroups/toystore/providers/Microsoft.Sql/servers/toyfactory/databases/toystore
                                _splitmerge
CreateMode                    :


Sending split request
PS C:\Code\Lesson06\Splitting> TerminatingError(Invoke-WebRequest): "The underlying connection was closed: An unexpected error occurred on a send."
>> TerminatingError(Invoke-WebRequest): "The underlying connection was closed: An unexpected error occurred on a send."
>> TerminatingError(Invoke-WebRequest): "The underlying connection was closed: An unexpected error occurred on a send."
>> TerminatingError(Invoke-WebRequest): "The underlying connection was closed: An unexpected error occurred on a send."
Invoke-WebRequest : The underlying connection was closed: An unexpected error occurred on a send.
At C:\Code\Lesson06\Splitting\SplitMerge\SplitMerge.psm1:86 char:13
+     $body = Invoke-WebRequest @certificate $SplitMergeServiceEndpoint ...
+             ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : InvalidOperation: (System.Net.HttpWebRequest:HttpWebRequest) [Invoke-WebRequest], WebException
    + FullyQualifiedErrorId : WebCmdletWebResponseException,Microsoft.PowerShell.Commands.InvokeWebRequestCommand

PS C:\Code\Lesson06\Splitting> .\SplitToyStoreShard.ps1 -ResourceGroup toystore -SqlServer toyfactory -UserName sqladmin -Password Packt@pub2 -SplitMergeDatabase toystore_splitmerge -SplitMergeServiceEndpoint "https://splitmerge.cloudapp.net/" -ShardMapManagerDatabaseName toystore_SMM -Shard2 toystore_Shard_200 -ShardMapName toystorerangemap -SplitRangeLow 1 -SplitRangeHigh 200 -SplitValue 100
Transcript started, output file is C:\Code\Lesson06\Splitting\Log\SplitToyStoreShard.txt
WARNING: The output object type of this cmdlet will be modified in a future release.


ResourceGroupName : toystore
Location          : eastus2
ProvisioningState : Succeeded
Tags              :
ResourceId        : /subscriptions/bf64f3c6-6e64-48c5-a7cc-6c35b4f9aebf/resourceGroups/toystore



ResourceGroupName        : toystore
ServerName               : toyfactory
Location                 : East US 2
SqlAdministratorLogin    : sqladmin
SqlAdministratorPassword :
ServerVersion            : 12.0
Tags                     :



ResourceGroupName             : toystore
ServerName                    : toyfactory
DatabaseName                  : toystore_splitmerge
Location                      : East US 2
DatabaseId                    : a17e42bf-809c-4a2e-b732-9e58d192f195
Edition                       : Basic
CollationName                 : SQL_Latin1_General_CP1_CI_AS
CatalogCollation              :
MaxSizeBytes                  : 2147483648
Status                        : Online
CreationDate                  : 12/23/2017 10:31:36 AM
CurrentServiceObjectiveId     : dd6d99bb-f193-4ec1-86f2-43d3bccbc49c
CurrentServiceObjectiveName   : Basic
RequestedServiceObjectiveId   : dd6d99bb-f193-4ec1-86f2-43d3bccbc49c
RequestedServiceObjectiveName :
ElasticPoolName               :
EarliestRestoreDate           : 12/23/2017 11:02:51 AM
Tags                          :
ResourceId                    : /subscriptions/bf64f3c6-6e64-48c5-a7cc-6c35b4f9aebf/resourceGroups/toystore/providers/Microsoft.Sql/servers/toyfactory/databases/toystore
                                _splitmerge
CreateMode                    :


Sending split request
Polling request status. Press Ctrl-C to end
Progress: 0% | Status: Queued | Details: [Informational] Operation has been queued.
Progress: 5% | Status: Starting | Details: [Informational] Starting Split-Merge state machine for request.
Progress: 5% | Status: Starting | Details: [Informational] Performing data consistency checks on target shards.
Progress: 20% | Status: CopyingReferenceTables | Details: [Informational] Successfully copied reference table [Application].[Countries].
Progress: 44% | Status: CopyingShardedTables | Details: [Informational] Moving key range [100:119) of sharded tables.
Progress: 44% | Status: CopyingShardedTables | Details: [Informational] Successfully copied key range [100:119) for sharded table [Sales].[Customers].
Progress: 44% | Status: CopyingShardedTables | Details: [Informational] Successfully copied key range [100:119) for sharded table [Sales].[Orders].
Progress: 48% | Status: CopyingShardedTables | Details: [Informational] Moving key range [119:129) of sharded tables.
Progress: 48% | Status: CopyingShardedTables | Details: [Informational] Successfully copied key range [119:129) for sharded table [Sales].[Customers].
Progress: 53% | Status: CopyingShardedTables | Details: [Informational] Moving key range [129:139) of sharded tables.
Progress: 53% | Status: CopyingShardedTables | Details: [Informational] Successfully copied key range [129:139) for sharded table [Sales].[Orders].
Progress: 57% | Status: CopyingShardedTables | Details: [Informational] Moving key range [139:149) of sharded tables.
Progress: 57% | Status: CopyingShardedTables | Details: [Informational] Successfully copied key range [139:149) for sharded table [Sales].[Customers].
Progress: 57% | Status: CopyingShardedTables | Details: [Informational] Successfully copied key range [139:149) for sharded table [Sales].[Orders].
Progress: 62% | Status: CopyingShardedTables | Details: [Informational] Moving key range [149:159) of sharded tables.
Progress: 62% | Status: CopyingShardedTables | Details: [Informational] Successfully copied key range [149:159) for sharded table [Sales].[Customers].
Progress: 62% | Status: CopyingShardedTables | Details: [Informational] Successfully copied key range [149:159) for sharded table [Sales].[Orders].
Progress: 66% | Status: CopyingShardedTables | Details: [Informational] Moving key range [159:169) of sharded tables.
Progress: 66% | Status: CopyingShardedTables | Details: [Informational] Successfully copied key range [159:169) for sharded table [Sales].[Customers].
Progress: 66% | Status: CopyingShardedTables | Details: [Informational] Successfully copied key range [159:169) for sharded table [Sales].[Orders].
Progress: 71% | Status: CopyingShardedTables | Details: [Informational] Moving key range [169:179) of sharded tables.
Progress: 71% | Status: CopyingShardedTables | Details: [Informational] Successfully copied key range [169:179) for sharded table [Sales].[Customers].
Progress: 71% | Status: CopyingShardedTables | Details: [Informational] Successfully copied key range [169:179) for sharded table [Sales].[Orders].
Progress: 75% | Status: CopyingShardedTables | Details: [Informational] Moving key range [179:189) of sharded tables.
Progress: 75% | Status: CopyingShardedTables | Details: [Informational] Successfully copied key range [179:189) for sharded table [Sales].[Customers].
Progress: 75% | Status: CopyingShardedTables | Details: [Informational] Successfully copied key range [179:189) for sharded table [Sales].[Orders].
Progress: 80% | Status: CopyingShardedTables | Details: [Informational] Moving key range [189:199) of sharded tables.
Progress: 80% | Status: CopyingShardedTables | Details: [Informational] Successfully copied key range [189:199) for sharded table [Sales].[Customers].
Progress: 80% | Status: CopyingShardedTables | Details: [Informational] Successfully copied key range [189:199) for sharded table [Sales].[Orders].
Progress: 80% | Status: CopyingShardedTables | Details: [Informational] Moving key range [199:200) of sharded tables.
Progress: 80% | Status: CopyingShardedTables | Details: [Informational] Successfully copied key range [199:200) for sharded table [Sales].[Customers].
Progress: 80% | Status: CopyingShardedTables | Details: [Informational] Successfully copied key range [199:200) for sharded table [Sales].[Orders].
Progress: 90% | Status: Completing | Details: [Informational] Deleting any temp tables that were created while processing the request.
Progress: 100% | Status: Succeeded | Details: [Informational] Successfully processed request.


**********************
Windows PowerShell transcript start
Start time: 20171223204028
Username: WIN2012R2\Administrator
RunAs User: WIN2012R2\Administrator
Machine: WIN2012R2 (Microsoft Windows NT 6.3.9600.0)
Host Application: C:\Windows\System32\WindowsPowerShell\v1.0\powershell.exe
Process ID: 7804
PSVersion: 5.0.10586.117
PSCompatibleVersions: 1.0, 2.0, 3.0, 4.0, 5.0.10586.117
BuildVersion: 10.0.10586.117
CLRVersion: 4.0.30319.42000
WSManStackVersion: 3.0
PSRemotingProtocolVersion: 2.3
SerializationVersion: 1.1.0.1
**********************
Transcript started, output file is C:\code\lesson06\Splitting\Log\SplitToyStoreShard.txt
WARNING: The output object type of this cmdlet will be modified in a future release.


ResourceGroupName : toystore
Location          : eastus2
ProvisioningState : Succeeded
Tags              :
ResourceId        : /subscriptions/bf64f3c6-6e64-48c5-a7cc-6c35b4f9aebf/resourceGroups/toystore



ResourceGroupName        : toystore
ServerName               : toyfactory
Location                 : East US 2
SqlAdministratorLogin    : sqladmin
SqlAdministratorPassword :
ServerVersion            : 12.0
Tags                     :



ResourceGroupName             : toystore
ServerName                    : toyfactory
DatabaseName                  : toystore_splitmerge
Location                      : East US 2
DatabaseId                    : a17e42bf-809c-4a2e-b732-9e58d192f195
Edition                       : Basic
CollationName                 : SQL_Latin1_General_CP1_CI_AS
CatalogCollation              :
MaxSizeBytes                  : 2147483648
Status                        : Online
CreationDate                  : 12/23/2017 10:31:36 AM
CurrentServiceObjectiveId     : dd6d99bb-f193-4ec1-86f2-43d3bccbc49c
CurrentServiceObjectiveName   : Basic
RequestedServiceObjectiveId   : dd6d99bb-f193-4ec1-86f2-43d3bccbc49c
RequestedServiceObjectiveName :
ElasticPoolName               :
EarliestRestoreDate           : 12/23/2017 11:02:51 AM
Tags                          :
ResourceId                    : /subscriptions/bf64f3c6-6e64-48c5-a7cc-6c35b4f9aebf/resourceGroups/toystore/providers/M
                                icrosoft.Sql/servers/toyfactory/databases/toystore_splitmerge
CreateMode                    :


Sending split request
Polling request status. Press Ctrl-C to end
Progress: 0% | Status: Queued | Details: [Informational] Operation has been queued.
Progress: 5% | Status: Starting | Details: [Informational] Starting Split-Merge state machine for request.
Progress: 5% | Status: Starting | Details: [Informational] Performing data consistency checks on target shards.
Progress: 80% | Status: CopyingShardedTables | Details: [Informational] Moving key range [100:200) of sharded tables.
Progress: 80% | Status: CopyingShardedTables | Details: [Informational] Successfully copied key range [100:200) for sharded table [Sales].[Customers].
Progress: 80% | Status: CopyingShardedTables | Details: [Informational] Successfully copied key range [100:200) for sharded table [Sales].[Orders].
Progress: 90% | Status: Completing | Details: [Informational] Successfully deleted moved shardlets in table [Sales].[Orders].
Progress: 100% | Status: Succeeded | Details: [Informational] Successfully processed request.


PS C:\code\lesson06\Splitting> clear
PS C:\code\lesson06\Splitting> cd ..
PS C:\code\lesson06> cd .\Sharding
PS C:\code\lesson06\Sharding> .\Sharding.ps1 -ResourceGroup toystore -SqlServer toyfactory -UserName sqladmin -Password Packt@pub2 -ShardMapManagerDatabase toystore_SMM -DatabaseToShard toystore
Transcript started, output file is C:\code\lesson06\Sharding\Log\Sharding.txt
WARNING: The output object type of this cmdlet will be modified in a future release.


ResourceGroupName : toystore
Location          : eastus2
ProvisioningState : Succeeded
Tags              :
ResourceId        : /subscriptions/bf64f3c6-6e64-48c5-a7cc-6c35b4f9aebf/resourceGroups/toystore



ResourceGroupName        : toystore
ServerName               : toyfactory
Location                 : East US 2
SqlAdministratorLogin    : sqladmin
SqlAdministratorPassword :
ServerVersion            : 12.0
Tags                     :


Provisioning Azure SQL Database toystore_SMM

ResourceGroupName             : toystore
ServerName                    : toyfactory
DatabaseName                  : toystore_SMM
Location                      : East US 2
DatabaseId                    : a74cbab1-3aa3-4f19-a978-3a8e17c6ace9
Edition                       : Standard
CollationName                 : SQL_Latin1_General_CP1_CI_AS
CatalogCollation              :
MaxSizeBytes                  : 268435456000
Status                        : Online
CreationDate                  : 12/23/2017 3:41:59 PM
CurrentServiceObjectiveId     : f1173c43-91bd-4aaa-973c-54e79e15235b
CurrentServiceObjectiveName   : S0
RequestedServiceObjectiveId   : f1173c43-91bd-4aaa-973c-54e79e15235b
RequestedServiceObjectiveName :
ElasticPoolName               :
EarliestRestoreDate           : 12/23/2017 4:13:12 PM
Tags                          :
ResourceId                    : /subscriptions/bf64f3c6-6e64-48c5-a7cc-6c35b4f9aebf/resourceGroups/toystore/providers/M
                                icrosoft.Sql/servers/toyfactory/databases/toystore_SMM
CreateMode                    :

WARNING: The output object type of this cmdlet will be modified in a future release.
ResourceGroupName : toystore
Location          : eastus2
ProvisioningState : Succeeded
Tags              :
ResourceId        : /subscriptions/bf64f3c6-6e64-48c5-a7cc-6c35b4f9aebf/resourceGroups/toystore



ResourceGroupName        : toystore
ServerName               : toyfactory
Location                 : East US 2
SqlAdministratorLogin    : sqladmin
SqlAdministratorPassword :
ServerVersion            : 12.0
Tags                     :


Provisioning Azure SQL Database toystore_Shard_200

ResourceGroupName             : toystore
ServerName                    : toyfactory
DatabaseName                  : toystore_Shard_200
Location                      : East US 2
DatabaseId                    : d0201f5f-7218-41fd-ae93-5eaaff1ca4e3
Edition                       : Standard
CollationName                 : SQL_Latin1_General_CP1_CI_AS
CatalogCollation              :
MaxSizeBytes                  : 268435456000
Status                        : Online
CreationDate                  : 12/23/2017 3:43:42 PM
CurrentServiceObjectiveId     : f1173c43-91bd-4aaa-973c-54e79e15235b
CurrentServiceObjectiveName   : S0
RequestedServiceObjectiveId   : f1173c43-91bd-4aaa-973c-54e79e15235b
RequestedServiceObjectiveName :
ElasticPoolName               :
EarliestRestoreDate           : 12/23/2017 4:14:43 PM
Tags                          :
ResourceId                    : /subscriptions/bf64f3c6-6e64-48c5-a7cc-6c35b4f9aebf/resourceGroups/toystore/providers/M
                                icrosoft.Sql/servers/toyfactory/databases/toystore_Shard_200
CreateMode                    :

Creating table 1_CreateSchemas.sql.FullName in toystore_Shard_200
Creating table 2_Application.Countries.sql.FullName in toystore_Shard_200
Creating table 3_Sales.Customer.sql.FullName in toystore_Shard_200
Creating table 4_Sales.Orders.sql.FullName in toystore_Shard_200
Configuring database toystore_SMM as Shard Map Manager
Adding toystore_Shard_1_100 and toystore_Shard_200 to the Shard Map toystorerangemap
Add range keys to toystore_Shard_1_100 (Shard1)
Adding schema mappings to the Shard Map Manager Database
toystore is now Sharded.


PS C:\code\lesson06\Sharding> cd ..
PS C:\code\lesson06> cd .\Splitting
PS C:\code\lesson06\Splitting> clear
PS C:\code\lesson06\Splitting> .\SplitToyStoreShard.ps1 -ResourceGroup toystore -SqlServer toyfactory -UserName sqladmin -Password Packt@pub2 -SplitMergeDatabase toystore_splitmerge -SplitMergeServiceEndpoint "https://splitmerge.cloudapp.net/" -ShardMapManagerDatabaseName toystore_SMM -Shard2 toystore_Shard_200 -ShardMapName toystorerangemap -SplitRangeLow 0 -SplitRangeHigh 200 -SplitValue 100
PS C:\code\lesson06\Splitting> TerminatingError(Start-Transcript): "Transcription cannot be started."
Start-Transcript : Transcription cannot be started.
At C:\code\lesson06\Splitting\SplitToyStoreShard.ps1:55 char:1
+ Start-Transcript -Path "$ScriptPath\Log\SplitToyStoreShard.txt"
+ ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : InvalidOperation: (:) [Start-Transcript], PSInvalidOperationException
    + FullyQualifiedErrorId : CannotStartTranscription,Microsoft.PowerShell.Commands.StartTranscriptCommand
Start-Transcript : Transcription cannot be started.
At C:\code\lesson06\Splitting\SplitToyStoreShard.ps1:55 char:1
+ Start-Transcript -Path "$ScriptPath\Log\SplitToyStoreShard.txt"
+ ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : InvalidOperation: (:) [Start-Transcript], PSInvalidOperationException
    + FullyQualifiedErrorId : CannotStartTranscription,Microsoft.PowerShell.Commands.StartTranscriptCommand

Sending split request
Polling request status. Press Ctrl-C to end
Progress: 0% | Status: Queued | Details: [Informational] Operation has been queued.
Progress: 5% | Status: Starting | Details: [Informational] Starting Split-Merge state machine for request.
Progress: 5% | Status: Starting | Details: [Informational] Performing data consistency checks on target shards.
Progress: 20% | Status: CopyingReferenceTables | Details: [Informational] Successfully copied reference table [Application].[Countries].
Progress: 80% | Status: CopyingShardedTables | Details: [Informational] Moving key range [100:200) of sharded tables.
Progress: 80% | Status: CopyingShardedTables | Details: [Informational] Successfully copied key range [100:200) for sharded table [Sales].[Customers].
Progress: 80% | Status: CopyingShardedTables | Details: [Informational] Successfully copied key range [100:200) for sharded table [Sales].[Orders].
Progress: 90% | Status: Completing | Details: [Informational] Successfully deleted moved shardlets in table [Sales].[Orders].
Progress: 90% | Status: Completing | Details: [Informational] Deleting any temp tables that were created while processing the request.
Progress: 100% | Status: Succeeded | Details: [Informational] Successfully processed request.
PS C:\code\lesson06\Splitting> clear
PS C:\code\lesson06\Splitting> cd ..\Sharding
PS C:\code\lesson06\Sharding> .\Sharding.ps1 -ResourceGroup toystore -SqlServer toyfactory -UserName sqladmin -Password Packt@pub2 -ShardMapManagerDatabase toystore_SMM -DatabaseToShard toystore
Transcript started, output file is C:\code\lesson06\Sharding\Log\Sharding.txt
WARNING: The output object type of this cmdlet will be modified in a future release.


ResourceGroupName : toystore
Location          : eastus2
ProvisioningState : Succeeded
Tags              :
ResourceId        : /subscriptions/bf64f3c6-6e64-48c5-a7cc-6c35b4f9aebf/resourceGroups/toystore



ResourceGroupName        : toystore
ServerName               : toyfactory
Location                 : East US 2
SqlAdministratorLogin    : sqladmin
SqlAdministratorPassword :
ServerVersion            : 12.0
Tags                     :


Provisioning Azure SQL Database toystore_SMM

ResourceGroupName             : toystore
ServerName                    : toyfactory
DatabaseName                  : toystore_SMM
Location                      : East US 2
DatabaseId                    : f97f1112-136d-4c18-a98d-7640ecd5884f
Edition                       : Standard
CollationName                 : SQL_Latin1_General_CP1_CI_AS
CatalogCollation              :
MaxSizeBytes                  : 268435456000
Status                        : Online
CreationDate                  : 12/23/2017 3:59:56 PM
CurrentServiceObjectiveId     : f1173c43-91bd-4aaa-973c-54e79e15235b
CurrentServiceObjectiveName   : S0
RequestedServiceObjectiveId   : f1173c43-91bd-4aaa-973c-54e79e15235b
RequestedServiceObjectiveName :
ElasticPoolName               :
EarliestRestoreDate           : 12/23/2017 4:30:46 PM
Tags                          :
ResourceId                    : /subscriptions/bf64f3c6-6e64-48c5-a7cc-6c35b4f9aebf/resourceGroups/toystore/providers/M
                                icrosoft.Sql/servers/toyfactory/databases/toystore_SMM
CreateMode                    :

WARNING: The output object type of this cmdlet will be modified in a future release.
ResourceGroupName : toystore
Location          : eastus2
ProvisioningState : Succeeded
Tags              :
ResourceId        : /subscriptions/bf64f3c6-6e64-48c5-a7cc-6c35b4f9aebf/resourceGroups/toystore



ResourceGroupName        : toystore
ServerName               : toyfactory
Location                 : East US 2
SqlAdministratorLogin    : sqladmin
SqlAdministratorPassword :
ServerVersion            : 12.0
Tags                     :


Provisioning Azure SQL Database toystore_Shard_200

ResourceGroupName             : toystore
ServerName                    : toyfactory
DatabaseName                  : toystore_Shard_200
Location                      : East US 2
DatabaseId                    : 55442592-0e54-4557-ae26-f446807e1b3b
Edition                       : Standard
CollationName                 : SQL_Latin1_General_CP1_CI_AS
CatalogCollation              :
MaxSizeBytes                  : 268435456000
Status                        : Online
CreationDate                  : 12/23/2017 4:01:23 PM
CurrentServiceObjectiveId     : f1173c43-91bd-4aaa-973c-54e79e15235b
CurrentServiceObjectiveName   : S0
RequestedServiceObjectiveId   : f1173c43-91bd-4aaa-973c-54e79e15235b
RequestedServiceObjectiveName :
ElasticPoolName               :
EarliestRestoreDate           : 12/23/2017 4:32:38 PM
Tags                          :
ResourceId                    : /subscriptions/bf64f3c6-6e64-48c5-a7cc-6c35b4f9aebf/resourceGroups/toystore/providers/M
                                icrosoft.Sql/servers/toyfactory/databases/toystore_Shard_200
CreateMode                    :

Creating table 1_CreateSchemas.sql.FullName in toystore_Shard_200
Creating table 2_Application.Countries.sql.FullName in toystore_Shard_200
Creating table 3_Sales.Customer.sql.FullName in toystore_Shard_200
Creating table 4_Sales.Orders.sql.FullName in toystore_Shard_200
Configuring database toystore_SMM as Shard Map Manager
Adding toystore_Shard_1_100 and toystore_Shard_200 to the Shard Map toystorerangemap
Add range keys to toystore_Shard_1_100 (Shard1)
Adding schema mappings to the Shard Map Manager Database
toystore is now Sharded.


PS C:\code\lesson06\Sharding> cd ..\Splitting
PS C:\code\lesson06\Splitting> .\SplitToyStoreShard.ps1 -ResourceGroup toystore -SqlServer toyfactory -UserName sqladmin -Password Packt@pub2 -SplitMergeDatabase toystore_splitmerge -SplitMergeServiceEndpoint "https://splitmerge.cloudapp.net/" -ShardMapManagerDatabaseName toystore_SMM -Shard2 toystore_Shard_200 -ShardMapName toystorerangemap -SplitRangeLow 0 -SplitRangeHigh 200 -SplitValue 100
Transcript started, output file is \Log\SplitToyStoreShard.txt
Sending split request
Polling request status. Press Ctrl-C to end
Progress: 0% | Status: Queued | Details: [Informational] Operation has been queued.
Progress: 5% | Status: Starting | Details: [Informational] Starting Split-Merge state machine for request.
Progress: 5% | Status: Starting | Details: [Informational] Performing data consistency checks on target shards.
Progress: 44% | Status: CopyingShardedTables | Details: [Informational] Moving key range [100:110) of sharded tables.
Progress: 44% | Status: CopyingShardedTables | Details: [Informational] Successfully copied key range [100:110) for sharded table [Sales].[Customers].
Progress: 44% | Status: CopyingShardedTables | Details: [Informational] Successfully copied key range [100:110) for sharded table [Sales].[Orders].
Progress: 48% | Status: CopyingShardedTables | Details: [Informational] Moving key range [110:120) of sharded tables.
Progress: 48% | Status: CopyingShardedTables | Details: [Informational] Successfully copied key range [110:120) for sharded table [Sales].[Customers].
Progress: 52% | Status: CopyingShardedTables | Details: [Informational] Moving key range [120:130) of sharded tables.
Progress: 52% | Status: CopyingShardedTables | Details: [Informational] Successfully copied key range [120:130) for sharded table [Sales].[Orders].
Progress: 56% | Status: CopyingShardedTables | Details: [Informational] Moving key range [130:140) of sharded tables.
Progress: 56% | Status: CopyingShardedTables | Details: [Informational] Successfully copied key range [130:140) for sharded table [Sales].[Customers].
Progress: 56% | Status: CopyingShardedTables | Details: [Informational] Successfully copied key range [130:140) for sharded table [Sales].[Orders].
Progress: 60% | Status: CopyingShardedTables | Details: [Informational] Moving key range [140:150) of sharded tables.
Progress: 60% | Status: CopyingShardedTables | Details: [Informational] Successfully copied key range [140:150) for sharded table [Sales].[Customers].
Progress: 64% | Status: CopyingShardedTables | Details: [Informational] Moving key range [150:160) of sharded tables.
Progress: 64% | Status: CopyingShardedTables | Details: [Informational] Successfully copied key range [150:160) for sharded table [Sales].[Customers].
Progress: 68% | Status: CopyingShardedTables | Details: [Informational] Moving key range [160:170) of sharded tables.
Progress: 68% | Status: CopyingShardedTables | Details: [Informational] Successfully copied key range [160:170) for sharded table [Sales].[Customers].
Progress: 72% | Status: CopyingShardedTables | Details: [Informational] Moving key range [170:180) of sharded tables.
Progress: 72% | Status: CopyingShardedTables | Details: [Informational] Successfully copied key range [170:180) for sharded table [Sales].[Customers].
Progress: 76% | Status: CopyingShardedTables | Details: [Informational] Moving key range [180:190) of sharded tables.
Progress: 76% | Status: CopyingShardedTables | Details: [Informational] Successfully copied key range [180:190) for sharded table [Sales].[Customers].
Progress: 76% | Status: CopyingShardedTables | Details: [Informational] Successfully copied key range [180:190) for sharded table [Sales].[Orders].
Progress: 80% | Status: CopyingShardedTables | Details: [Informational] Moving key range [190:200) of sharded tables.
Progress: 80% | Status: CopyingShardedTables | Details: [Informational] Successfully copied key range [190:200) for sharded table [Sales].[Customers].
Progress: 80% | Status: CopyingShardedTables | Details: [Informational] Successfully copied key range [190:200) for sharded table [Sales].[Orders].
Progress: 90% | Status: Completing | Details: [Informational] Successfully deleted moved shardlets in table [Sales].[Orders].
Progress: 100% | Status: Succeeded | Details: [Informational] Successfully processed request.
PS C:\code\lesson06\Splitting> clear
PS C:\code\lesson06\Splitting> cd ..\Sharding
PS C:\code\lesson06\Sharding> .\Sharding.ps1 -ResourceGroup toystore -SqlServer toyfactory -UserName sqladmin -Password Packt@pub2 -ShardMapManagerDatabase toystore_SMM -DatabaseToShard toystore
Transcript started, output file is C:\code\lesson06\Sharding\Log\Sharding.txt
WARNING: The output object type of this cmdlet will be modified in a future release.


ResourceGroupName : toystore
Location          : eastus2
ProvisioningState : Succeeded
Tags              :
ResourceId        : /subscriptions/bf64f3c6-6e64-48c5-a7cc-6c35b4f9aebf/resourceGroups/toystore



ResourceGroupName        : toystore
ServerName               : toyfactory
Location                 : East US 2
SqlAdministratorLogin    : sqladmin
SqlAdministratorPassword :
ServerVersion            : 12.0
Tags                     :


Provisioning Azure SQL Database toystore_SMM

ResourceGroupName             : toystore
ServerName                    : toyfactory
DatabaseName                  : toystore_SMM
Location                      : East US 2
DatabaseId                    : 69007bc8-ecf8-4e6a-bf4a-b7d43819d275
Edition                       : Standard
CollationName                 : SQL_Latin1_General_CP1_CI_AS
CatalogCollation              :
MaxSizeBytes                  : 268435456000
Status                        : Online
CreationDate                  : 12/23/2017 4:12:25 PM
CurrentServiceObjectiveId     : f1173c43-91bd-4aaa-973c-54e79e15235b
CurrentServiceObjectiveName   : S0
RequestedServiceObjectiveId   : f1173c43-91bd-4aaa-973c-54e79e15235b
RequestedServiceObjectiveName :
ElasticPoolName               :
EarliestRestoreDate           : 12/23/2017 4:43:27 PM
Tags                          :
ResourceId                    : /subscriptions/bf64f3c6-6e64-48c5-a7cc-6c35b4f9aebf/resourceGroups/toystore/providers/M
                                icrosoft.Sql/servers/toyfactory/databases/toystore_SMM
CreateMode                    :

WARNING: The output object type of this cmdlet will be modified in a future release.
ResourceGroupName : toystore
Location          : eastus2
ProvisioningState : Succeeded
Tags              :
ResourceId        : /subscriptions/bf64f3c6-6e64-48c5-a7cc-6c35b4f9aebf/resourceGroups/toystore



ResourceGroupName        : toystore
ServerName               : toyfactory
Location                 : East US 2
SqlAdministratorLogin    : sqladmin
SqlAdministratorPassword :
ServerVersion            : 12.0
Tags                     :


Provisioning Azure SQL Database toystore_Shard_200

ResourceGroupName             : toystore
ServerName                    : toyfactory
DatabaseName                  : toystore_Shard_200
Location                      : East US 2
DatabaseId                    : c8708d01-588c-423d-bd24-d6b5728778c2
Edition                       : Standard
CollationName                 : SQL_Latin1_General_CP1_CI_AS
CatalogCollation              :
MaxSizeBytes                  : 268435456000
Status                        : Online
CreationDate                  : 12/23/2017 4:14:07 PM
CurrentServiceObjectiveId     : f1173c43-91bd-4aaa-973c-54e79e15235b
CurrentServiceObjectiveName   : S0
RequestedServiceObjectiveId   : f1173c43-91bd-4aaa-973c-54e79e15235b
RequestedServiceObjectiveName :
ElasticPoolName               :
EarliestRestoreDate           : 12/23/2017 4:45:31 PM
Tags                          :
ResourceId                    : /subscriptions/bf64f3c6-6e64-48c5-a7cc-6c35b4f9aebf/resourceGroups/toystore/providers/M
                                icrosoft.Sql/servers/toyfactory/databases/toystore_Shard_200
CreateMode                    :

Creating table 1_CreateSchemas.sql.FullName in toystore_Shard_200
Invoke-Sqlcmd : A network-related or instance-specific error occurred while establishing a connection to SQL Server. 
The server was not found or was not accessible. Verify that the instance name is correct and that SQL Server is 
configured to allow remote connections. (provider: Named Pipes Provider, error: 40 - Could not open a connection to SQL 
Server)
At C:\code\lesson06\Sharding\Sharding.ps1:94 char:5
+     Invoke-Sqlcmd -ServerInstance $SQLServerFQDN -Username $UserName  ...
+     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : InvalidOperation: (:) [Invoke-Sqlcmd], SqlException
    + FullyQualifiedErrorId : SqlExectionError,Microsoft.SqlServer.Management.PowerShell.GetScriptCommand
Invoke-Sqlcmd : A network-related or instance-specific error occurred while establishing a connection to SQL Server.
The server was not found or was not accessible. Verify that the instance name is correct and that SQL Server is
configured to allow remote connections. (provider: Named Pipes Provider, error: 40 - Could not open a connection to
SQL Server)
At C:\code\lesson06\Sharding\Sharding.ps1:94 char:5
+     Invoke-Sqlcmd -ServerInstance $SQLServerFQDN -Username $UserName  ...
+     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : InvalidOperation: (:) [Invoke-Sqlcmd], SqlException
    + FullyQualifiedErrorId : SqlExectionError,Microsoft.SqlServer.Management.PowerShell.GetScriptCommand

>> TerminatingError(Invoke-Sqlcmd): ""
Invoke-Sqlcmd : 
At C:\code\lesson06\Sharding\Sharding.ps1:94 char:5
+     Invoke-Sqlcmd -ServerInstance $SQLServerFQDN -Username $UserName  ...
+     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : ParserError: (:) [Invoke-Sqlcmd], ParserException
    + FullyQualifiedErrorId : ExecutionFailureException,Microsoft.SqlServer.Management.PowerShell.GetScriptCommand
Invoke-Sqlcmd :
At C:\code\lesson06\Sharding\Sharding.ps1:94 char:5
+     Invoke-Sqlcmd -ServerInstance $SQLServerFQDN -Username $UserName  ...
+     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : ParserError: (:) [Invoke-Sqlcmd], ParserException
    + FullyQualifiedErrorId : ExecutionFailureException,Microsoft.SqlServer.Management.PowerShell.GetScriptCommand

Creating table 2_Application.Countries.sql.FullName in toystore_Shard_200
Invoke-Sqlcmd : The specified schema name "Application" either does not exist or you do not have permission to use it.
At C:\code\lesson06\Sharding\Sharding.ps1:94 char:5
+     Invoke-Sqlcmd -ServerInstance $SQLServerFQDN -Username $UserName  ...
+     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : InvalidOperation: (:) [Invoke-Sqlcmd], SqlPowerShellSqlExecutionException
    + FullyQualifiedErrorId : SqlError,Microsoft.SqlServer.Management.PowerShell.GetScriptCommand
Invoke-Sqlcmd : The specified schema name "Application" either does not exist or you do not have permission to use it.
At C:\code\lesson06\Sharding\Sharding.ps1:94 char:5
+     Invoke-Sqlcmd -ServerInstance $SQLServerFQDN -Username $UserName  ...
+     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : InvalidOperation: (:) [Invoke-Sqlcmd], SqlPowerShellSqlExecutionException
    + FullyQualifiedErrorId : SqlError,Microsoft.SqlServer.Management.PowerShell.GetScriptCommand

Creating table 3_Sales.Customer.sql.FullName in toystore_Shard_200
Invoke-Sqlcmd : The specified schema name "Sales" either does not exist or you do not have permission to use it.
At C:\code\lesson06\Sharding\Sharding.ps1:94 char:5
+     Invoke-Sqlcmd -ServerInstance $SQLServerFQDN -Username $UserName  ...
+     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : InvalidOperation: (:) [Invoke-Sqlcmd], SqlPowerShellSqlExecutionException
    + FullyQualifiedErrorId : SqlError,Microsoft.SqlServer.Management.PowerShell.GetScriptCommand
Invoke-Sqlcmd : The specified schema name "Sales" either does not exist or you do not have permission to use it.
At C:\code\lesson06\Sharding\Sharding.ps1:94 char:5
+     Invoke-Sqlcmd -ServerInstance $SQLServerFQDN -Username $UserName  ...
+     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : InvalidOperation: (:) [Invoke-Sqlcmd], SqlPowerShellSqlExecutionException
    + FullyQualifiedErrorId : SqlError,Microsoft.SqlServer.Management.PowerShell.GetScriptCommand

Creating table 4_Sales.Orders.sql.FullName in toystore_Shard_200
Invoke-Sqlcmd : The specified schema name "Sales" either does not exist or you do not have permission to use it.
At C:\code\lesson06\Sharding\Sharding.ps1:94 char:5
+     Invoke-Sqlcmd -ServerInstance $SQLServerFQDN -Username $UserName  ...
+     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : InvalidOperation: (:) [Invoke-Sqlcmd], SqlPowerShellSqlExecutionException
    + FullyQualifiedErrorId : SqlError,Microsoft.SqlServer.Management.PowerShell.GetScriptCommand
Invoke-Sqlcmd : The specified schema name "Sales" either does not exist or you do not have permission to use it.
At C:\code\lesson06\Sharding\Sharding.ps1:94 char:5
+     Invoke-Sqlcmd -ServerInstance $SQLServerFQDN -Username $UserName  ...
+     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : InvalidOperation: (:) [Invoke-Sqlcmd], SqlPowerShellSqlExecutionException
    + FullyQualifiedErrorId : SqlError,Microsoft.SqlServer.Management.PowerShell.GetScriptCommand

Configuring database toystore_SMM as Shard Map Manager
Adding toystore_Shard_1_100 and toystore_Shard_200 to the Shard Map toystorerangemap
Add range keys to toystore_Shard_1_100 (Shard1)
Adding schema mappings to the Shard Map Manager Database
toystore is now Sharded.


PS C:\code\lesson06\Sharding> cd ..\Splitting
PS C:\code\lesson06\Splitting> .\SplitToyStoreShard.ps1 -ResourceGroup toystore -SqlServer toyfactory -UserName sqladmin -Password Packt@pub2 -SplitMergeDatabase toystore_splitmerge -SplitMergeServiceEndpoint "https://splitmerge.cloudapp.net/" -ShardMapManagerDatabaseName toystore_SMM -Shard2 toystore_Shard_200 -ShardMapName toystorerangemap -SplitRangeLow 0 -SplitRangeHigh 200 -SplitValue 100
PS C:\code\lesson06\Splitting> TerminatingError(Start-Transcript): "Transcription cannot be started."
Start-Transcript : Transcription cannot be started.
At C:\code\lesson06\Splitting\SplitToyStoreShard.ps1:34 char:1
+ Start-Transcript -Path "$ScriptPath\Log\SplitToyStoreShard.txt"
+ ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : InvalidOperation: (:) [Start-Transcript], PSInvalidOperationException
    + FullyQualifiedErrorId : CannotStartTranscription,Microsoft.PowerShell.Commands.StartTranscriptCommand
Start-Transcript : Transcription cannot be started.
At C:\code\lesson06\Splitting\SplitToyStoreShard.ps1:34 char:1
+ Start-Transcript -Path "$ScriptPath\Log\SplitToyStoreShard.txt"
+ ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : InvalidOperation: (:) [Start-Transcript], PSInvalidOperationException
    + FullyQualifiedErrorId : CannotStartTranscription,Microsoft.PowerShell.Commands.StartTranscriptCommand

Sending split request
Polling request status. Press Ctrl-C to end
Progress: 0% | Status: Queued | Details: [Informational] Operation has been queued.
Progress: 5% | Status: Starting | Details: [Informational] Starting Split-Merge state machine for request.
Progress: 5% | Status: Starting | Details: [Informational] Performing data consistency checks on target shards.
Progress: 20% | Status: CopyingReferenceTables | Details: [Informational] Successfully copied reference table [Application].[Countries].
Progress: 80% | Status: CopyingShardedTables | Details: [Informational] Moving key range [100:200) of sharded tables.
Progress: 80% | Status: CopyingShardedTables | Details: [Informational] Successfully copied key range [100:200) for sharded table [Sales].[Customers].
Progress: 80% | Status: CopyingShardedTables | Details: [Informational] Successfully copied key range [100:200) for sharded table [Sales].[Orders].
Progress: 90% | Status: Completing | Details: [Informational] Successfully deleted moved shardlets in table [Sales].[Orders].
Progress: 100% | Status: Succeeded | Details: [Informational] Successfully processed request.
PS C:\code\lesson06\Splitting> clear
PS C:\code\lesson06\Splitting> cd ..\Sharding
PS C:\code\lesson06\Sharding> .\Sharding.ps1 -ResourceGroup toystore -SqlServer toyfactory -UserName sqladmin -Password Packt@pub2 -ShardMapManagerDatabase toystore_SMM -DatabaseToShard toystore
Transcript started, output file is C:\code\lesson06\Sharding\Log\Sharding.txt
WARNING: The output object type of this cmdlet will be modified in a future release.


ResourceGroupName : toystore
Location          : eastus2
ProvisioningState : Succeeded
Tags              :
ResourceId        : /subscriptions/bf64f3c6-6e64-48c5-a7cc-6c35b4f9aebf/resourceGroups/toystore



ResourceGroupName        : toystore
ServerName               : toyfactory
Location                 : East US 2
SqlAdministratorLogin    : sqladmin
SqlAdministratorPassword :
ServerVersion            : 12.0
Tags                     :


Provisioning Azure SQL Database toystore_SMM

ResourceGroupName             : toystore
ServerName                    : toyfactory
DatabaseName                  : toystore_SMM
Location                      : East US 2
DatabaseId                    : 11a88b57-544e-43dc-a42b-03ecf191a9f6
Edition                       : Standard
CollationName                 : SQL_Latin1_General_CP1_CI_AS
CatalogCollation              :
MaxSizeBytes                  : 268435456000
Status                        : Online
CreationDate                  : 12/23/2017 4:28:50 PM
CurrentServiceObjectiveId     : f1173c43-91bd-4aaa-973c-54e79e15235b
CurrentServiceObjectiveName   : S0
RequestedServiceObjectiveId   : f1173c43-91bd-4aaa-973c-54e79e15235b
RequestedServiceObjectiveName :
ElasticPoolName               :
EarliestRestoreDate           : 12/23/2017 5:00:13 PM
Tags                          :
ResourceId                    : /subscriptions/bf64f3c6-6e64-48c5-a7cc-6c35b4f9aebf/resourceGroups/toystore/providers/M
                                icrosoft.Sql/servers/toyfactory/databases/toystore_SMM
CreateMode                    :

WARNING: The output object type of this cmdlet will be modified in a future release.
ResourceGroupName : toystore
Location          : eastus2
ProvisioningState : Succeeded
Tags              :
ResourceId        : /subscriptions/bf64f3c6-6e64-48c5-a7cc-6c35b4f9aebf/resourceGroups/toystore



ResourceGroupName        : toystore
ServerName               : toyfactory
Location                 : East US 2
SqlAdministratorLogin    : sqladmin
SqlAdministratorPassword :
ServerVersion            : 12.0
Tags                     :


Provisioning Azure SQL Database toystore_Shard_200

ResourceGroupName             : toystore
ServerName                    : toyfactory
DatabaseName                  : toystore_Shard_200
Location                      : East US 2
DatabaseId                    : 94d6b8e8-45b7-4bd9-9ce2-50da3db6e822
Edition                       : Standard
CollationName                 : SQL_Latin1_General_CP1_CI_AS
CatalogCollation              :
MaxSizeBytes                  : 268435456000
Status                        : Online
CreationDate                  : 12/23/2017 4:30:47 PM
CurrentServiceObjectiveId     : f1173c43-91bd-4aaa-973c-54e79e15235b
CurrentServiceObjectiveName   : S0
RequestedServiceObjectiveId   : f1173c43-91bd-4aaa-973c-54e79e15235b
RequestedServiceObjectiveName :
ElasticPoolName               :
EarliestRestoreDate           : 12/23/2017 5:01:58 PM
Tags                          :
ResourceId                    : /subscriptions/bf64f3c6-6e64-48c5-a7cc-6c35b4f9aebf/resourceGroups/toystore/providers/M
                                icrosoft.Sql/servers/toyfactory/databases/toystore_Shard_200
CreateMode                    :

Creating table 1_CreateSchemas.sql in toystore_Shard_200
Creating table 2_Application.Countries.sql in toystore_Shard_200
Creating table 3_Sales.Customer.sql in toystore_Shard_200
Creating table 4_Sales.Orders.sql in toystore_Shard_200
Configuring database toystore_SMM as Shard Map Manager
Adding toystore_Shard_1_100 and toystore_Shard_200 to the Shard Map toystorerangemap
Add range keys to toystore_Shard_1_100 (Shard1)
Adding schema mappings to the Shard Map Manager Database
toystore is now Sharded.


PS C:\code\lesson06\Sharding> cd ..\Splitting
PS C:\code\lesson06\Splitting> .\SplitToyStoreShard.ps1 -ResourceGroup toystore -SqlServer toyfactory -UserName sqladmin -Password Packt@pub2 -SplitMergeDatabase toystore_splitmerge -SplitMergeServiceEndpoint "https://splitmerge.cloudapp.net/" -ShardMapManagerDatabaseName toystore_SMM -Shard2 toystore_Shard_200 -ShardMapName toystorerangemap -SplitRangeLow 0 -SplitRangeHigh 200 -SplitValue 100
PS C:\code\lesson06\Splitting> TerminatingError(Start-Transcript): "Transcription cannot be started."
Start-Transcript : Transcription cannot be started.
At C:\code\lesson06\Splitting\SplitToyStoreShard.ps1:34 char:1
+ Start-Transcript -Path "$ScriptPath\Log\SplitToyStoreShard.txt"
+ ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : InvalidOperation: (:) [Start-Transcript], PSInvalidOperationException
    + FullyQualifiedErrorId : CannotStartTranscription,Microsoft.PowerShell.Commands.StartTranscriptCommand
Start-Transcript : Transcription cannot be started.
At C:\code\lesson06\Splitting\SplitToyStoreShard.ps1:34 char:1
+ Start-Transcript -Path "$ScriptPath\Log\SplitToyStoreShard.txt"
+ ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : InvalidOperation: (:) [Start-Transcript], PSInvalidOperationException
    + FullyQualifiedErrorId : CannotStartTranscription,Microsoft.PowerShell.Commands.StartTranscriptCommand

Sending split request
Polling request status. Press Ctrl-C to end
Progress: 0% | Status: Queued | Details: [Informational] Operation has been queued.
Progress: 5% | Status: Starting | Details: [Informational] Starting Split-Merge state machine for request.
Progress: 5% | Status: Starting | Details: [Informational] Performing data consistency checks on target shards.
Progress: 20% | Status: CopyingReferenceTables | Details: [Informational] Successfully copied reference table [Application].[Countries].
Progress: 44% | Status: CopyingShardedTables | Details: [Informational] Moving key range [100:110) of sharded tables.
Progress: 44% | Status: CopyingShardedTables | Details: [Informational] Successfully copied key range [100:110) for sharded table [Sales].[Customers].
Progress: 44% | Status: CopyingShardedTables | Details: [Informational] Successfully copied key range [100:110) for sharded table [Sales].[Orders].
Progress: 48% | Status: CopyingShardedTables | Details: [Informational] Successfully copied key range [110:120) for sharded table [Sales].[Customers].
Progress: 48% | Status: CopyingShardedTables | Details: [Informational] Successfully copied key range [110:120) for sharded table [Sales].[Orders].
Progress: 52% | Status: CopyingShardedTables | Details: [Informational] Moving key range [120:130) of sharded tables.
Progress: 52% | Status: CopyingShardedTables | Details: [Informational] Successfully copied key range [120:130) for sharded table [Sales].[Customers].
Progress: 56% | Status: CopyingShardedTables | Details: [Informational] Moving key range [130:140) of sharded tables.
Progress: 56% | Status: CopyingShardedTables | Details: [Informational] Successfully copied key range [130:140) for sharded table [Sales].[Customers].
Progress: 60% | Status: CopyingShardedTables | Details: [Informational] Moving key range [140:150) of sharded tables.
Progress: 60% | Status: CopyingShardedTables | Details: [Informational] Successfully copied key range [140:150) for sharded table [Sales].[Customers].
Progress: 64% | Status: CopyingShardedTables | Details: [Informational] Moving key range [150:160) of sharded tables.
Progress: 64% | Status: CopyingShardedTables | Details: [Informational] Successfully copied key range [150:160) for sharded table [Sales].[Customers].
Progress: 68% | Status: CopyingShardedTables | Details: [Informational] Moving key range [160:170) of sharded tables.
Progress: 68% | Status: CopyingShardedTables | Details: [Informational] Successfully copied key range [160:170) for sharded table [Sales].[Customers].
Progress: 72% | Status: CopyingShardedTables | Details: [Informational] Moving key range [170:180) of sharded tables.
Progress: 72% | Status: CopyingShardedTables | Details: [Informational] Successfully copied key range [170:180) for sharded table [Sales].[Customers].
Progress: 76% | Status: CopyingShardedTables | Details: [Informational] Moving key range [180:190) of sharded tables.
Progress: 76% | Status: CopyingShardedTables | Details: [Informational] Successfully copied key range [180:190) for sharded table [Sales].[Customers].
Progress: 80% | Status: CopyingShardedTables | Details: [Informational] Moving key range [190:200) of sharded tables.
Progress: 80% | Status: CopyingShardedTables | Details: [Informational] Successfully copied key range [190:200) for sharded table [Sales].[Customers].
Progress: 80% | Status: CopyingShardedTables | Details: [Informational] Successfully copied key range [190:200) for sharded table [Sales].[Orders].
Progress: 90% | Status: Completing | Details: [Informational] Deleting any temp tables that were created while processing the request.
Progress: 100% | Status: Succeeded | Details: [Informational] Successfully processed request.
**********************
Windows PowerShell transcript end
End time: 20171223220624
**********************
